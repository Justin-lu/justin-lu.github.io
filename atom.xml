<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Hi I'm Justin-lu]]></title>
  <link href="http://justin-lu.github.io/atom.xml" rel="self"/>
  <link href="http://justin-lu.github.io/"/>
  <updated>2016-08-19T21:29:29+08:00</updated>
  <id>http://justin-lu.github.io/</id>
  <author>
    <name><![CDATA[Justin-lu]]></name>
    <email><![CDATA[gdjyluxiaoyong@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[å‰åç«¯åˆ†ç¦»å®è·µ â€” å¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜]]></title>
    <link href="http://justin-lu.github.io/blog/2016/08/19/qian-hou-duan-fen-chi-shi-jian-ru-he-jie-jue-kua-yu-wen-ti/"/>
    <updated>2016-08-19T20:51:22+08:00</updated>
    <id>http://justin-lu.github.io/blog/2016/08/19/qian-hou-duan-fen-chi-shi-jian-ru-he-jie-jue-kua-yu-wen-ti</id>
    <content type="html"><![CDATA[<p><a href="https://github.com/Justin-lu/react-redux-antd/issues/4">åŸæ–‡é“¾æ¥</a></p>

<p>éšç€å‰ç«¯è¶Šæ¥è¶Šç«ï¼Œè¶Šæ¥è¶Šå¤šçš„äººæ¨å´‡å‰åç«¯åˆ†ç¦»ï¼Œåç«¯åªæä¾›APIï¼Œå‰ç«¯åªè´Ÿè´£æ¶ˆè´¹APIã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½æ›´åŠ ä¸“æ³¨è‡ªå·±çš„äº‹æƒ…äº†ï¼Œæ¯”å¦‚å‰ç«¯å¯ä»¥ä½¿ç”¨ä»»ä½•æƒ³è¦çš„å·¥å…·ï¼ˆWebpackã€Gulpç­‰ç­‰ï¼‰ï¼Œåç«¯ä¹Ÿä¸ç”¨å› ä¸ºé›†æˆå‰ç«¯çš„ä»£ç è€Œè‹¦é€¼åŠ ç­äº†ã€‚è¿™é‡Œä¸è®¨è®ºå‰åç«¯åˆ†ç¦»çš„å¿…è¦æ€§ï¼Œæ›´å¤šå¯å‚è€ƒ</p>

<!-- More -->


<ul>
<li><a href="http://2014.jsconf.cn/slides/herman-taobaoweb/#/96">æ·˜å®å‰åç«¯åˆ†ç¦»å®è·µ</a></li>
<li><a href="http://frontenddev.org/column/taobao-full-stack-development/">æ·˜å®å‰åç«¯åˆ†ç¦»ç³»åˆ—æ–‡ç« </a></li>
<li><a href="http://mp.weixin.qq.com/s?__biz=MzAwNjI5MTYyMw==&amp;mid=2651493177&amp;idx=1&amp;sn=730545f530e7d6506b884ab46462169a&amp;scene=7#wechat_redirect">æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å°è¯•å‰åç«¯åˆ†ç¦»</a></li>
</ul>


<p>è¿™é‡Œä¸»è¦åˆ†äº«å‰åç«¯åˆ†ç¦»åï¼Œå¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜</p>

<h2>æœåŠ¡ç«¯</h2>

<h3>Rails</h3>

<p>ä½œä¸ºä¸€ä¸ª<code>Rails</code>ç¨‹åºå‘˜ï¼Œé¦–å…ˆåˆ†äº«ä¸€ä¸‹åœ¨<code>Rails</code>é‡Œé¢çš„è§£å†³æ–¹æ¡ˆ, å¤§å®¶å¯ä»¥ä½¿ç”¨ä¸€ä¸ª<a href="https://github.com/cyu/rack-cors">rack-cors</a> ä¸­é—´ä»¶ï¼Œå¹¶ä½œä»¥ä¸‹é…ç½®:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#config/application.rb</span>
</span><span class='line'>    <span class="n">config</span><span class="o">.</span><span class="n">middleware</span><span class="o">.</span><span class="n">insert_before</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Rack::Cors&quot;</span><span class="p">,</span> <span class="ss">:debug</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:logger</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="o">-&gt;</span> <span class="p">{</span> <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span> <span class="p">})</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">allow</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">origins</span> <span class="o">[</span><span class="s1">&#39;http://localhost:3000&#39;</span><span class="o">]</span>
</span><span class='line'>        <span class="n">resource</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">:headers</span> <span class="o">=&gt;</span> <span class="ss">:any</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">:methods</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">:delete</span><span class="p">,</span> <span class="ss">:put</span><span class="p">,</span> <span class="ss">:options</span><span class="p">,</span> <span class="ss">:head</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">:max_age</span> <span class="o">=&gt;</span> <span class="mi">0</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ›´å¤šé…ç½®è¯·å‚è€ƒ <a href="https://github.com/cyu/rack-cors">rack-cors</a></p>

<h3>Node</h3>

<p>å½“ç„¶ï¼Œå¦‚æœåç«¯æ˜¯<code>NodeJs</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰¾åˆ°åŒæ ·çš„ä¸­é—´ä»¶ <a href="https://github.com/expressjs/cors">cors</a> è¯·çœ‹ä»¥ä¸‹é…ç½®</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">,</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cors&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">,</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// åŒæ ·çš„ï¼Œåªæ”¯æŒå¼€å‘ç¯å¢ƒè·¨åŸŸ</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">==</span> <span class="s1">&#39;development&#39;</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cors</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Nginx</h2>

<p>è¿™æ—¶å€™ï¼Œåç«¯ç¨‹åºå‘˜å¯èƒ½ä¼šè¯´ï¼Œä¸ºäº†ä¿æŒè·Ÿç”Ÿäº§ç¯å¢ƒé…ç½®ä¸€ç›´ï¼Œè¯·ç›´æ¥ç”¨ <code>Nginx</code> æ¥é…ç½®å§ï¼Œè¿™æ ·èƒ½å‡å°‘å·®å¼‚ã€‚å•ªå•¦å•ªå•¦&hellip;
ç›´æ¥çœ‹é…ç½®å§</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>server <span class="o">{</span>
</span><span class='line'>    listen       80<span class="p">;</span>
</span><span class='line'>    <span class="c"># é…ç½®å¯è®¿é—®åŸŸåï¼Œæ³¨æ„éœ€è¦æ·»åŠ ç›¸åº”hosté…ç½®</span>
</span><span class='line'>    server_name xxx.dev<span class="p">;</span>
</span><span class='line'>    <span class="c">#charset koi8-r;</span>
</span><span class='line'>    error_page   <span class="m">500</span> <span class="m">502</span> <span class="m">503</span> <span class="m">504</span>  /50x.html<span class="p">;</span>
</span><span class='line'>    <span class="nv">location</span> <span class="o">=</span> /50x.html <span class="o">{</span>
</span><span class='line'>        root   html<span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    location /api/v1 <span class="o">{</span>
</span><span class='line'>        proxy_set_header Host <span class="nv">$host</span><span class="p">;</span>
</span><span class='line'>        proxy_set_header X-Forwarded-For <span class="nv">$remote_addr</span><span class="p">;</span>
</span><span class='line'>        proxy_set_header X-Real-IP <span class="nv">$remote_addr</span><span class="p">;</span>
</span><span class='line'>        <span class="c"># API Server</span>
</span><span class='line'>        proxy_pass http://localhost:4000<span class="p">;</span>
</span><span class='line'>        proxy_next_upstream error<span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    location / <span class="o">{</span>
</span><span class='line'>        proxy_set_header Host <span class="nv">$host</span><span class="p">;</span>
</span><span class='line'>        proxy_set_header X-Forwarded-For <span class="nv">$remote_addr</span><span class="p">;</span>
</span><span class='line'>        proxy_set_header X-Real-IP <span class="nv">$remote_addr</span><span class="p">;</span>
</span><span class='line'>        <span class="c"># Frontend Server</span>
</span><span class='line'>        proxy_pass http://localhost:3000<span class="p">;</span>
</span><span class='line'>        proxy_next_upstream error<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        proxy_http_version 1.1<span class="p">;</span>
</span><span class='line'>        proxy_set_header Upgrade <span class="nv">$http_upgrade</span><span class="p">;</span>
</span><span class='line'>        proxy_set_header Connection <span class="s2">&quot;upgrade&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>http-proxy-middleware</h2>

<p>è¿™æ—¶å€™å‰ç«¯ä¹Ÿä¸æœäº†ï¼Œè¯´ï¼Œæˆ‘ä»¬è‡ªå·±èƒ½æå®š
PSï¼š å…¶å®è¿™é‡Œç”¨äº†Nginxé…ç½®ä¹‹åï¼Œwebpackçš„hot reloadä¼šå­˜åœ¨æ¯”è¾ƒå¤§çš„å»¶è¿Ÿï¼Œå…·ä½“åŸå› è¿˜æ²¡ç ”ç©¶</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># å®‰è£…æ’ä»¶</span>
</span><span class='line'>cnpm install --save-dev http-proxy-middleware
</span><span class='line'>
</span><span class='line'><span class="c"># æ·»åŠ é…ç½®</span>
</span><span class='line'>import proxy from <span class="s1">&#39;http-proxy-middleware&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>const <span class="nv">apiProxy</span> <span class="o">=</span> proxy<span class="o">(</span><span class="s1">&#39;/api/v1&#39;</span>, <span class="o">{</span>
</span><span class='line'>    target: <span class="s1">&#39;http://localhost:4000&#39;</span>,
</span><span class='line'>    changeOrigin: <span class="nb">true</span>,
</span><span class='line'>    ws: <span class="nb">true</span>
</span><span class='line'><span class="o">})</span><span class="p">;</span>
</span><span class='line'>browserSync<span class="o">({</span>
</span><span class='line'>  server: <span class="o">{</span>
</span><span class='line'>    baseDir: <span class="s1">&#39;src&#39;</span>,
</span><span class='line'>
</span><span class='line'>    middleware: <span class="o">[</span>
</span><span class='line'>      apiProxy,
</span><span class='line'>      ...
</span><span class='line'>    <span class="o">]</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ›´å¤šå‚è€ƒ
- <a href="https://github.com/chimurai/http-proxy-middleware">http-proxy-middelware</a>
- <a href="https://github.com/Justin-lu/react-redux-antd/commit/54699dba93dbcdd61837ade6616d7ca13039cb78">add http-proxy-middleware as api proxy</a></p>

<h2>Chrome</h2>

<p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ chromeæ’ä»¶æ¥æ”¯æŒè·¨åŸŸ
<a href="https://chrome.google.com/webstore/detail/omcncfnpmcabckcddookmnajignpffnh">CORS Toggle</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reddot RubyConf 2016 æ€»ç»“]]></title>
    <link href="http://justin-lu.github.io/blog/2016/06/30/reddot-rubyconf-2016-zong-jie/"/>
    <updated>2016-06-30T17:24:04+08:00</updated>
    <id>http://justin-lu.github.io/blog/2016/06/30/reddot-rubyconf-2016-zong-jie</id>
    <content type="html"><![CDATA[<p>ä»Šå¹´ä»£è¡¨å…¬å¸ï¼ˆ<a href="http://beansmile.com/">Beansmile</a>ï¼‰å‰å¾€æ–°åŠ å¡å‚åŠ <code>Reddot RubyConf</code>, æ”¶è·æ»¡æ»¡ï¼Œè¶ç°åœ¨æœ‰æ—¶é—´ï¼Œç®€å•æ€»ç»“ä¸€ä¸‹ï¼Œä¾›è‡ªå·±æ¥ä¸‹æ¥çš„å­¦ä¹ æ–¹å‘å’Œç›®æ ‡ï¼ŒæŸ¥æ¼è¡¥ç¼ºï¼Œ  ä¹Ÿç»™æœªåˆ°åœºçš„æœ‹å‹åˆ†äº«ä¸€ä¸‹ã€‚
ä»¥ä¸‹å†…å®¹ï¼Œä»…ä¾›å‚è€ƒï¼Œå¦‚è‹¥æœ‰è¯¯ï¼Œè¯·æŒ‡æ­£ã€‚</p>

<!-- More -->


<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ—¥ç¨‹è¡¨</p>

<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f59mpaj2ghj20kz0oa0xg.jpg" alt="" /></p>

<p>æ»¡æ»¡çš„éƒ½æ˜¯å¹²è´§ï¼Œæ»¡æ»¡çš„éƒ½æ˜¯å¤§ç¥ï¼Œçœ‹å¾—æˆ‘é‚£ä¸ªé¸¡å†»~~</p>

<h2>Day 1</h2>

<h3>Yukihiro (Matz) Matsumoto â€“ <a href="https://engineers.sg/v/800">Keynote: Ruby Typing</a></h3>

<blockquote><p><code>Don't care about small things</code></p></blockquote>

<p>ç¬¬ä¸€ä¸ªè®²çš„æ˜¯Rubyä¹‹çˆ¶<code>Matz</code>ï¼Œä»¥Oå‹è¡€çš„äººä¸åœ¨æ„ç»†èŠ‚ï¼Œåˆ†æåŠ¨æ€è¯­è¨€å’Œé™æ€è¯­è¨€çš„åŒºåˆ«å…¥é¢˜, å€Ÿæ­¤å¼•å…¥Ruby 3æ–°Feature<code>Soft Typing</code></p>

<ul>
<li>Types(part of ruby 3)

<ul>
<li><a href="https://en.wikipedia.org/wiki/Duck_typing">Duck typing</a> in ruby(runtime)</li>
<li>Don&rsquo;t check type on Programming</li>
<li>Just care about behavior</li>
<li>example for String.IO</li>
<li>Don&rsquo;t care small things</li>
<li>Soft Typing</li>
<li>Don&rsquo;t challenge 100% coverage</li>
</ul>
</li>
</ul>


<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f59pdhnuysj21kw16otp6.jpg" alt="" /></p>

<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f59xnm36gaj20p00xcq69.jpg" alt="" /></p>

<h3>Jason Yeo â€“ <a href="https://speakerdeck.com/jsyeo/slaying-the-dragon-1">Slaying the Dragon</a></h3>

<ul>
<li>å…ˆè°ƒä¾ƒäº†Matzï¼Œè®¾è®¡äº†<code>Matzlisp</code>çš„<code>Logo</code>ï¼Œæ³¨å†Œäº†<code>matzLisp.org</code>ç­‰ç­‰ã€‚</li>
</ul>


<p><img src="http://ww4.sinaimg.cn/large/785cd1e3gw1f5a5jaw6gfj21jq11qn6v.jpg" alt="" /></p>

<ul>
<li>ç®€å•ä»‹ç»<a href="https://github.com/kanaka/mal">mal</a>çš„ç”¨æ³•,äº†è§£Lispçš„åŸºæœ¬æ¦‚å¿µ</li>
</ul>


<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f5a6xko44vj212i0lcdh4.jpg" alt="" /></p>

<ul>
<li><a href="http://rubinius.com/">Rubinius</a></li>
<li><a href="https://github.com//queenfrankie/lani">lani</a></li>
<li><a href="https://github.com/jsyeo/malady">malady</a></li>
</ul>


<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f59tvw7lm3j21kw16oqjl.jpg" alt="" /></p>

<h3>Kristine Joy Paas â€“ <a href="https://engineers.sg/v/802">Let&rsquo;s Play Ruby Golf</a></h3>

<ul>
<li>å„ç§Rubyé»‘é­”æ³•ï¼Œè¯·è‡ªæˆ‘å¯¹æ¯”ä¸€ä¸‹</li>
</ul>


<p>æ­£å¸¸æƒ…å†µ</p>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f5a7fkhgunj21600swdij.jpg" alt="" /></p>

<p>é»‘é­”æ³•æƒ…å†µä¸‹</p>

<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f5a7h7v0q5j21eo0j0dhg.jpg" alt="" /></p>

<p>è¿™æ˜¯æ­£å¸¸äººçœ‹ä¸æ‡‚çš„ä»£ç ï¼Œæ‰€ä»¥é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™äº›å†™æ³•åœ¨å›¢é˜Ÿéƒ½æ˜¯ä¸æ¨èçš„ï¼Œæƒå½“å­¦ä¹ å“ˆ~</p>

<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f59x8eak14j20zk0jz0t2.jpg" alt="" /></p>

<h3>Prathamesh Sonpatki â€“ <a href="https://speakerdeck.com/chaitanya/secrets-of-testing-rails-5-apps-red-dot-ruby-conf-edition">Secrets of testing Rails 5 apps</a></h3>

<ul>
<li>æ¥è‡ª<a href="https://www.bigbinary.com/">bigbinary</a>çš„åšä¸»ï¼Œåˆ†äº«å…³äºRails5çš„ä¸€äº›å†…å®¹</li>
<li>Rails 5 integration test are default</li>
<li>Rails 5 controller test are deprecated</li>
<li>Active Job Async adapter</li>
</ul>


<p>éœ€è¦äº†è§£æ›´å¤šç»†èŠ‚ï¼Œè¯·å‰å¾€<a href="http://blog.bigbinary.com/categories/Rails-5/">Rails-5</a>ï¼Œé‡Œé¢æ»¡æ»¡çš„éƒ½æ˜¯å¹²è´§ã€‚</p>

<p><img src="http://ww4.sinaimg.cn/large/785cd1e3gw1f59um0rclrj21kw16owxh.jpg" alt="" /></p>

<h3>Godfrey Chan â€“ Keynote (<em>coming soon</em>)</h3>

<ul>
<li>æˆäººä»¥é±¼ä¸å¦‚æˆäººä»¥æ¸”</li>
<li>Probelm Solving</li>
<li>Disruption</li>
<li>The Traditional Path</li>
<li>All abstractions leak</li>
<li>Debugging</li>
</ul>


<p><img src="http://ww4.sinaimg.cn/large/785cd1e3gw1f59ub69y6sj21kw16otrf.jpg" alt="" />
<img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f59udw4s2jj21kw16oae7.jpg" alt="" /></p>

<h3>Grzegorz Witek â€“ <a href="https://speakerdeck.com/arnvald/your-api-is-too-slow">Your API is too slow!</a></h3>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f59uj3f5p7j21kw16o7nl.jpg" alt="" /></p>

<ul>
<li>Web app optimization</li>
</ul>


<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f5a7md4rokj21kw0vygsu.jpg" alt="" /></p>

<ul>
<li>Web API optimization</li>
</ul>


<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f5a7mwny95j21kw0vqwka.jpg" alt="" /></p>

<ul>
<li>gem &lsquo;ruby-prof&rsquo;</li>
<li>gem &lsquo;rack-mini-profiler&rsquo;</li>
<li>gem &lsquo;newrelic&rsquo;</li>
<li>gem &lsquo;skylight&rsquo;</li>
</ul>


<h3><em>Ligtning talks</em></h3>

<h4>Jo Cranford â€“ <a href="https://engineers.sg/v/806">Where Did Everybody Go?</a></h4>

<p>ä¸»è¦æ˜¯é—®å·è°ƒæŸ¥ï¼Œè¯¦æƒ…è¯·çœ‹è§†é¢‘</p>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f59xb2rnc6j20zk0jzwew.jpg" alt="" /></p>

<h4>SHIBATA Hiroshi â€“ <a href="http://www.slideshare.net/hsbt/how-to-begin-developing-ruby-core">How to Begin Developing Ruby Core</a></h4>

<ul>
<li>ä»‹ç»å¦‚ä½•ä¸ºrubyè´¡çŒ®æºç </li>
</ul>


<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f59xbkuta1j20zk0jzgm6.jpg" alt="" /></p>

<h4>Ankita Gupta â€“ <a href="https://engineers.sg/v/808">Speeding Up Your Test Suite</a></h4>

<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f59uo16zyqj21kw16owlx.jpg" alt="" /></p>

<h4>Giovanni Sakti â€“ <a href="https://speakerdeck.com/giosakti/flexible-authorization">Flexible Authorization</a></h4>

<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f59v5y2evjj20xc0p040t.jpg" alt="" /></p>

<h3>Tim Riley â€“ <a href="http://dry-rb.org/resources/reddotrubyconf-2016">Next-generation Ruby web apps with dry-rb, rom-rb, and Roda</a></h3>

<ul>
<li>ç®€å•ä»‹ç»ä¸‹ä¸€ä»£Webæ¡†æ¶<a href="http://dry-rb.org/">dry-rb</a>ï¼ŒåŠå„ç§ä¸»ä»¶</li>
<li><a href="https://github.com/dry-rb">dry-rb</a> æºç </li>
<li><a href="https://github.com/rom-rb/rom">rom-rb</a></li>
<li><a href="https://github.com/jeremyevans/roda">roda</a></li>
<li><a href="https://github.com/dry-rb/dry-web">dry-web</a> - Lightweight web application stack with pluggable routing front-ends</li>
</ul>


<p><img src="http://ww4.sinaimg.cn/large/785cd1e3gw1f59v6oig8xj21kw16oaf9.jpg" alt="" /></p>

<h3>Sau Sheong Chang â€“ <a href="https://speakerdeck.com/sausheong/programming-complexity">Programming Complexity</a></h3>

<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f59ukhlo69j21kw16owxs.jpg" alt="" /></p>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f59uqlvqp5j20xc0p00v0.jpg" alt="" /></p>

<h2>Day 2</h2>

<h3>Aaron Patterson â€“ <a href="https://engineers.sg/v/812">Keynote: Taking Out The Trash</a></h3>

<ul>
<li><a href="https://github.com/tenderlove/widen">https://github.com/tenderlove/widen</a></li>
<li>We don&rsquo;t care about small things, so we are removing downcase in Ruby 2.5</li>
<li>Glossary</li>
<li>Something About GC</li>
<li>Find Unlink Node</li>
<li>Remembered Set</li>
<li>Incremental GC</li>
<li>Algorithm</li>
<li>Compacting</li>
<li>heap layout</li>
<li><a href="https://engineering.heroku.com/blogs/2015-02-04-incremental-gc/">https://engineering.heroku.com/blogs/2015-02-04-incremental-gc/</a></li>
<li>Ruby menmory Page &amp;&amp; OS menmory page</li>
<li>GC::Profiler.report</li>
<li><a href="http://ruby-doc.org/core-2.2.0/GC/Profiler.html">http://ruby-doc.org/core-2.2.0/GC/Profiler.html</a></li>
</ul>


<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f5aphue0c1j21kw16oh2b.jpg" alt="" />
<img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f5apijx905j21kw16otpo.jpg" alt="" /></p>

<h3>Sameer Deshmukh â€“ <a href="https://speakerdeck.com/v0dro/scientific-computing-in-ruby-rdrc-2016">Scientific Computing in Ruby</a></h3>

<ul>
<li>Sameer Deshmukh</li>
<li><a href="http://sciruby.com/">http://sciruby.com/</a></li>
<li><a href="https://github.com/domitry/nyaplot">https://github.com/domitry/nyaplot</a></li>
<li><a href="https://github.com/v0dro/daru">https://github.com/v0dro/daru</a></li>
<li><a href="https://t.co/22I21IxkMx">https://t.co/22I21IxkMx</a></li>
</ul>


<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f5apiwo48pj21kw16owyg.jpg" alt="" /></p>

<h3>Konstantin Hasse â€“ <a href="https://speakerdeck.com/rkh/how-we-replaced-salary-negotiations-with-a-sinatra-app">How We Replaced Salary Negotiations with a Sinatra App</a></h3>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f5apjnax8aj21kw1kwqso.jpg" alt="" />
<img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f5apk02vyfj21kw1kwaz4.jpg" alt="" /></p>

<h3>Vipul Amler â€“ <a href="https://speakerdeck.com/vipulnsward/rails-frontend-2016-edition">Rails Frontend: 2016 edition</a></h3>

<ul>
<li><a href="https://www.bigbinary.com/building-modern-web-applications-with-reactjs">https://www.bigbinary.com/building-modern-web-applications-with-reactjs</a></li>
<li><a href="https://engineering.heroku.com/blogs/2016-02-18-speeding-up-sprockets/">https://engineering.heroku.com/blogs/2016-02-18-speeding-up-sprockets/</a></li>
<li>Sprockets Feature</li>
<li>Headers(ETag,http_cache_forever)</li>
<li>Caching(Action/View/ActionMailer,SQL)</li>
<li>Layouts and Tags(async-defer)</li>
</ul>


<p><img src="http://ww4.sinaimg.cn/large/785cd1e3gw1f5aplexdqhj21kw1kwqqx.jpg" alt="" />
<img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f5aplqljqsj21kw1kwh91.jpg" alt="" /></p>

<h3>Sayanee Basu â€“ <a href="https://talks.sayan.ee/sense">Sense and Sensibility</a></h3>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f5apmj5abqj21kw1kw7sz.jpg" alt="" /></p>

<h3>Yasuko Ohba â€“ <a href="https://engineers.sg/v/817">Our Fight Against Super Bad Patterns in Legacy Rails Apps</a></h3>

<p><img src="http://ww4.sinaimg.cn/large/785cd1e3gw1f5apmunnbfj21kw16owyt.jpg" alt="" /></p>

<h3><em>Lightning talks</em></h3>

<h4>Kenji Mori â€“ <a href="https://speakerdeck.com/morizyun/learning-through-blogging-ruby-blogging-benefits">Learning Through Blogging: Ruby Blogging Benefits</a></h4>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f5aqni6tihj21380tawhe.jpg" alt="" /></p>

<h4>Jack Chen Songyong â€“ <a href="https://speakerdeck.com/aquajach/grow-from-small-simple-steps">Grow from Small Simple Steps</a></h4>

<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f5apyrxhvdj21kw16oaso.jpg" alt="" /></p>

<h4>Yuki Nishijima â€“ <a href="https://speakerdeck.com/yuki24/20-tools-and-techniques-that-make-you-more-creative">20 Tools and Techniques that Make You More Creative</a></h4>

<ul>
<li>gem &ldquo;did you mean/experimental&rdquo;</li>
<li>budnle config &ndash;global jobs 16</li>
<li>app.get &ldquo;/&rdquo;</li>
<li>minitest-power_assert</li>
<li>mv /path/{old, new}.rb/</li>
<li>ctrl + R</li>
<li>tree</li>
<li>ag/ lick ack</li>
<li>curl xxxxx | jq .dependecies.development</li>
<li>pagmentize   alise &lsquo;more&rsquo;=<code>pagmentize -g</code></li>
</ul>


<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f5aq5c3a7lj20zk0qoq4n.jpg" alt="" /></p>

<h4>Steven Yap â€“ <a href="https://engineers.sg/v/821">Building Real-Time App with React/Redux/Rails/RethinkDB</a></h4>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f5aq5tg4cjj20zk0qoq49.jpg" alt="" /></p>

<h4>Xin Tian â€“ <a href="https://engineers.sg/v/822">Journey to becoming a techlady</a></h4>

<p><img src="http://ww4.sinaimg.cn/large/785cd1e3gw1f5aqpgzch4j21kw0udtf2.jpg" alt="" /></p>

<h3>Kir Shatrov â€“ <a href="https://gist.github.com/kirs/a0b69608a96b7845f669822bd7852d9f">Building a ChatOps framework</a></h3>

<ul>
<li><a href="lita">https://github.com/litaio/lita</a></li>
</ul>


<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f5apodvprfj21kw16oh5d.jpg" alt="" /></p>

<h3>Terence Lee - <a href="https://www.youtube.com/watch?v=5WZmE3uXRWw&amp;list=PLECEw2eFfW7iiJpXtb_cYeKv5_A6Pd1tl&amp;index=24">Closing Keynote: After a Decade, Still a Rubyist - RedDotRubyConf 2016</a></h3>

<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f5apov9qcfj21kw16owxi.jpg" alt="" /></p>

<h3>å›¾ç‰‡</h3>

<p>ä¸­å›½å‚ä¼šRubyiståˆç…§</p>

<p><img src="http://ww1.sinaimg.cn/large/785cd1e3jw1f5aptfdeupj21kw16oh5f.jpg" alt="" /></p>

<h4>æ–°åŠ å¡ç¾æ™¯</h4>

<p>å¤œæ™¯
<img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f5apuw09klj21kw16o7qw.jpg" alt="" /></p>

<p>æ ‡å¿—æ€§å»ºç­‘
<img src="http://ww4.sinaimg.cn/large/785cd1e3gw1f5apvdxmqfj21kw16oh7a.jpg" alt="" /></p>

<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f5apw7akyqj21kw16o1kp.jpg" alt="" /></p>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f5apwlsz4mj21kw16o1hv.jpg" alt="" /></p>

<h3>å„ç§èµ„æº</h3>

<h4>å®˜ç½‘</h4>

<ul>
<li><a href="http://www.reddotrubyconf.com/">http://www.reddotrubyconf.com/</a></li>
</ul>


<h4>ç›´æ’­è§†é¢‘</h4>

<ul>
<li><a href="https://www.youtube.com/watch?v=_3sz2Oex2YQ">Day 1</a></li>
<li><a href="https://www.youtube.com/watch?v=nu3oVW1c66A">Day 2</a></li>
<li>å®Œæ•´è§†é¢‘æ’­æ”¾åˆ—è¡¨ ğŸ“º<a href="https://www.youtube.com/playlist?list=PLECEw2eFfW7iiJpXtb_cYeKv5_A6Pd1tl">https://www.youtube.com/playlist?list=PLECEw2eFfW7iiJpXtb_cYeKv5_A6Pd1tl</a></li>
</ul>


<h4><a href="https://gist.github.com/cheeaun/43843c8b1c764825b9f3d63ed8f5bd78">RedDotRubyConf 2016 links &amp; resources</a></h4>

<h4><a href="https://theta360.com/s/mLWd3XTvDsBTQVikyhOtt7wMm">ç°åœº3Då›¾</a></h4>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å¦‚ä½•å‘å¸ƒä¸€ä¸ªNPMåŒ…]]></title>
    <link href="http://justin-lu.github.io/blog/2016/03/27/ru-he-fa-bu-%5B%3F%5D-ge-npmbao/"/>
    <updated>2016-03-27T21:58:10+08:00</updated>
    <id>http://justin-lu.github.io/blog/2016/03/27/ru-he-fa-bu-[?]-ge-npmbao</id>
    <content type="html"><![CDATA[<p>TODO</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CentOS ä¸Šä½¿ç”¨ Nginx Passenger éƒ¨ç½² Ruby on Rails]]></title>
    <link href="http://justin-lu.github.io/blog/2016/03/15/centos-shang-shi-yong-nginx-passenger-bu-shu-ruby-on-rails/"/>
    <updated>2016-03-15T20:04:57+08:00</updated>
    <id>http://justin-lu.github.io/blog/2016/03/15/centos-shang-shi-yong-nginx-passenger-bu-shu-ruby-on-rails</id>
    <content type="html"><![CDATA[<p>æœ¬æ•™ç¨‹å°†ä¼šæ¶‰åŠä»¥ä¸‹å·¥å…·ï¼š</p>

<ul>
<li>Centos 7</li>
<li>[[RVM]]</li>
<li>Ruby 2.2.2</li>
<li>Rails 4.0.3</li>
<li>Passenger 4.0+</li>
<li>Nginxï¼ˆç”± Passenger ç¼–è¯‘ï¼‰</li>
</ul>


<!-- More -->


<h2>åˆ›å»ºå¸å·</h2>

<p>å‡è®¾ä½ å·²ç»ç”¨ root å¸å·é€šè¿‡ SSH ç™»é™†æœåŠ¡å™¨, æ²¡æœ‰ç™»å½•çš„å¯ä»¥é€šè¿‡</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>ssh root@ip
</span></code></pre></td></tr></table></div></figure>


<p>å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä¸è¦ä½¿ç”¨ root å¸å·è¿è¡Œ web åº”ç”¨ã€‚è¿™é‡Œæ–°å»ºä¸€ä¸ªä¸“é—¨ç”¨äºéƒ¨ç½²çš„ç”¨æˆ·ï¼Œä¾‹å¦‚ deploy æˆ–è€…å…¶å®ƒä½ å–œæ¬¢çš„åå­—ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºç”¨æˆ·ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># useradd -m -s /bin/bash deploy</span>
</span></code></pre></td></tr></table></div></figure>


<p>å°†ç”¨æˆ·åŠ å…¥ sudo ç¾¤ç»„ï¼Œä»¥ä¾¿ä½¿ç”¨ sudo å‘½ä»¤ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># adduser deploy sudo</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸º deploy ç”¨æˆ·è®¾ç½®å¯†ç ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># passwd deploy</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸ºdeployç”¨æˆ·æ·»åŠ ç®¡ç†å‘˜æƒé™</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo <span class="nb">echo</span> <span class="s2">&quot;$USER ALL=(ALL:ALL) ALL&quot;</span> &gt;&gt; /etc/sudoers
</span></code></pre></td></tr></table></div></figure>


<p>é€€å‡ºå½“å‰ SSH é“¾æ¥ï¼Œç”¨ deploy å¸å·é‡æ–°ç™»é™†ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>ssh deploy@ip
</span></code></pre></td></tr></table></div></figure>


<h2>å®‰è£… RVM å’Œ Ruby</h2>

<p>æ›´æ–° yumï¼Œå¹¶å®‰è£… curlï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo yum update
</span><span class='line'><span class="nv">$ </span>sudo yum install curl
</span></code></pre></td></tr></table></div></figure>


<p>ç„¶åå®‰è£… RVMï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3
</span><span class='line'><span class="nv">$ </span><span class="se">\c</span>url -sSL https://get.rvm.io <span class="p">|</span> bash -s stable
</span><span class='line'><span class="nv">$ </span>rvm requirements
</span></code></pre></td></tr></table></div></figure>


<p>RVM å®‰è£…å®Œæ¯•åï¼Œé‡æ–°ç™»é™† SSHï¼Œè®© RVM é…ç½®ç”Ÿæ•ˆã€‚ç„¶åå®‰è£… Ruby 2.1.2ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>rvm use --install --default 2.2.2
</span><span class='line'><span class="nv">$ </span>rvm use 2.2.2@deploy --create --default
</span><span class='line'><span class="nv">$ </span>gem install bundle
</span></code></pre></td></tr></table></div></figure>


<p>å®‰è£…å®Œæ¯•åï¼Œç¡®è®¤ç›®å‰çš„ Ruby ç‰ˆæœ¬ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>ruby -v
</span></code></pre></td></tr></table></div></figure>


<p>åº”è¯¥çœ‹åˆ° <code>ruby 2.2.2p95 (2015-04-13 revision 50295) [x86_64-linux]</code> å­—æ ·ã€‚</p>

<h2>å®‰è£… Passenger</h2>

<p><a href="https://www.phusionpassenger.com/">Passenger</a> æ˜¯ä¸€ä¸ª app serverï¼Œæ”¯æŒåŸºäº Rack æ¡†æ¶çš„ Ruby appï¼ˆåŒ…æ‹¬ Railsï¼‰ã€‚Passenger çš„ç‰¹ç‚¹æ˜¯éœ€è¦ä½œä¸ºæ¨¡å—ç¼–è¯‘åˆ° Nginx ä¸­ï¼Œä¼˜ç‚¹æ˜¯é…ç½®ç®€å•ï¼Œä¸éœ€è¦è‡ªå·±å†™å¯åŠ¨è„šæœ¬ã€‚</p>

<p>å®‰è£… Passenger æœ€ç®€å•çš„æ–¹æ³•æ˜¯é€šè¿‡ yum å®‰è£…ï¼Œé¦–å…ˆå¯¼å…¥ Passenger çš„å¯†é’¥ï¼ˆ<a href="https://www.phusionpassenger.com/library/install/nginx/install/oss/el7/">å®˜æ–¹æ–‡æ¡£</a>ï¼‰ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># å®‰è£… EPEL and å’Œå…¶ä»–ä¾èµ–</span>
</span><span class='line'><span class="nv">$ </span>sudo yum install -y epel-release pygpgme curl
</span><span class='line'>
</span><span class='line'><span class="c"># æ·»åŠ el7ä»“åº“</span>
</span><span class='line'><span class="nv">$ </span>sudo curl --fail -sSLo /etc/yum.repos.d/passenger.repo https://oss-binaries.phusionpassenger.com/yum/definitions/el-passenger.repo
</span><span class='line'>
</span><span class='line'><span class="c"># å®‰è£…Passenger å’Œ Nginxï¼Œ ç”±äºä¸‡æ¶çš„å¢™ï¼Œæœ‰å¯èƒ½å¤±è´¥ï¼Œå¤šè¯•å‡ æ¬¡å°±å¯ä»¥</span>
</span><span class='line'><span class="nv">$ </span>sudo yum install -y nginx passenger
</span></code></pre></td></tr></table></div></figure>


<p>ç°åœ¨ä¿®æ”¹ nginx é…ç½®ï¼Œç¼–è¾‘ <code>/etc/nginx/conf.d/passenger.conf</code>ï¼Œæ‰¾åˆ°è¿™ä¸‰è¡Œæ³¨é‡Šï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#passenger_root /usr/share/ruby/vendor_ruby/phusion_passenger/locations.ini;</span>
</span><span class='line'><span class="c">#passenger_ruby /usr/bin/ruby;</span>
</span><span class='line'><span class="c">#passenger_instance_registry_dir /var/run/passenger-instreg;</span>
</span></code></pre></td></tr></table></div></figure>


<p>å°†å®ƒä¿®æ”¹ä¸ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>passenger_root /usr/share/ruby/vendor_ruby/phusion_passenger/locations.ini<span class="p">;</span>
</span><span class='line'>passenger_ruby /usr/bin/ruby<span class="p">;</span>
</span><span class='line'>passenger_instance_registry_dir /var/run/passenger-instreg<span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>é‡å¯Nginx:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo service nginx restart
</span></code></pre></td></tr></table></div></figure>


<p>æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo passenger-config validate-install
</span></code></pre></td></tr></table></div></figure>


<p>æŸ¥çœ‹nginxå’Œpassgenræ˜¯å¦è¿è¡ŒæˆåŠŸ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo passenger-memory-stats
</span></code></pre></td></tr></table></div></figure>


<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªï¼Œè¯´æ˜å·²ç»æˆåŠŸè¿è¡Œ</p>

<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f1xto1spynj20w40hcwhy.jpg" alt="" /></p>

<h2>å®‰è£…Nodejs</h2>

<p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-a-centos-7-server">https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-a-centos-7-server</a></p>

<h2>éƒ¨ç½²<code>Rails</code>é¡¹ç›®</h2>

<h3>æ–°å»º<code>Rails</code>é¡¹ç›®</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">rails</span> <span class="kp">new</span> <span class="n">app</span>
</span><span class='line'><span class="err">$</span> <span class="n">cd</span> <span class="n">app</span>
</span><span class='line'><span class="err">$</span> <span class="n">bundle</span> <span class="n">install</span>
</span></code></pre></td></tr></table></div></figure>


<h3>æ‰“å¼€<code>Gemfile</code>æ–‡ä»¶ï¼Œåœ¨<code>Gemfile</code>çš„<code>development</code>å’Œ<code>test</code>group æ·»åŠ <code>capistrano</code>å’Œ<code>rvm-capistrano</code></h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">group</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># Use Capistrano for deployment</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;capistrano&#39;</span><span class="p">,</span> <span class="s2">&quot;~&gt; 2.15.5&quot;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;rvm-capistrano&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 1.4.1&#39;</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="kp">false</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ç”Ÿæˆ<code>cap</code>æ–‡ä»¶,åœ¨ç»ˆç«¯è¿è¡Œï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆ<code>Capfile</code>å’Œ<code>config/deploy.rb</code></h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>capify .
</span></code></pre></td></tr></table></div></figure>


<h3>ä¿®æ”¹<code>deploy</code>æ–‡ä»¶ï¼Œé…ç½®é¡¹å°±ä¸é€ä¸€ä»‹ç»äº†ï¼Œå¯ä»¥é˜…è¯» Capistrano çš„æ–‡æ¡£ 2.x Getting Startedã€‚ä¸»è¦æ˜¯ä¿®æ”¹ :rvm_ruby_string å’Œ :repository ä¸¤ä¸ªï¼Œå…¶å®ƒå†æŒ‰éœ€ä¿®æ”¹ã€‚</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rvm/capistrano&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="ss">:rvm_type</span><span class="p">,</span> <span class="ss">:user</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># repo details</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:scm</span><span class="p">,</span> <span class="ss">:git</span>
</span><span class='line'><span class="c1"># need to clean shared/cached-copy if changed repository</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:repository</span><span class="p">,</span> <span class="s2">&quot;your repository url&quot;</span>
</span><span class='line'><span class="c1"># set :branch, &quot;master&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:git_enable_submodules</span><span class="p">,</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># bundler bootstrap</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;bundler/capistrano&#39;</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:bundle_without</span><span class="p">,</span> <span class="o">[</span><span class="ss">:darwin</span><span class="p">,</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Multi stage</span>
</span><span class='line'><span class="c1"># https://github.com/capistrano/capistrano/wiki/2.x-Multistage-Extension</span>
</span><span class='line'><span class="c1"># https://github.com/VinceMD/Scem/wiki/Deploying-on-production</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:stages</span><span class="p">,</span> <span class="sx">%w(production)</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:default_stage</span><span class="p">,</span> <span class="s2">&quot;production&quot;</span> <span class="c1"># require config/deploy/staging.rb</span>
</span><span class='line'><span class="c1"># set :default_stage, &quot;production&quot; # require config/deploy/production.rb</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;capistrano/ext/multistage&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># server details</span>
</span><span class='line'><span class="n">default_run_options</span><span class="o">[</span><span class="ss">:pty</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span> <span class="c1"># apparently helps with passphrase prompting</span>
</span><span class='line'><span class="n">ssh_options</span><span class="o">[</span><span class="ss">:forward_agent</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span> <span class="c1"># tells cap to use my local private key</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:deploy_via</span><span class="p">,</span> <span class="ss">:remote_cache</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:use_sudo</span><span class="p">,</span> <span class="kp">false</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># integrate whenever</span>
</span><span class='line'><span class="c1"># when using bundler</span>
</span><span class='line'><span class="c1"># set :whenever_command, &quot;bundle exec whenever&quot;</span>
</span><span class='line'><span class="c1"># when using different environments</span>
</span><span class='line'><span class="c1"># set :whenever_environment, defer { stage }</span>
</span><span class='line'><span class="c1"># set :whenever_identifier, defer { &quot;#{fetch(:application)}-#{fetch(:rails_env)}&quot; }</span>
</span><span class='line'><span class="c1"># require &quot;whenever/capistrano&quot;</span>
</span><span class='line'><span class="c1"># https://github.com/javan/whenever/blob/master/lib/whenever/capistrano.rb</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># tasks</span>
</span><span class='line'><span class="n">namespace</span> <span class="ss">:deploy</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:start</span><span class="p">,</span> <span class="ss">:roles</span> <span class="o">=&gt;</span> <span class="ss">:app</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">run</span> <span class="s2">&quot;touch </span><span class="si">#{</span><span class="n">current_path</span><span class="si">}</span><span class="s2">/tmp/restart.txt&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:stop</span><span class="p">,</span> <span class="ss">:roles</span> <span class="o">=&gt;</span> <span class="ss">:app</span> <span class="k">do</span>
</span><span class='line'>    <span class="c1"># Do nothing.</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;Restart Application&quot;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:restart</span><span class="p">,</span> <span class="ss">:roles</span> <span class="o">=&gt;</span> <span class="ss">:app</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">run</span> <span class="s2">&quot;touch </span><span class="si">#{</span><span class="n">current_path</span><span class="si">}</span><span class="s2">/tmp/restart.txt&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;Symlink shared resources on each release&quot;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:symlink_shared</span><span class="p">,</span> <span class="ss">:roles</span> <span class="o">=&gt;</span> <span class="ss">:app</span> <span class="k">do</span>
</span><span class='line'>    <span class="sx">%w{database settings.local}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
</span><span class='line'>      <span class="n">run</span> <span class="s2">&quot;ln -nfs </span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/config/</span><span class="si">#{</span><span class="n">file</span><span class="si">}</span><span class="s2">.yml </span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="s2">/config/</span><span class="si">#{</span><span class="n">file</span><span class="si">}</span><span class="s2">.yml&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># link dirs in public/</span>
</span><span class='line'>    <span class="sx">%w{uploads}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">dir</span><span class="o">|</span>
</span><span class='line'>      <span class="n">run</span> <span class="s2">&quot;mkdir -p </span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/public/</span><span class="si">#{</span><span class="n">dir</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="n">run</span> <span class="s2">&quot;ln -nfs </span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/public/</span><span class="si">#{</span><span class="n">dir</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="s2">/public/</span><span class="si">#{</span><span class="n">dir</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;Initialize configuration using example files provided in the distribution&quot;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:upload_config</span> <span class="k">do</span>
</span><span class='line'>    <span class="sx">%w{config}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">dir</span><span class="o">|</span>
</span><span class='line'>      <span class="n">run</span> <span class="s2">&quot;mkdir -p </span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">dir</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="no">Dir</span><span class="o">[</span><span class="s2">&quot;config/*.yml.example&quot;</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
</span><span class='line'>      <span class="n">top</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="n">file</span><span class="p">),</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/config/</span><span class="si">#{</span><span class="no">File</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;.example&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">desc</span> <span class="s1">&#39;Visit the app&#39;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:visit_web</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">system</span> <span class="s2">&quot;open </span><span class="si">#{</span><span class="n">app_url</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">after</span> <span class="s1">&#39;deploy:setup&#39;</span><span class="p">,</span> <span class="s1">&#39;deploy:upload_config&#39;</span>
</span><span class='line'><span class="n">after</span> <span class="s1">&#39;deploy:update_code&#39;</span><span class="p">,</span> <span class="s1">&#39;deploy:symlink_shared&#39;</span>
</span><span class='line'><span class="n">after</span> <span class="s1">&#39;deploy:restart&#39;</span><span class="p">,</span> <span class="s1">&#39;deploy:visit_web&#39;</span>
</span><span class='line'><span class="n">after</span> <span class="s1">&#39;deploy:migrations&#39;</span><span class="p">,</span> <span class="s1">&#39;deploy:cleanup&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="ss">:keep_releases</span><span class="p">,</span> <span class="mi">7</span> <span class="c1"># number for keeping old releases</span>
</span><span class='line'><span class="n">after</span> <span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="s1">&#39;deploy:cleanup&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">namespace</span> <span class="ss">:db</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;Create db for current env&quot;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:create</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">run</span> <span class="s2">&quot;cd </span><span class="si">#{</span><span class="n">current_path</span><span class="si">}</span><span class="s2">; bundle exec rake db:create RAILS_ENV=</span><span class="si">#{</span><span class="n">rails_env</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s1">&#39;could be able to run `cap deploy:migrate` now&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;Populates the Production Database&quot;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:seed</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">=== Populating the Production Database! ===</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="n">run</span> <span class="s2">&quot;cd </span><span class="si">#{</span><span class="n">current_path</span><span class="si">}</span><span class="s2">; bundle exec rake db:seed RAILS_ENV=</span><span class="si">#{</span><span class="n">rails_env</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># http://guides.rubyonrails.org/asset_pipeline.html#precompiling-assets</span>
</span><span class='line'><span class="c1"># https://github.com/capistrano/capistrano/blob/master/lib/capistrano/recipes/deploy/assets.rb</span>
</span><span class='line'><span class="nb">load</span> <span class="s1">&#39;deploy/assets&#39;</span> <span class="k">unless</span> <span class="p">(</span><span class="no">ARGV</span><span class="o">.</span><span class="n">join</span> <span class="o">==</span> <span class="s2">&quot;deploy:update&quot;</span> <span class="o">||</span> <span class="no">ARGV</span><span class="o">.</span><span class="n">last</span> <span class="o">==</span> <span class="s1">&#39;deploy:update&#39;</span><span class="p">)</span>
</span><span class='line'><span class="c1"># then we got these tasks:</span>
</span><span class='line'><span class="c1"># cap deploy:assets:clean      # Run the asset clean rake task.</span>
</span><span class='line'><span class="c1"># cap deploy:assets:precompile # Run the asset precompilation rake task.</span>
</span><span class='line'><span class="n">namespace</span> <span class="ss">:remote</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;Open the rails console on one of the remote servers&quot;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:console</span><span class="p">,</span> <span class="ss">:roles</span> <span class="o">=&gt;</span> <span class="ss">:app</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">hostname</span> <span class="o">=</span> <span class="n">find_servers_for_task</span><span class="p">(</span><span class="n">current_task</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'>    <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;cd </span><span class="si">#{</span><span class="n">current_path</span><span class="si">}</span><span class="s2"> &amp;&amp; bundle exec rails console </span><span class="si">#{</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:rails_env</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">fetch</span><span class="p">(</span><span class="ss">:rvm_ruby_string</span><span class="p">)</span>
</span><span class='line'>      <span class="c1"># set rvm shell and get ride of &quot;&#39;&quot;</span>
</span><span class='line'>      <span class="c1"># https://github.com/wayneeseguin/rvm/blob/master/lib/rvm/capistrano.rb</span>
</span><span class='line'>      <span class="n">rvm_shell</span> <span class="o">=</span> <span class="sx">%{rvm_path=$HOME/.rvm $HOME/.rvm/bin/rvm-shell &quot;</span><span class="si">#{</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:rvm_ruby_string</span><span class="p">)</span><span class="si">}</span><span class="sx">&quot;}</span>
</span><span class='line'>      <span class="n">command</span> <span class="o">=</span> <span class="sx">%{</span><span class="si">#{</span><span class="n">rvm_shell</span><span class="si">}</span><span class="sx"> -c &quot;</span><span class="si">#{</span><span class="n">command</span><span class="si">}</span><span class="sx">&quot;}</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="n">command</span> <span class="o">=</span> <span class="sx">%{source ~/.profile &amp;&amp; &quot;</span><span class="si">#{</span><span class="n">command</span><span class="si">}</span><span class="sx">&quot;}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="nb">exec</span> <span class="sx">%{ssh -l </span><span class="si">#{</span><span class="n">user</span><span class="si">}</span><span class="sx"> </span><span class="si">#{</span><span class="n">hostname</span><span class="si">}</span><span class="sx"> -t &#39;</span><span class="si">#{</span><span class="n">command</span><span class="si">}</span><span class="sx">&#39;}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;run rake task. e.g.: `cap remote:rake db:version`&quot;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:rake</span> <span class="k">do</span>
</span><span class='line'>    <span class="no">ARGV</span><span class="o">.</span><span class="n">values_at</span><span class="p">(</span><span class="no">Range</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">ARGV</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;remote:rake&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">rake_task</span><span class="o">|</span>
</span><span class='line'>      <span class="n">top</span><span class="o">.</span><span class="n">run</span> <span class="s2">&quot;cd </span><span class="si">#{</span><span class="n">current_path</span><span class="si">}</span><span class="s2"> &amp;&amp; RAILS_ENV=</span><span class="si">#{</span><span class="n">rails_env</span><span class="si">}</span><span class="s2"> bundle exec rake </span><span class="si">#{</span><span class="n">rake_task</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;run remote command. e.g.: `cap remote:run &#39;tail -n 10 log/production.log&#39;`&quot;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:run</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">command</span> <span class="o">=</span> <span class="no">ARGV</span><span class="o">.</span><span class="n">values_at</span><span class="p">(</span><span class="no">Range</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">ARGV</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;remote:run&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span class='line'>    <span class="n">top</span><span class="o">.</span><span class="n">run</span> <span class="s2">&quot;cd </span><span class="si">#{</span><span class="n">current_path</span><span class="si">}</span><span class="s2">; RAILS_ENV=</span><span class="si">#{</span><span class="n">rails_env</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">command</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">desc</span> <span class="s1">&#39;run specified rails code on server. e.g.: `cap remote:runner p User.all` or `cap remote:runner &quot;User.all.each{ |u| p u }&quot;`&#39;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:runner</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">command</span><span class="o">=</span><span class="no">ARGV</span><span class="o">.</span><span class="n">values_at</span><span class="p">(</span><span class="no">Range</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">ARGV</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;remote:runner&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span class='line'>    <span class="n">top</span><span class="o">.</span><span class="n">run</span> <span class="s2">&quot;cd </span><span class="si">#{</span><span class="n">current_path</span><span class="si">}</span><span class="s2">; RAILS_ENV=</span><span class="si">#{</span><span class="n">rails_env</span><span class="si">}</span><span class="s2"> bundle exec rails runner &#39;</span><span class="si">#{</span><span class="n">command</span><span class="o">*</span><span class="s1">&#39; &#39;</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span class='line'>    <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;tail log on remote server&quot;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:tail_log</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">top</span><span class="o">.</span><span class="n">run</span> <span class="s2">&quot;tail -f </span><span class="si">#{</span><span class="n">current_path</span><span class="si">}</span><span class="s2">/log/</span><span class="si">#{</span><span class="n">rails_env</span><span class="si">}</span><span class="s2">.log&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">channel</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">data</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="k">break</span> <span class="k">if</span> <span class="n">stream</span> <span class="o">==</span> <span class="ss">:err</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">namespace</span> <span class="ss">:update</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;Dump remote database into tmp/, download file to local machine, import into local database&quot;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:database</span> <span class="k">do</span>
</span><span class='line'>    <span class="c1"># config</span>
</span><span class='line'>    <span class="n">remote_db_yml_path</span>          <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/config/database.yml&quot;</span>
</span><span class='line'>    <span class="n">remote_db_yml_on_local_path</span> <span class="o">=</span> <span class="s2">&quot;tmp/database_</span><span class="si">#{</span><span class="n">rails_env</span><span class="si">}</span><span class="s2">.yml&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># First lets get the remote database config file so that we can read in the database settings</span>
</span><span class='line'>    <span class="n">get</span> <span class="n">remote_db_yml_path</span><span class="p">,</span> <span class="n">remote_db_yml_on_local_path</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># load the remote settings within the database file</span>
</span><span class='line'>    <span class="n">remote_settings</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">::</span><span class="n">load_file</span><span class="p">(</span><span class="n">remote_db_yml_on_local_path</span><span class="p">)</span><span class="o">[</span><span class="n">rails_env</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">remote_sql_file_path</span>        <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">current_path</span><span class="si">}</span><span class="s2">/tmp/</span><span class="si">#{</span><span class="n">rails_env</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="n">remote_settings</span><span class="o">[</span><span class="s2">&quot;database&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">-dump.sql&quot;</span>
</span><span class='line'>    <span class="n">remote_sql_gz_file_path</span>     <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">remote_sql_file_path</span><span class="si">}</span><span class="s2">.gz&quot;</span>
</span><span class='line'>    <span class="n">local_sql_file_path</span>         <span class="o">=</span> <span class="s2">&quot;tmp/</span><span class="si">#{</span><span class="n">rails_env</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="n">remote_settings</span><span class="o">[</span><span class="s2">&quot;database&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-%d_%H:%M:%S&quot;</span><span class="p">)</span><span class="si">}</span><span class="s2">.sql&quot;</span>
</span><span class='line'>    <span class="n">local_sql_gz_file_path</span>      <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">local_sql_file_path</span><span class="si">}</span><span class="s2">.gz&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># we also need the local settings so that we can import the fresh database properly</span>
</span><span class='line'>    <span class="n">local_settings</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">::</span><span class="n">load_file</span><span class="p">(</span><span class="s2">&quot;config/database.yml&quot;</span><span class="p">)</span><span class="o">[</span><span class="n">rails_env</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># dump the remote database and store it in the current path&#39;s tmp directory.</span>
</span><span class='line'>    <span class="n">run</span> <span class="s2">&quot;mysqldump -u&#39;</span><span class="si">#{</span><span class="n">remote_settings</span><span class="o">[</span><span class="s2">&quot;username&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">&#39; -p&#39;</span><span class="si">#{</span><span class="n">remote_settings</span><span class="o">[</span><span class="s2">&quot;password&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">&#39; </span><span class="si">#{</span><span class="s2">&quot;-h &#39;</span><span class="si">#{</span><span class="n">remote_settings</span><span class="o">[</span><span class="s2">&quot;host&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">if</span> <span class="n">remote_settings</span><span class="o">[</span><span class="s2">&quot;host&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2"> &#39;</span><span class="si">#{</span><span class="n">remote_settings</span><span class="o">[</span><span class="s2">&quot;database&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">&#39; &gt; </span><span class="si">#{</span><span class="n">remote_sql_file_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># gzip db</span>
</span><span class='line'>    <span class="n">run</span> <span class="s2">&quot;gzip -f </span><span class="si">#{</span><span class="n">remote_sql_file_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># download gz file to local</span>
</span><span class='line'>    <span class="n">get</span> <span class="n">remote_sql_gz_file_path</span><span class="p">,</span> <span class="n">local_sql_gz_file_path</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># unzip sql</span>
</span><span class='line'>    <span class="n">run_locally</span> <span class="s2">&quot;gunzip </span><span class="si">#{</span><span class="n">local_sql_gz_file_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># import db to local db</span>
</span><span class='line'>    <span class="c1"># may need to run `RAILS_ENV=production rake db:create` on local first</span>
</span><span class='line'>    <span class="n">run_locally</span><span class="p">(</span><span class="s2">&quot;mysql -u</span><span class="si">#{</span><span class="n">local_settings</span><span class="o">[</span><span class="s2">&quot;username&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="s2">&quot;-p</span><span class="si">#{</span><span class="n">local_settings</span><span class="o">[</span><span class="s2">&quot;password&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">local_settings</span><span class="o">[</span><span class="s2">&quot;password&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">local_settings</span><span class="o">[</span><span class="s2">&quot;database&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">#{</span><span class="n">local_sql_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># now that we have the upated production dump file we should use the local settings to import this db.</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;Mirrors the remote shared public directory with your local copy, doesn&#39;t download symlinks&quot;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:shared_assets</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">run_locally</span> <span class="s2">&quot;if [ -e public/uploads ]; then mv public/uploads public/uploads_back; fi&quot;</span>
</span><span class='line'>    <span class="c1"># using rsync so that it only copies what it needs</span>
</span><span class='line'>    <span class="n">run_locally</span><span class="p">(</span><span class="s2">&quot;rsync --recursive --times --rsh=ssh --compress --human-readable --progress </span><span class="si">#{</span><span class="n">user</span><span class="si">}</span><span class="s2">@</span><span class="si">#{</span><span class="n">app_server</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/system/ public/system/&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">run_locally</span><span class="p">(</span><span class="s2">&quot;rsync --recursive --times --rsh=ssh --compress --human-readable --progress </span><span class="si">#{</span><span class="n">user</span><span class="si">}</span><span class="s2">@</span><span class="si">#{</span><span class="n">app_server</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/public/uploads/ public/uploads/&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">namespace</span> <span class="ss">:remote</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">desc</span> <span class="s2">&quot;update the remote database with the local database&quot;</span>
</span><span class='line'>    <span class="n">task</span> <span class="ss">:database</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">input</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>      <span class="c1"># STDOUT.puts &quot;Are you SURE to update the databse of remote?(YES)&quot;</span>
</span><span class='line'>      <span class="c1"># confirmation = STDIN.gets.chomp</span>
</span><span class='line'>      <span class="n">confirmation</span> <span class="o">=</span> <span class="no">Capistrano</span><span class="o">::</span><span class="no">CLI</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s2">&quot;Are you SURE to update the databse of remote?(YES)&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">abort</span> <span class="s2">&quot;Interrupt..&quot;</span> <span class="k">unless</span> <span class="n">confirmation</span> <span class="o">==</span> <span class="s2">&quot;YES&quot;</span>
</span><span class='line'>      <span class="c1"># config database.yml on both sides</span>
</span><span class='line'>      <span class="n">remote_db_yml_path</span>          <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/config/database.yml&quot;</span>
</span><span class='line'>      <span class="n">remote_db_yml_on_local_path</span> <span class="o">=</span> <span class="s2">&quot;tmp/database_</span><span class="si">#{</span><span class="n">rails_env</span><span class="si">}</span><span class="s2">.yml&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># First get the local database config to remote</span>
</span><span class='line'>      <span class="n">get</span> <span class="n">remote_db_yml_path</span><span class="p">,</span> <span class="n">remote_db_yml_on_local_path</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># load the local settings within the database file</span>
</span><span class='line'>      <span class="n">local_settings</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">::</span><span class="n">load_file</span><span class="p">(</span><span class="s2">&quot;config/database.yml&quot;</span><span class="p">)</span><span class="o">[</span><span class="n">rails_env</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># set the sql path on both sides</span>
</span><span class='line'>      <span class="n">local_sql_file_path</span> <span class="o">=</span> <span class="s2">&quot;tmp/</span><span class="si">#{</span><span class="n">rails_env</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="n">local_settings</span><span class="o">[</span><span class="s1">&#39;database&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">-dump.sql&quot;</span>
</span><span class='line'>      <span class="n">local_sql_gz_file_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">local_sql_file_path</span><span class="si">}</span><span class="s2">.gz&quot;</span>
</span><span class='line'>      <span class="n">remote_sql_file_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">current_path</span><span class="si">}</span><span class="s2">/tmp/</span><span class="si">#{</span><span class="n">rails_env</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="n">local_settings</span><span class="o">[</span><span class="s1">&#39;database&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-%d_%H:%M:%S&quot;</span><span class="p">)</span><span class="si">}</span><span class="s2">.sql&quot;</span>
</span><span class='line'>      <span class="n">remote_sql_gz_file_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">remote_sql_file_path</span><span class="si">}</span><span class="s2">.gz&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># we also need the remote settings so that we can import the fresh dataabse properly</span>
</span><span class='line'>      <span class="n">remote_settings</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">::</span><span class="n">load_file</span><span class="p">(</span><span class="n">remote_db_yml_on_local_path</span><span class="p">)</span><span class="o">[</span><span class="n">rails_env</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># dump the local database and store it in the tmp dir</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">local_settings</span><span class="o">[</span><span class="s1">&#39;adapter&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;postgresql&#39;</span>
</span><span class='line'>        <span class="n">run_locally</span> <span class="s2">&quot;PGPASSWORD=&#39;</span><span class="si">#{</span><span class="n">local_settings</span><span class="o">[</span><span class="s1">&#39;password&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&#39; pg_dump  -U </span><span class="si">#{</span><span class="n">local_settings</span><span class="o">[</span><span class="s2">&quot;username&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="s2">&quot;-h &#39;</span><span class="si">#{</span><span class="n">local_settings</span><span class="o">[</span><span class="s2">&quot;host&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">if</span> <span class="n">local_settings</span><span class="o">[</span><span class="s2">&quot;host&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2"> -c -O &#39;</span><span class="si">#{</span><span class="n">local_settings</span><span class="o">[</span><span class="s2">&quot;database&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">&#39; &gt; </span><span class="si">#{</span><span class="n">local_sql_file_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="k">elsif</span> <span class="n">local_settings</span><span class="o">[</span><span class="s1">&#39;adapter&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;mysql2&#39;</span>
</span><span class='line'>        <span class="n">run_locally</span> <span class="s2">&quot;mysqldump -u&#39;</span><span class="si">#{</span><span class="n">local_settings</span><span class="o">[</span><span class="s2">&quot;username&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">&#39; </span><span class="si">#{</span><span class="s2">&quot;-p</span><span class="si">#{</span><span class="n">local_settings</span><span class="o">[</span><span class="s2">&quot;password&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">local_settings</span><span class="o">[</span><span class="s2">&quot;password&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="s2">&quot;-h &#39;</span><span class="si">#{</span><span class="n">local_settings</span><span class="o">[</span><span class="s2">&quot;host&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">if</span> <span class="n">local_settings</span><span class="o">[</span><span class="s2">&quot;host&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2"> &#39;</span><span class="si">#{</span><span class="n">local_settings</span><span class="o">[</span><span class="s2">&quot;database&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">&#39; &gt; </span><span class="si">#{</span><span class="n">local_sql_file_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="k">raise</span> <span class="s2">&quot;not supports </span><span class="si">#{</span><span class="n">local_settings</span><span class="o">[</span><span class="s1">&#39;adapter&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># gzip db</span>
</span><span class='line'>      <span class="n">run_locally</span> <span class="s2">&quot;gzip -f </span><span class="si">#{</span><span class="n">local_sql_file_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># send the gz file to remote</span>
</span><span class='line'>      <span class="n">upload</span> <span class="n">local_sql_gz_file_path</span><span class="p">,</span> <span class="n">remote_sql_gz_file_path</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># unzip sql</span>
</span><span class='line'>      <span class="n">run</span> <span class="s2">&quot;gunzip </span><span class="si">#{</span><span class="n">remote_sql_gz_file_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># import db to remote db</span>
</span><span class='line'>      <span class="c1"># may need to run `RAILS_ENV=production rake db:create` on remote first</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">local_settings</span><span class="o">[</span><span class="s1">&#39;adapter&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;postgresql&#39;</span>
</span><span class='line'>        <span class="n">run</span> <span class="s2">&quot;PGPASSWORD=&#39;</span><span class="si">#{</span><span class="n">remote_settings</span><span class="o">[</span><span class="s1">&#39;password&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&#39; psql -U </span><span class="si">#{</span><span class="n">remote_settings</span><span class="o">[</span><span class="s1">&#39;username&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"> -d </span><span class="si">#{</span><span class="n">remote_settings</span><span class="o">[</span><span class="s2">&quot;database&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2"> -f </span><span class="si">#{</span><span class="n">remote_sql_file_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="k">elsif</span> <span class="n">local_settings</span><span class="o">[</span><span class="s1">&#39;adapter&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;mysql2&#39;</span>
</span><span class='line'>        <span class="n">run</span> <span class="s2">&quot;mysql -u</span><span class="si">#{</span><span class="n">remote_settings</span><span class="o">[</span><span class="s2">&quot;username&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="s2">&quot;-p</span><span class="si">#{</span><span class="n">remote_settings</span><span class="o">[</span><span class="s2">&quot;password&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">remote_settings</span><span class="o">[</span><span class="s2">&quot;password&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">remote_settings</span><span class="o">[</span><span class="s2">&quot;database&quot;</span><span class="o">]</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">#{</span><span class="n">remote_sql_file_path</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="k">raise</span> <span class="s2">&quot;not supports </span><span class="si">#{</span><span class="n">local_settings</span><span class="o">[</span><span class="s1">&#39;adapter&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># now that we have the updated production dump file we should use the remote settings to import this db</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">desc</span> <span class="s2">&quot;Mirrors the local shared public directory with the remote copy, doesn&#39;t download symlinks&quot;</span>
</span><span class='line'>    <span class="n">task</span> <span class="ss">:shared_assets</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">run</span> <span class="s2">&quot;cp -R </span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/system </span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/system_back&quot;</span>
</span><span class='line'>      <span class="n">run</span> <span class="s2">&quot;cp -R </span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/public/uploads/ </span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/public/uploads_back&quot;</span>
</span><span class='line'>      <span class="n">run_locally</span><span class="p">(</span><span class="s2">&quot;rsync --recursive --times --rsh=ssh --compress --human-readable --progress public/system </span><span class="si">#{</span><span class="n">user</span><span class="si">}</span><span class="s2">@</span><span class="si">#{</span><span class="n">app_server</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">run_locally</span><span class="p">(</span><span class="s2">&quot;rsync --recursive --times --rsh=ssh --compress --human-readable --progress public/uploads/ </span><span class="si">#{</span><span class="n">user</span><span class="si">}</span><span class="s2">@</span><span class="si">#{</span><span class="n">app_server</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/public/uploads&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>æ·»åŠ <code>deploy/production.rb</code>,å¹¶å¡«å†™ä»¥ä¸‹å†…å®¹</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># config/deploy/production.rb</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:app_server</span><span class="p">,</span> <span class="s2">&quot;æœåŠ¡å™¨åœ°å€&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:app_url</span><span class="p">,</span> <span class="s2">&quot;æœåŠ¡å™¨ç½‘å€&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:application</span><span class="p">,</span> <span class="n">app_server</span>
</span><span class='line'><span class="n">role</span> <span class="ss">:web</span><span class="p">,</span> <span class="n">app_server</span>
</span><span class='line'><span class="n">role</span> <span class="ss">:app</span><span class="p">,</span> <span class="n">app_server</span>
</span><span class='line'><span class="n">role</span> <span class="ss">:db</span><span class="p">,</span>  <span class="n">app_server</span><span class="p">,</span> <span class="ss">:primary</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:deploy_to</span><span class="p">,</span> <span class="s2">&quot;/var/www/xxx&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:user</span><span class="p">,</span> <span class="s2">&quot;deploy&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:rvm_ruby_string</span><span class="p">,</span> <span class="s2">&quot;ruby-2.2.2&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:branch</span><span class="p">,</span> <span class="s2">&quot;master&quot;</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:rails_env</span><span class="p">,</span> <span class="s2">&quot;productiono&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>æ·»åŠ <code>database.yml.example</code></h3>

<p><code>config/database.yml</code>æ–‡ä»¶æ˜¯ä¸åº”è¯¥è¢«æäº¤åˆ°ä»£ç åº“çš„ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ config/database.yml.example æ¥åšæ ·æœ¬ï¼Œåœ¨éƒ¨ç½²çš„æ—¶å€™å®ƒä¼šè¢«ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ /path_to_your_site/shared/config/ ç›®å½•é‡Œï¼Œç„¶å SSH åˆ°æœåŠ¡å™¨ä¸Šä¿®æ”¹ username, password, socket ç­‰å€¼ï¼ˆä¸Šä¼ çš„åŠ¨ä½œæ˜¯åœ¨æµ‹è¯•éƒ¨ç½²é‡Œè¯´æ˜ï¼‰ã€‚å°¤å…¶æ³¨æ„ MySQL socket çš„è·¯å¾„åœ¨ Mac OS å’Œ Ubuntu ç³»ç»Ÿä¸Šæ˜¯ä¸åŒçš„ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># SQLite version 3.x</span>
</span><span class='line'><span class="c1">#   gem install sqlite3</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1">#   Ensure the SQLite 3 gem is defined in your Gemfile</span>
</span><span class='line'><span class="c1">#   gem &#39;sqlite3&#39;</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="ss">default</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">default</span>
</span><span class='line'>  <span class="ss">adapter</span><span class="p">:</span> <span class="n">sqlite3</span>
</span><span class='line'>  <span class="ss">pool</span><span class="p">:</span> <span class="mi">5</span>
</span><span class='line'>  <span class="ss">timeout</span><span class="p">:</span> <span class="mi">5000</span>
</span><span class='line'>
</span><span class='line'><span class="ss">development</span><span class="p">:</span>
</span><span class='line'>  <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">default</span>
</span><span class='line'>  <span class="ss">database</span><span class="p">:</span> <span class="n">db</span><span class="o">/</span><span class="n">development</span><span class="o">.</span><span class="n">sqlite3</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Warning: The database defined as &quot;test&quot; will be erased and</span>
</span><span class='line'><span class="c1"># re-generated from your development database when you run &quot;rake&quot;.</span>
</span><span class='line'><span class="c1"># Do not set this db to the same as development or production.</span>
</span><span class='line'><span class="nb">test</span><span class="p">:</span>
</span><span class='line'>  <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">default</span>
</span><span class='line'>  <span class="ss">database</span><span class="p">:</span> <span class="n">db</span><span class="o">/</span><span class="nb">test</span><span class="o">.</span><span class="n">sqlite3</span>
</span><span class='line'>
</span><span class='line'><span class="ss">production</span><span class="p">:</span>
</span><span class='line'>  <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">default</span>
</span><span class='line'>  <span class="ss">database</span><span class="p">:</span> <span class="n">db</span><span class="o">/</span><span class="n">production</span><span class="o">.</span><span class="n">sqlite3</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ä¸º<code>production</code>æ·»åŠ <code>secret_key_base</code></h3>

<p>ç¼–è¾‘ config/secrets.yml æ–‡ä»¶ï¼Œæ·»åŠ ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">production</span><span class="p">:</span>
</span><span class='line'>  <span class="ss">secret_key_base</span><span class="p">:</span> <span class="n">a1feaf0cb8501bb41952bbd1df3641ca0c4eed5beb19fcb69bbaaf30b5e11d58872092a84951679f7df622dda2d6bd1b21f98bd2a24b99e096095f003e4ccf90</span>
</span></code></pre></td></tr></table></div></figure>


<p>128ä½çš„éšæœºå­—ç¬¦ä¸²å¯ç”¨ rake secret å‘½ä»¤ç”Ÿæˆã€‚</p>

<h3>åœ¨ä½ çš„githubæˆ–è€…gitlabæ·»åŠ ssh key</h3>

<p>ä½ å¯ä»¥æŒ‰å¦‚ä¸‹å‘½ä»¤æ¥ç”Ÿæˆsshkey</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>ssh-keygen -t rsa -C <span class="s2">&quot;xxxxx@xxxxx.com&quot;</span>
</span><span class='line'>cat ~/.ssh/id_rsa.pub
</span></code></pre></td></tr></table></div></figure>


<h3>åˆå§‹åŒ–<code>cap</code></h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>cap deploy:setup
</span><span class='line'>cap deploy:check
</span><span class='line'>cap deploy:update
</span><span class='line'>cap db:create
</span><span class='line'>cap deploy:migrate
</span></code></pre></td></tr></table></div></figure>


<h3>ä»¥åå°±å¯ä»¥é€šè¿‡è·‘ä»¥ä¸‹å‘½ä»¤ï¼Œéƒ¨ç½²ä½ çš„åº”ç”¨äº†</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>cap deploy:migrations æˆ–è€… cap deploy
</span></code></pre></td></tr></table></div></figure>


<h3>ä¿®æ”¹ Nginx é…ç½®</h3>

<p>åˆ é™¤åŸæœ‰çš„é»˜è®¤ç½‘ç«™é…ç½®ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>rm /etc/nginx/sites-enabled/default
</span></code></pre></td></tr></table></div></figure>


<p>æ–°å»ºç½‘ç«™é…ç½®ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>touch /etc/nginx/sites-enabled/example.com.conf
</span></code></pre></td></tr></table></div></figure>


<p>ç¼–è¾‘<code>/etc/nginx/sites-enabled/example.com.conf</code>ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>server <span class="o">{</span>
</span><span class='line'>    listen <span class="m">80</span> default<span class="p">;</span>
</span><span class='line'>    server_name example.com<span class="p">;</span> <span class="c"># è¿™é‡Œå¡«å†™ä½ çœŸå®åŸŸå</span>
</span><span class='line'>    root /var/www/example.com/current/public<span class="p">;</span>
</span><span class='line'>    passenger_enabled on<span class="p">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>é‡å¯Nginx</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo service nginx restart
</span></code></pre></td></tr></table></div></figure>


<h2>å®Œæˆ</h2>

<p>åœ¨æµè§ˆå™¨æ‰“å¼€æœåŠ¡å™¨çš„ IP åœ°å€æˆ–åŸŸåï¼Œå¯ä»¥çœ‹åˆ°Nginxå·²ç»å¯åŠ¨</p>

<p>ref: <a href="http://stackoverflow.com/questions/17413526/nginx-missing-sites-available-directory">http://stackoverflow.com/questions/17413526/nginx-missing-sites-available-directory</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è¯¦è§£JSç±»æ¦‚å¿µçš„å®ç°]]></title>
    <link href="http://justin-lu.github.io/blog/2016/02/27/xiang-jie-jslei-gai-nian-de-shi-xian/"/>
    <updated>2016-02-27T21:50:35+08:00</updated>
    <id>http://justin-lu.github.io/blog/2016/02/27/xiang-jie-jslei-gai-nian-de-shi-xian</id>
    <content type="html"><![CDATA[<p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒJSå¹¶æ²¡æœ‰ç±»(class)çš„æ¦‚å¿µ,è™½ç„¶è¯´ES6å¼€å§‹æœ‰äº†ç±»çš„æ¦‚å¿µï¼Œä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ˜¯è¯´JSæœ‰äº†åƒRubyã€Javaè¿™äº›åŸºäºç±»çš„é¢å‘å¯¹è±¡è¯­è¨€ä¸€æ ·ï¼Œæœ‰äº†å…¨æ–°çš„ç»§æ‰¿æ¨¡å‹ã€‚ES6ä¸­çš„ç±»ï¼Œä»…ä»…åªæ˜¯åŸºäºç°æœ‰çš„åŸå‹ç»§æ‰¿çš„ä¸€ç§è¯­æ³•ç³–ï¼Œä¸‹é¢æˆ‘ä»¬å¥½å¥½åˆ†æä¸€ä¸‹ï¼Œå…·ä½“æ˜¯å¦‚ä½•å®ç°çš„</p>

<!-- More -->


<h2><a href="https://zh.wikipedia.org/wiki/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1">é¢å‘å¯¹è±¡æ€æƒ³</a></h2>

<p>åœ¨è®²æ­£é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è®¨è®ºä¸€ä¸‹å„ç§é¢è¯•é¢˜éƒ½å¯èƒ½å‡ºç°çš„ä¸€ä¸ªé—®é¢˜ï¼Œä»€ä¹ˆæ˜¯<code>é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰</code>?</p>

<ul>
<li>ç±»ï¼šå®šä¹‰æŸä¸€äº‹ç‰©çš„æŠ½è±¡ç‰¹ç‚¹ï¼ŒåŒ…å«å±æ€§å’Œæ–¹æ³•ï¼Œä¸¾ä¸ªæ —å­ï¼Œ<code>ç‹—</code>è¿™ä¸ªç±»åŒ…å«ç‹—çš„ä¸€äº›åŸºç¡€ç‰¹å¾ï¼Œå¦‚æ¯›çš®é¢œè‰²ï¼Œå å«ç­‰èƒ½åŠ›ã€‚</li>
<li>å¯¹è±¡ï¼šç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œè¿˜æ˜¯ä¸¾ä¸ªæ —å­ï¼Œå°æ˜å®¶çš„ç™½è‰²çš„ç‹—å’Œå°çº¢å®¶çº¢è‰²çš„ç‹—ã€‚</li>
<li>å±æ€§ï¼šå¯¹è±¡çš„ç‰¹å¾ï¼Œæ¯”å¦‚åˆšæåˆ°çš„ç‹—çš®æ¯›çš„é¢œè‰²ã€‚</li>
<li>æ–¹æ³•ï¼šå¯¹è±¡çš„è¡Œä¸ºï¼Œæ¯”å¦‚åˆšæ‰æåˆ°çš„ç‹—çš„å å«èƒ½åŠ›ã€‚</li>
<li>å°è£…æ€§ï¼šé€šè¿‡é™åˆ¶åªæœ‰ç‰¹å®šç±»çš„å¯¹è±¡å¯ä»¥è®¿é—®ç‰¹å®šç±»çš„æˆå‘˜ï¼Œä¸€èˆ¬åŒ…å«<code>public</code> <code>protected</code> <code>private</code> ä¸‰ç§ï¼Œä¸åŒè¯­è¨€çš„å®ç°ä¸åŒã€‚</li>
<li>ç»§æ‰¿æ€§ï¼šä¸€ä¸ªç±»ä¼šæœ‰<code>å­ç±»</code>,è¿™ä¸ª<code>å­ç±»</code>æ˜¯æ›´å…·ä½“åŒ–çš„ä¸€ä¸ªæŠ½è±¡ï¼Œå®ƒåŒ…å«<code>çˆ¶ç±»</code>çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶ä¸”æœ‰å¯èƒ½æœ‰ä¸åŒäº<code>çˆ¶ç±»</code>çš„å±æ€§å’Œæ–¹æ³•ã€‚</li>
<li>å¤šæ€æ€§ï¼šå¤šæ„ä¸ºâ€˜è®¸å¤šâ€™ï¼Œæ€æ„ä¸ºâ€˜å½¢æ€â€™ã€‚ä¸åŒç±»å¯ä»¥å®šä¹‰ç›¸åŒçš„æ–¹æ³•æˆ–å±æ€§ã€‚</li>
<li>æŠ½è±¡æ€§ï¼šå¤æ‚ç°å®é—®é¢˜è½¬åŒ–ä¸ºç±»å®šä¹‰çš„é€”å¾„ï¼ŒåŒ…æ‹¬ä»¥ä¸Šæ‰€æœ‰å†…å®¹ã€‚</li>
</ul>


<h2>å¦‚ä½•å®ç°å¯¹è±¡ï¼ˆç±»ï¼‰çš„å®šä¹‰</h2>

<p>ç”±äºJSå¹¶æ²¡æœ‰<code>ç±»(class)</code>çš„æ¦‚å¿µï¼Œæ›´å¤šçš„æ—¶å€™æˆ‘ä»¬æŠŠå®ƒå«åš<code>å¯¹è±¡ï¼ˆfunctionï¼‰</code>ï¼Œç„¶åæŠŠ<code>å¯¹è±¡</code>å«åš<code>å®ä¾‹(instance)</code>ï¼Œè·Ÿå›¢é˜Ÿé‡Œé¢çš„äººè®¨è®ºOOPçš„æ—¶å€™ï¼Œç»å¸¸ä¼šæœ‰æ¦‚å¿µä¸Šçš„ä¸€äº›è¯¯è§£ï¼Œç‰¹æ­¤è¯´æ˜ä¸€ä¸‹ã€‚</p>

<h3>æ„é€ å‡½æ•°ï¼šä¸€ä¸ªæŒ‡æ˜äº†å¯¹è±¡ç±»å‹çš„å‡½æ•°ï¼Œé€šå¸¸æˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°ç±»åˆ›å»º</h3>

<p>åœ¨jsé‡Œé¢ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½æ˜¯é€šè¿‡æ„é€ å‡½æ•°æ¥åˆ›å»º<code>å¯¹è±¡(class)</code>,ç„¶åé€šè¿‡<code>new</code>è¿™ä¸ªå…³é”®å­—æ¥å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">Dog</span><span class="p">(</span><span class="nx">name</span><span class="p">){</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">d1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dog</span><span class="p">(</span><span class="s2">&quot;dodo&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">d1</span><span class="p">.</span><span class="nx">constructor</span>
</span><span class='line'><span class="c1">// Dog(name){</span>
</span><span class='line'><span class="c1">//  this.name = name;</span>
</span><span class='line'><span class="c1">// }</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">d2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dog</span><span class="p">(</span><span class="s1">&#39;do2do&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸ºä»€ä¹ˆé€šè¿‡<code>æ„é€ å‡½æ•°</code>å¯ä»¥å®ç°<code>å¯¹è±¡ï¼ˆclassï¼‰</code>å±æ€§çš„å®šä¹‰å‘¢ï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»ç†è§£è¿™ä¸ªè¯­æ³•<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/new"><code>new constructor[([arguments])]</code></a></p>

<p>æˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹å½“<code>new Dog('name')</code>æ—¶ï¼Œå…·ä½“åšäº†å“ªäº›äº‹æƒ…
1. ä¸€ä¸ªæ–°å®ä¾‹è¢«åˆ›å»ºã€‚å®ƒç»§æ‰¿è‡ª<code>Dog.prototype</code>
2. æ„é€ å‡½æ•°è¢«æ‰§è¡Œï¼Œç›¸åº”çš„å‚æ•°ä¼šè¢«ä¼ å…¥ï¼ŒåŒæ—¶ä¸Šä¸‹æ–‡(<code>this</code>)ä¼šæŒ‡å‘è¿™ä¸ªæ–°çš„å®ä¾‹
3. é™¤éæ˜ç¡®è¿”å›å€¼ï¼Œå¦åˆ™è¿”å›æ–°çš„å®ä¾‹</p>

<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å®ç°äº†OOPé‡Œé¢çš„ç±»(Dog)ã€å¯¹è±¡(d1,d2)ã€å’Œå±æ€§(name)çš„æ¦‚å¿µï¼Œ<code>d1</code>å’Œ<code>d2</code>æœ‰ç›¸åŒçš„<code>name</code>å±æ€§ï¼Œä½†æ˜¯å€¼å¹¶ä¸ç›¸åŒ,å³å±æ€§æ˜¯ç§æœ‰çš„ã€‚</p>

<blockquote><p>æ³¨: æ–°åˆ›å»ºçš„å®ä¾‹ï¼Œéƒ½åŒ…å«ä¸€ä¸ª<code>constructor</code>å±æ€§ï¼Œè¯¥å±æ€§æŒ‡å‘ä»–ä»¬çš„æ„é€ å‡½æ•°<code>Dog</code></p></blockquote>

<h3>åŸå‹å¯¹è±¡(prototype)</h3>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å³å°†è®¨è®ºå¦‚ä½•å®šä¹‰æ–¹æ³•ï¼Œå…¶å®ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥è¿™æ ·å®šä¹‰æˆ‘ä»¬çš„æ–¹æ³•ï¼Œå¦‚ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">Dog</span><span class="p">(</span><span class="nx">name</span><span class="p">){</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">bark</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot; bark&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">d1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dog</span><span class="p">(</span><span class="s2">&quot;dodo&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">d1</span><span class="p">.</span><span class="nx">bark</span><span class="p">();</span>
</span><span class='line'><span class="c1">// dodo bark</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½†æ˜¯ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸æ¨èè¿™ä¹ˆåšï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€çŸ¥<code>Dog</code>æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ¯æ¬¡å®ä¾‹åŒ–æ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>bark</code> è¿™ä¸ªæ–¹æ³•æ¯æ¬¡éƒ½ä¼šè¢«å®šä¹‰, æ¯”è¾ƒæµªè´¹å†…å­˜ã€‚ä½†æ˜¯æˆ‘ä»¬é€šå¸¸å¯ä»¥ç”¨<code>constructor</code>å’Œé—­åŒ…çš„æ–¹å¼æ¥å®ç°ç§æœ‰å±æ€§ï¼Œå¦‚ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">Dog</span><span class="p">(</span><span class="nx">name</span><span class="p">){</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// barkCount æ˜¯ç§æœ‰å±æ€§ï¼Œå› ä¸ºå®ä¾‹å¹¶ä¸çŸ¥é“è¿™ä¸ªå±æ€§</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">barkCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">bark</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="nx">barkCount</span> <span class="o">++</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot; bark&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">getBarkCount</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot; has barked &quot;</span> <span class="o">+</span> <span class="nx">barkCount</span> <span class="o">+</span> <span class="s2">&quot; times&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">d1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dog</span><span class="p">(</span><span class="s2">&quot;dodo&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">d1</span><span class="p">.</span><span class="nx">bark</span><span class="p">();</span>
</span><span class='line'><span class="nx">d1</span><span class="p">.</span><span class="nx">bark</span><span class="p">();</span>
</span><span class='line'><span class="nx">d1</span><span class="p">.</span><span class="nx">getBarkCount</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¥½åƒæ‰¯å¾—æœ‰ç‚¹è¿œï¼Œæˆ‘ä»¬å›å½’æˆ‘ä»¬çš„ä¸»è§’<code>prototype</code>ï¼Œå‡½æ•°<code>Dog</code>æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§ï¼Œè¿™ä¸ªå±æ€§å°±å«åŸå‹ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œå½“ç”¨<code>new</code>è¿ç®—ç¬¦åˆ›å»ºå®ä¾‹æ—¶ï¼Œä¼šæŠŠ<code>Dog</code>çš„åŸå‹å¯¹è±¡çš„å¼•ç”¨å¤åˆ¶åˆ°æ–°çš„å®ä¾‹å†…éƒ¨çš„[[Prototype]]å±æ€§ï¼Œå³<code>d1.[[Prototype]] = Dog.prototype</code>ï¼Œå› ä¸ºæ‰€æœ‰çš„å®ä¾‹çš„[[Prototype]]éƒ½æŒ‡å‘<code>Dog</code>çš„åŸå‹å¯¹è±¡ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®šä¹‰æˆ‘ä»¬çš„æ–¹æ³•äº†ï¼Œå¦‚ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">Dog</span><span class="p">(</span><span class="nx">name</span><span class="p">){</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Dog</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">bark</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot; bark&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">d1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dog</span><span class="p">(</span><span class="s2">&quot;dodo&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">d1</span><span class="p">.</span><span class="nx">bark</span><span class="p">();</span>
</span><span class='line'><span class="c1">// dodo bark</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>d1.__proto__ == Dog.prototype</code>ï¼Œæ¥éªŒè¯æˆ‘ä»¬çš„æƒ³æ³•ã€‚ç”¨åŸå‹å¯¹è±¡è¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œç”±äºå®ä¾‹åŒ–çš„å¯¹è±¡çš„[[Prototype]]æŒ‡å‘<code>Dog</code>çš„åŸå‹å¯¹è±¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ <code>Dog</code>çš„åŸå‹å¯¹è±¡çš„æ–¹æ³•ï¼Œæ¥æ·»åŠ å·²ç»å®ä¾‹åŒ–åçš„å®ä¾‹<code>d1</code>çš„æ–¹æ³•ã€‚å¦‚:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">Dog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">run</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot; is running!&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">d1</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>
</span><span class='line'><span class="c1">// dodo is running!</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>æ³¨ï¼šæ‰€æœ‰å¯¹è±¡çš„<code>__proto__</code>éƒ½æŒ‡å‘å…¶æ„é€ å™¨çš„<code>prototype</code></p></blockquote>

<h3>åŸå‹é“¾</h3>

<p>ä¸Šé¢å·²ç»æè¿°å¦‚ä½•å®šä¹‰ä¸€ä¸ª<code>ç±»</code>ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†è¦äº†è§£ï¼Œå¦‚ä½•å®ç°<code>ç±»çš„ç»§æ‰¿</code>ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£jsé‡Œä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„æ¦‚å¿µï¼š<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain">åŸå‹é“¾</a>ï¼šæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘å®ƒçš„åŸå‹ï¼ˆprototypeï¼‰å¯¹è±¡çš„å†…éƒ¨é“¾æ¥ã€‚è¿™ä¸ªåŸå‹å¯¹è±¡åˆæœ‰è‡ªå·±çš„åŸå‹ï¼Œç›´åˆ°æŸä¸ªå¯¹è±¡çš„åŸå‹ä¸º null ä¸ºæ­¢ï¼ˆä¹Ÿå°±æ˜¯ä¸å†æœ‰åŸå‹æŒ‡å‘ï¼‰ï¼Œç»„æˆè¿™æ¡é“¾çš„æœ€åä¸€ç¯ã€‚è¿™ç§ä¸€çº§ä¸€çº§çš„é“¾ç»“æ„å°±ç§°ä¸ºåŸå‹é“¾</p>

<p>mozillaç»™å‡ºä¸€ä¸ªæŒºå¥½çš„ä¾‹å­ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// å‡å®šæœ‰ä¸€ä¸ªå¯¹è±¡ o, å…¶è‡ªèº«çš„å±æ€§ï¼ˆown propertiesï¼‰æœ‰ a å’Œ bï¼š</span>
</span><span class='line'><span class="c1">// {a: 1, b: 2}</span>
</span><span class='line'><span class="c1">// o çš„åŸå‹ o.[[Prototype]]æœ‰å±æ€§ b å’Œ cï¼š</span>
</span><span class='line'><span class="c1">// {b: 3, c: 4}</span>
</span><span class='line'><span class="c1">// æœ€å, o.[[Prototype]].[[Prototype]] æ˜¯ null.</span>
</span><span class='line'><span class="c1">// è¿™å°±æ˜¯åŸå‹é“¾çš„æœ«å°¾ï¼Œå³ nullï¼Œ</span>
</span><span class='line'><span class="c1">// æ ¹æ®å®šä¹‰ï¼Œnull æ²¡æœ‰[[Prototype]].</span>
</span><span class='line'><span class="c1">// ç»¼ä¸Šï¼Œæ•´ä¸ªåŸå‹é“¾å¦‚ä¸‹: </span>
</span><span class='line'><span class="c1">// {a:1, b:2} ---&gt; {b:3, c:4} ---&gt; null</span>
</span><span class='line'>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">a</span><span class="p">);</span> <span class="c1">// 1</span>
</span><span class='line'><span class="c1">// aæ˜¯oçš„è‡ªèº«å±æ€§å—ï¼Ÿæ˜¯çš„ï¼Œè¯¥å±æ€§çš„å€¼ä¸º1</span>
</span><span class='line'>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">b</span><span class="p">);</span> <span class="c1">// 2</span>
</span><span class='line'><span class="c1">// bæ˜¯oçš„è‡ªèº«å±æ€§å—ï¼Ÿæ˜¯çš„ï¼Œè¯¥å±æ€§çš„å€¼ä¸º2</span>
</span><span class='line'><span class="c1">// o.[[Prototype]]ä¸Šè¿˜æœ‰ä¸€ä¸ª&#39;b&#39;å±æ€§,ä½†æ˜¯å®ƒä¸ä¼šè¢«è®¿é—®åˆ°.è¿™ç§æƒ…å†µç§°ä¸º&quot;å±æ€§é®è”½ (property shadowing)&quot;.</span>
</span><span class='line'>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">c</span><span class="p">);</span> <span class="c1">// 4</span>
</span><span class='line'><span class="c1">// cæ˜¯oçš„è‡ªèº«å±æ€§å—ï¼Ÿä¸æ˜¯ï¼Œé‚£çœ‹çœ‹o.[[Prototype]]ä¸Šæœ‰æ²¡æœ‰.</span>
</span><span class='line'><span class="c1">// cæ˜¯o.[[Prototype]]çš„è‡ªèº«å±æ€§å—ï¼Ÿæ˜¯çš„,è¯¥å±æ€§çš„å€¼ä¸º4</span>
</span><span class='line'>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">d</span><span class="p">);</span> <span class="c1">// undefined</span>
</span><span class='line'><span class="c1">// dæ˜¯oçš„è‡ªèº«å±æ€§å—ï¼Ÿä¸æ˜¯,é‚£çœ‹çœ‹o.[[Prototype]]ä¸Šæœ‰æ²¡æœ‰.</span>
</span><span class='line'><span class="c1">// dæ˜¯o.[[Prototype]]çš„è‡ªèº«å±æ€§å—ï¼Ÿä¸æ˜¯ï¼Œé‚£çœ‹çœ‹o.[[Prototype]].[[Prototype]]ä¸Šæœ‰æ²¡æœ‰.</span>
</span><span class='line'><span class="c1">// o.[[Prototype]].[[Prototype]]ä¸ºnullï¼Œåœæ­¢æœç´¢ï¼Œ</span>
</span><span class='line'><span class="c1">// æ²¡æœ‰då±æ€§ï¼Œè¿”å›undefined</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡æˆ‘ä»¬ç†è§£çš„æ„é€ å‡½æ•°å’ŒåŸå‹å¯¹è±¡æ¥å®ç°ç»§æ‰¿çš„æ¦‚å¿µäº†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">Dog</span><span class="p">(</span><span class="nx">name</span><span class="p">){</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// è¿™ç§å†™æ³•ä¼šä¿®æ”¹dogå®ä¾‹çš„constructorï¼Œå¯ä»¥é€šè¿‡Dog.prototype.constructor = Dogæ¥é‡ç½®</span>
</span><span class='line'><span class="nx">Dog</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">bark</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot; bark&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// é‡ç½®Dogå®ä¾‹çš„æ„é€ å‡½æ•°ä¸ºæœ¬èº«</span>
</span><span class='line'><span class="nx">Dog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">Dog</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Haski çš„æ„é€ å‡½æ•°</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">Haski</span><span class="p">(</span><span class="nx">name</span><span class="p">){</span>
</span><span class='line'>  <span class="c1">// ç»§æ‰¿Dogçš„æ„é€ å‡½æ•°</span>
</span><span class='line'>  <span class="nx">Dog</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// å¯ä»¥è¡¥å……æ›´å¤šHaskiçš„å±æ€§</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;Haski&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 1. è®¾ç½®Haskiçš„prototypeä¸ºDogçš„å®ä¾‹å¯¹è±¡</span>
</span><span class='line'><span class="c1">// 2. æ­¤æ—¶Haskiçš„åŸå‹é“¾æ˜¯ Haski -&gt; Dogçš„å®ä¾‹ -&gt; Dog -&gt; Object</span>
</span><span class='line'><span class="c1">// 3. æ­¤æ—¶ï¼ŒHaskiåŒ…å«äº†Dogçš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œè€Œä¸”è¿˜æœ‰ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘Dogçš„åŸå‹å¯¹è±¡</span>
</span><span class='line'><span class="c1">// 4. è¿™ç§åšæ³•æ˜¯ä¸æ¨èçš„ï¼Œä¸‹é¢ä¼šæ”¹è¿›</span>
</span><span class='line'><span class="nx">Haski</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dog</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// é‡ç½®Haskiå®ä¾‹çš„æ„é€ å‡½æ•°ä¸ºæœ¬èº«</span>
</span><span class='line'><span class="nx">Haski</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">Haski</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// å¯ä»¥ä¸ºå­ç±»æ·»åŠ æ›´å¤šçš„æ–¹æ³•</span>
</span><span class='line'><span class="nx">Haski</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">say</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;I&#39;m &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">ha</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Haski</span><span class="p">(</span><span class="s2">&quot;Ha&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">// Ha bark</span>
</span><span class='line'><span class="nx">ha</span><span class="p">.</span><span class="nx">bark</span><span class="p">();</span>
</span><span class='line'><span class="c1">// Ha bark</span>
</span><span class='line'><span class="nx">ha</span><span class="p">.</span><span class="nx">say</span><span class="p">();</span>
</span><span class='line'><span class="c1">// I&#39;m Ha</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>æ³¨ï¼š å­ç±»åœ¨å®šä¹‰prototypeæ—¶ï¼Œä¸å¯ç›´æ¥ä½¿ç”¨<code>Haski.prototype = {}</code>å®šä¹‰ï¼Œè¿™æ ·ä¼šé‡å†™Haskiçš„åŸå‹é“¾ï¼ŒæŠŠHaskiçš„åŸå‹å½“åš<code>Object</code>çš„å®ä¾‹ï¼Œè€Œé<code>Dog</code>çš„å®ä¾‹</p></blockquote>

<p>ä½†æ˜¯ï¼Œå½“æˆ‘æƒ³æ‰¾ä¸€ä¸‹<code>ha</code>çš„åŸå‹é“¾æ—¶ï¼Œä¼šå‘ç°<code>ha</code>çš„åŸå‹å¯¹è±¡æŒ‡å‘çš„æ˜¯<code>Dog</code>çš„å®ä¾‹ï¼Œè€Œä¸”è¿˜æœ‰ä¸€ä¸ªå€¼ä¸º<code>undefined</code>çš„<code>name</code>å±æ€§ï¼Œåœ¨å®ä¾‹åŒ–æ—¶ï¼Œnameæ˜¯æ²¡å¿…è¦çš„, å¦‚ä¸‹å›¾ï¼š</p>

<p><img src="http://ww4.sinaimg.cn/large/785cd1e3jw1f2bmnt5qn4j20d50a4abw.jpg" alt="" /></p>

<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// ä¿®æ”¹å‰</span>
</span><span class='line'><span class="nx">Haski</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dog</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ä¿®æ”¹å</span>
</span><span class='line'><span class="nx">Haski</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">Dog</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://ww1.sinaimg.cn/large/785cd1e3jw1f2bp2gl1sij20qs0iogpa.jpg" alt="" /></p>

<blockquote><p>æ³¨: <code>__proto__</code> æ–¹æ³•å·²å¼ƒç”¨ï¼Œä» ECMAScript 6 å¼€å§‹, [[Prototype]] å¯ä»¥ç”¨Object.getPrototypeOf()å’ŒObject.setPrototypeOf()è®¿é—®å™¨æ¥è®¿é—®</p></blockquote>

<p>è‡ªæ­¤ï¼Œæˆ‘ä»¬å·²ç»å®ç°ç»§æ‰¿çš„æ¦‚å¿µï¼Œçˆ¶ç±»æœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œå­ç±»ç»§æ‰¿äº†çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œè€Œä¸”è¿˜å¯ä»¥å®šä¹‰è‡ªå·±çš„å±æ€§å’Œæ–¹æ³•ã€‚</p>

<h2>ES6 å¦‚ä½•å®ç°</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span><span class='line'><span class="c1">// å£°æ˜ Dog ç±»</span>
</span><span class='line'><span class="kr">class</span> <span class="nx">Dog</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// æ„é€ å‡½æ•°</span>
</span><span class='line'>  <span class="nx">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">){</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// æ™®é€šæ–¹æ³•</span>
</span><span class='line'>  <span class="nx">dark</span><span class="p">(){</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;bark&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// é™æ€æ–¹æ³•ï¼Œä¹Ÿå«ç±»æ–¹æ³•</span>
</span><span class='line'>  <span class="kr">static</span> <span class="nx">staticMethod</span><span class="p">(){</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;I&#39;m static method!&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// é€šè¿‡`extends`å…³é”®å­—æ¥å®ç°ç»§æ‰¿</span>
</span><span class='line'><span class="kr">class</span> <span class="nx">Haski</span> <span class="kr">extends</span> <span class="nx">Dog</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">){</span>
</span><span class='line'>    <span class="c1">// è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°</span>
</span><span class='line'>    <span class="kr">super</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;Haski&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// å®šä¹‰å­ç±»æ–¹æ³•</span>
</span><span class='line'>  <span class="nx">say</span><span class="p">(){</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;I&#39;m&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨ES6ä¸­ï¼Œæˆ‘ä»¬åªéœ€é€šè¿‡<code>class</code> <code>extends</code> <code>super</code> <code>constructor</code> å³å¯æ¯”è¾ƒæ–¹ä¾¿çš„å®ŒæˆåŸæ¥ä½¿ç”¨JSæ¯”è¾ƒéš¾ç†è§£çš„å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡babelçš„è§£æå™¨ï¼Œæ¥çœ‹çœ‹babelæ˜¯æ€ä¹ˆæŠŠè¿™äº›è¯­æ³•ç³–è½¬æˆJSçš„å®ç°çš„ã€‚å…·ä½“ä»£ç å¯ä»¥å‚è€ƒ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">_createClass</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="kd">function</span> <span class="nx">defineProperties</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">props</span><span class="p">)</span> <span class="p">{</span> <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">props</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> <span class="kd">var</span> <span class="nx">descriptor</span> <span class="o">=</span> <span class="nx">props</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="nx">descriptor</span><span class="p">.</span><span class="nx">enumerable</span> <span class="o">=</span> <span class="nx">descriptor</span><span class="p">.</span><span class="nx">enumerable</span> <span class="o">||</span> <span class="kc">false</span><span class="p">;</span> <span class="nx">descriptor</span><span class="p">.</span><span class="nx">configurable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;value&quot;</span> <span class="k">in</span> <span class="nx">descriptor</span><span class="p">)</span> <span class="nx">descriptor</span><span class="p">.</span><span class="nx">writable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">descriptor</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">descriptor</span><span class="p">);</span> <span class="p">}</span> <span class="p">}</span> <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Constructor</span><span class="p">,</span> <span class="nx">protoProps</span><span class="p">,</span> <span class="nx">staticProps</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">protoProps</span><span class="p">)</span> <span class="nx">defineProperties</span><span class="p">(</span><span class="nx">Constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">protoProps</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="nx">staticProps</span><span class="p">)</span> <span class="nx">defineProperties</span><span class="p">(</span><span class="nx">Constructor</span><span class="p">,</span> <span class="nx">staticProps</span><span class="p">);</span> <span class="k">return</span> <span class="nx">Constructor</span><span class="p">;</span> <span class="p">};</span> <span class="p">}();</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">_possibleConstructorReturn</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">call</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">self</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">ReferenceError</span><span class="p">(</span><span class="s2">&quot;this hasn&#39;t been initialised - super() hasn&#39;t been called&quot;</span><span class="p">);</span> <span class="p">}</span> <span class="k">return</span> <span class="nx">call</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">call</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">call</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">call</span> <span class="o">:</span> <span class="nx">self</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">_inherits</span><span class="p">(</span><span class="nx">subClass</span><span class="p">,</span> <span class="nx">superClass</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">superClass</span> <span class="o">!==</span> <span class="s2">&quot;function&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">superClass</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s2">&quot;Super expression must either be null or a function, not &quot;</span> <span class="o">+</span> <span class="k">typeof</span> <span class="nx">superClass</span><span class="p">);</span> <span class="p">}</span> <span class="nx">subClass</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">superClass</span> <span class="o">&amp;&amp;</span> <span class="nx">superClass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span> <span class="nx">constructor</span><span class="o">:</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">subClass</span><span class="p">,</span> <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">writable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span> <span class="p">});</span> <span class="k">if</span> <span class="p">(</span><span class="nx">superClass</span><span class="p">)</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">setPrototypeOf</span> <span class="o">?</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">setPrototypeOf</span><span class="p">(</span><span class="nx">subClass</span><span class="p">,</span> <span class="nx">superClass</span><span class="p">)</span> <span class="o">:</span> <span class="nx">subClass</span><span class="p">.</span><span class="nx">__proto__</span> <span class="o">=</span> <span class="nx">superClass</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">_classCallCheck</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">Constructor</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">instance</span> <span class="k">instanceof</span> <span class="nx">Constructor</span><span class="p">))</span> <span class="p">{</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s2">&quot;Cannot call a class as a function&quot;</span><span class="p">);</span> <span class="p">}</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// å£°æ˜ Dog ç±»</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">Dog</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// æ„é€ å‡½æ•°</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">Dog</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">_classCallCheck</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Dog</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// æ™®é€šæ–¹æ³•</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="nx">_createClass</span><span class="p">(</span><span class="nx">Dog</span><span class="p">,</span> <span class="p">[{</span>
</span><span class='line'>    <span class="nx">key</span><span class="o">:</span> <span class="s2">&quot;dark&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">dark</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;bark&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// é™æ€æ–¹æ³•ï¼Œä¹Ÿå«ç±»æ–¹æ³•</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}],</span> <span class="p">[{</span>
</span><span class='line'>    <span class="nx">key</span><span class="o">:</span> <span class="s2">&quot;staticMethod&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">staticMethod</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;I&#39;m static method!&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}]);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nx">Dog</span><span class="p">;</span>
</span><span class='line'><span class="p">}();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// é€šè¿‡`extends`å…³é”®å­—æ¥å®ç°ç»§æ‰¿</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">Haski</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">_Dog</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">_inherits</span><span class="p">(</span><span class="nx">Haski</span><span class="p">,</span> <span class="nx">_Dog</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">Haski</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">_classCallCheck</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">Haski</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">_this</span> <span class="o">=</span> <span class="nx">_possibleConstructorReturn</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">getPrototypeOf</span><span class="p">(</span><span class="nx">Haski</span><span class="p">).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">name</span><span class="p">));</span>
</span><span class='line'>    <span class="c1">// è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="nx">_this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;Haski&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">_this</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">_createClass</span><span class="p">(</span><span class="nx">Haski</span><span class="p">,</span> <span class="p">[{</span>
</span><span class='line'>    <span class="nx">key</span><span class="o">:</span> <span class="s2">&quot;say&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">say</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;I&#39;m&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}]);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nx">Haski</span><span class="p">;</span>
</span><span class='line'><span class="p">}(</span><span class="nx">Dog</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p><code>æ•™æ˜¯æœ€å¥½çš„å­¦</code>ï¼Œæˆ‘æ­£åœ¨å°è¯•æŠŠæˆ‘è‡ªå·±ç†è§£çš„å†…å®¹åˆ†äº«å‡ºæ¥ï¼Œå¸Œæœ›æˆ‘èƒ½è®²æ¸…æ¥šï¼Œå¦‚æœæè¿°æœ‰è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚</p></blockquote>

<h3>å‚è€ƒæ–‡çŒ®</h3>

<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Introduction_to_Object-Oriented_JavaScript">Introduction to Object-Oriented JavaScript</a></li>
<li><a href="ttps://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Classes">Classes</a></li>
<li><a href="http://stackoverflow.com/questions/9772307/declaring-javascript-object-method-in-constructor-function-vs-in-prototype">Declaring javascript object method in constructor function vs. in prototype </a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Introduction_to_Object-Oriented_JavaScript">Inheritance and the prototype chain</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[WebService ç®€å•ä½¿ç”¨]]></title>
    <link href="http://justin-lu.github.io/blog/2015/11/06/web-service-jian-dan-shi-yong/"/>
    <updated>2015-11-06T12:15:07+08:00</updated>
    <id>http://justin-lu.github.io/blog/2015/11/06/web-service-jian-dan-shi-yong</id>
    <content type="html"><![CDATA[<h2>ä»€ä¹ˆæ˜¯Web Servicesï¼Ÿ</h2>

<p> Web Services æ˜¯ç‹¬ç«‹çš„ï¼ˆself-containedï¼‰å¹¶å¯è‡ªæˆ‘æè¿°
  - Web Services å¯é€šè¿‡ä½¿ç”¨UDDIæ¥å‘ç°
  - Web Services å¯è¢«å…¶ä»–åº”ç”¨ç¨‹åºä½¿ç”¨
  - XML æ˜¯ Web Services çš„åŸºç¡€</p>

<!-- More -->


<h2>Web services å¹³å°çš„å…ƒç´ </h2>

<ul>
<li>SOAP (ç®€æ˜“å¯¹è±¡è®¿é—®åè®®)</li>
<li>UDDI (é€šç”¨æè¿°ã€å‘ç°åŠæ•´åˆ)</li>
<li>WSDL (Web services æè¿°è¯­è¨€)</li>
</ul>


<h3>ä»€ä¹ˆæ˜¯ SOAPï¼Ÿ</h3>

<blockquote><p>åŸºæœ¬çš„ Web services å¹³å°æ˜¯ XML + HTTPã€‚</p></blockquote>

<ul>
<li>SOAP æŒ‡ç®€æ˜“å¯¹è±¡è®¿é—®åè®®</li>
<li>SOAP æ˜¯ä¸€ç§é€šä¿¡åè®®</li>
<li>SOAP ç”¨äºåº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡</li>
<li>SOAP æ˜¯ä¸€ç§ç”¨äºå‘é€æ¶ˆæ¯çš„æ ¼å¼</li>
<li>SOAP è¢«è®¾è®¡ç”¨æ¥é€šè¿‡å› ç‰¹ç½‘è¿›è¡Œé€šä¿¡</li>
<li>SOAP ç‹¬ç«‹äºå¹³å°</li>
<li>SOAP ç‹¬ç«‹äºè¯­è¨€</li>
<li>SOAP åŸºäº XML</li>
<li>SOAP å¾ˆç®€å•å¹¶å¯æ‰©å±•</li>
<li>SOAP å…è®¸æ‚¨ç»•è¿‡é˜²ç«å¢™</li>
<li>SOAP å°†ä½œä¸º W3C æ ‡å‡†æ¥å‘å±•</li>
</ul>


<h3>ä»€ä¹ˆæ˜¯ WSDL?</h3>

<blockquote><p>WSDL æ˜¯åŸºäº XML çš„ç”¨äºæè¿° Web Services ä»¥åŠå¦‚ä½•è®¿é—® Web Services çš„è¯­è¨€ã€‚</p></blockquote>

<ul>
<li>WSDL æŒ‡ç½‘ç»œæœåŠ¡æè¿°è¯­è¨€</li>
<li>WSDL ä½¿ç”¨ XML ç¼–å†™</li>
<li>WSDL æ˜¯ä¸€ç§ XML æ–‡æ¡£</li>
<li>WSDL ç”¨äºæè¿°ç½‘ç»œæœåŠ¡</li>
<li>WSDL ä¹Ÿå¯ç”¨äºå®šä½ç½‘ç»œæœåŠ¡</li>
<li>WSDL è¿˜ä¸æ˜¯ W3C æ ‡å‡†</li>
<li><a href="http://www.thomas-bayer.com/axis2/services/BLZService?wsdl">wsdlä¾‹å­</a></li>
</ul>


<h3>ä»€ä¹ˆæ˜¯UDDIï¼Ÿ</h3>

<ul>
<li>UDDI æ˜¯ä¸€ç§ç›®å½•æœåŠ¡ï¼Œé€šè¿‡å®ƒï¼Œä¼ä¸šå¯æ³¨å†Œå¹¶æœç´¢ Web servicesã€‚</li>
<li>UDDI æŒ‡é€šç”¨çš„æè¿°ã€å‘ç°ä»¥åŠæ•´åˆï¼ˆUniversal Description, Discovery and Integrationï¼‰ã€‚</li>
<li>UDDI æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨æœ‰å…³ web services çš„ä¿¡æ¯çš„ç›®å½•ã€‚</li>
<li>UDDI æ˜¯ä¸€ç§ç”± WSDL æè¿°çš„ç½‘ç»œæœåŠ¡æ¥å£ç›®å½•ã€‚</li>
<li>UDDI ç»ç”± SOAP è¿›è¡Œé€šè¿…ã€‚</li>
<li>UDDI è¢«æ„å»ºäº Microsoft .NET å¹³å°ä¹‹ä¸­ã€‚</li>
</ul>


<h3>è°ƒè¯•å·¥å…·</h3>

<ul>
<li><a href="http://www.soapui.org/downloads/soapui/open-source.html">SOAP UI å·¥å…·</a></li>
<li><a href="https://docs.awspaas.com/reference-guide/aws-paas-api-guide/soap/cxf.html">ä½¿ç”¨CXFå®¢æˆ·ç«¯</a></li>
<li><a href="https://docs.awspaas.com/reference-guide/aws-paas-api-guide/soap/java_client.html">ä½¿ç”¨JDKå®¢æˆ·ç«¯</a></li>
</ul>


<h3>SOAPå’ŒHTTPåŒºåˆ«</h3>

<ul>
<li>è¯·æ±‚æ¶ˆæ¯æ ¼å¼ä¸åŒ</li>
<li>å“åº”æ¶ˆæ¯æ ¼å¼ä¸åŒ</li>
<li>å®‰å…¨æœºåˆ¶ä¸åŒ</li>
<li>å®¢æˆ·ç«¯è°ƒç”¨æ–¹å¼ä¸åŒ</li>
<li>å¹¶å‘å¤„ç†èƒ½åŠ›çš„ä¸åŒ</li>
</ul>


<h3>åœ¨Railsä¸‹å¦‚ä½•è°ƒç”¨SOAPæ¥å£</h3>

<p>å®˜æ–¹æ–‡æ¡£</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># create a client for the service</span>
</span><span class='line'><span class="n">client</span> <span class="o">=</span> <span class="no">Savon</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="ss">wsdl</span><span class="p">:</span> <span class="s1">&#39;http://service.example.com?wsdl&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">client</span><span class="o">.</span><span class="n">operations</span>
</span><span class='line'><span class="c1"># =&gt; [:find_user, :list_users]</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># call the &#39;findUser&#39; operation</span>
</span><span class='line'><span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="ss">:find_user</span><span class="p">,</span> <span class="ss">message</span><span class="p">:</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="mi">42</span> <span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="n">response</span><span class="o">.</span><span class="n">body</span>
</span><span class='line'><span class="c1"># =&gt; { find_user_response: { id: 42, name: &#39;Hoff&#39; } }</span>
</span></code></pre></td></tr></table></div></figure>


<p>å®é™…ä¾‹å­</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">SoapWithSavon</span>
</span><span class='line'>  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
</span><span class='line'>    <span class="c1"># TODO: should use settin</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">client</span>
</span><span class='line'>      <span class="vi">@client</span> <span class="o">||=</span> <span class="no">Savon</span><span class="o">.</span><span class="n">client</span> <span class="k">do</span>
</span><span class='line'>        <span class="c1"># WSDL æ¥å£</span>
</span><span class='line'>        <span class="n">wsdl</span> <span class="s2">&quot;http://192.168.0.22:8000/sap/bc/srt/wsdl/srvc_5618AD468DEB07E0E1008000C0A80016/wsdl11/allinone/ws_policy/document?sap-client=300&quot;</span>
</span><span class='line'>        <span class="c1"># ç”¨æˆ·éªŒè¯</span>
</span><span class='line'>        <span class="n">basic_auth</span> <span class="s2">&quot;CRMINTERFACE&quot;</span><span class="p">,</span> <span class="s2">&quot;123456&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># é»˜è®¤åŒæ­¥æ˜¨å¤©çš„è®¾å¤‡æ•°æ®</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_devices</span> <span class="p">(</span><span class="n">start_at</span> <span class="o">=</span> <span class="mi">1</span><span class="o">.</span><span class="n">day</span><span class="o">.</span><span class="n">ago</span><span class="p">,</span> <span class="n">end_at</span> <span class="o">=</span> <span class="mi">1</span><span class="o">.</span><span class="n">day</span><span class="o">.</span><span class="n">ago</span><span class="p">)</span>
</span><span class='line'>      <span class="n">start_at_format</span> <span class="o">=</span> <span class="n">start_at</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-%d&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">end_at_format</span> <span class="o">=</span> <span class="n">end_at</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-%d&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">response</span> <span class="o">=</span> <span class="n">call_and_fail_gracefully</span><span class="p">(</span><span class="ss">:z_wl_material</span><span class="p">,</span> <span class="ss">:message</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s2">&quot;EAssetMatnr&quot;</span> <span class="o">=&gt;</span> <span class="p">{},</span> <span class="s2">&quot;ImUdate1&quot;</span> <span class="o">=&gt;</span> <span class="n">start_at_format</span><span class="p">,</span> <span class="s2">&quot;ImUdate2&quot;</span> <span class="o">=&gt;</span> <span class="n">end_at_format</span>  <span class="p">})</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="o">[</span><span class="ss">:z_wl_material_response</span><span class="o">][</span><span class="ss">:e_msgty</span><span class="o">]</span> <span class="o">==</span> <span class="s2">&quot;E&quot;</span>
</span><span class='line'>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="o">[</span><span class="ss">:z_wl_material_response</span><span class="o">][</span><span class="ss">:e_ermsg</span><span class="o">]</span>
</span><span class='line'>        <span class="o">[]</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="o">[</span><span class="ss">:z_wl_material_response</span><span class="o">][</span><span class="ss">:e_asset_matnr</span><span class="o">][</span><span class="ss">:item</span><span class="o">]</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">logger</span>
</span><span class='line'>      <span class="vc">@@logger</span> <span class="o">||=</span> <span class="no">Logger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;./log/soap_with_savon.log&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">call_and_fail_gracefully</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>      <span class="n">client</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>    <span class="k">rescue</span> <span class="no">Savon</span><span class="o">::</span><span class="no">SOAPFault</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>      <span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="n">e</span>
</span><span class='line'>    <span class="k">rescue</span> <span class="no">Savon</span><span class="o">::</span><span class="no">HTTPError</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>      <span class="c1"># HTTP Error</span>
</span><span class='line'>      <span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="n">e</span>
</span><span class='line'>    <span class="k">rescue</span> <span class="no">Savon</span><span class="o">::</span><span class="no">InvalidResponseError</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>      <span class="c1"># InvalidResponseError</span>
</span><span class='line'>      <span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="n">e</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>å‚è€ƒæ–‡æ¡£
<a href="https://github.com/savonrb/savon">savon</a>
<a href="https://docs.awspaas.com/reference-guide/aws-paas-api-guide/index.html">AWS PaaS APIå‚è€ƒæŒ‡å—</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using alias in linux/mac]]></title>
    <link href="http://justin-lu.github.io/blog/2015/08/22/using-alias-in-linux-slash-mac/"/>
    <updated>2015-08-22T14:00:13+08:00</updated>
    <id>http://justin-lu.github.io/blog/2015/08/22/using-alias-in-linux-slash-mac</id>
    <content type="html"><![CDATA[<p>ç›¸ä¿¡å¤§éƒ¨åˆ†çš„Linuxç”¨æˆ·éƒ½ç”¨è¿‡aliaså»è‡ªå®šä¹‰è‡ªå·±çš„å¿«æ·å‘½ä»¤,ä»Šå¤©æ•´ç†ä¸€ä¸‹è‡ªå·±å¸¸ç”¨çš„alias(åŸæ¥çš„aliaså°±æ˜¯ä¸€å¨<del>(>_&lt;)</del> )</p>

<!-- More -->


<p>æˆ‘è®¤ä¸ºï¼Œæ¯”è¾ƒå¥½çš„aliasåº”è¯¥åŒ…æ‹¬</p>

<ul>
<li>ç¬¦åˆå¤§éƒ¨åˆ†äººçš„ä¹ æƒ¯</li>
<li>å°½é‡ä½¿ç”¨å…¨æ‹¼</li>
</ul>


<p>æ¯”è¾ƒå¥½çš„aliasèƒ½å¤Ÿæå¤§çš„åŠ é€Ÿå¼€å‘æ•ˆç‡</p>

<h1>å®‰è£…</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">cd</span> <span class="o">~</span>
</span><span class='line'><span class="n">git</span> <span class="n">clone</span> <span class="nl">https</span><span class="p">:</span><span class="c1">//github.com/Justin-lu/alias.git .alias</span>
</span></code></pre></td></tr></table></div></figure>


<h1>ä½¿ç”¨</h1>

<p>æ·»åŠ ä»¥ä¸‹ä»£ç åˆ°<code>.zshrc</code>æˆ–è€…<code>.bashrc</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp"># system shortcuts</span>
</span><span class='line'><span class="n">source</span> <span class="o">~/</span><span class="p">.</span><span class="n">alias</span><span class="o">/</span><span class="n">system</span><span class="p">.</span><span class="n">alias</span>
</span><span class='line'><span class="n">alias</span> <span class="n">open</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">alias</span><span class="o">=</span><span class="err">&#39;</span><span class="n">vim</span> <span class="o">~/</span><span class="p">.</span><span class="n">alias</span><span class="o">/</span><span class="n">system</span><span class="p">.</span><span class="n">alias</span><span class="err">&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#file shortcuts</span>
</span><span class='line'><span class="n">source</span> <span class="o">~/</span><span class="p">.</span><span class="n">alias</span><span class="o">/</span><span class="n">file</span><span class="p">.</span><span class="n">alias</span>
</span><span class='line'><span class="n">alias</span> <span class="n">open</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">alias</span><span class="o">=</span><span class="err">&#39;</span><span class="n">vim</span> <span class="o">~/</span><span class="p">.</span><span class="n">alias</span><span class="o">/</span><span class="n">file</span><span class="p">.</span><span class="n">alias</span><span class="err">&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="cp"># rails</span>
</span><span class='line'><span class="n">source</span> <span class="o">~/</span><span class="p">.</span><span class="n">alias</span><span class="o">/</span><span class="n">rails</span><span class="p">.</span><span class="n">alias</span>
</span><span class='line'><span class="n">alias</span> <span class="n">open</span><span class="o">-</span><span class="n">rails</span><span class="o">-</span><span class="n">alias</span><span class="o">=</span><span class="err">&#39;</span><span class="n">vim</span> <span class="o">~/</span><span class="p">.</span><span class="n">alias</span><span class="o">/</span><span class="n">rails</span><span class="p">.</span><span class="n">alias</span><span class="err">&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="cp"># ssh</span>
</span><span class='line'><span class="n">source</span> <span class="o">~/</span><span class="p">.</span><span class="n">alias</span><span class="o">/</span><span class="n">ssh</span><span class="p">.</span><span class="n">alias</span>
</span><span class='line'><span class="n">alias</span> <span class="n">open</span><span class="o">-</span><span class="n">ssh</span><span class="o">-</span><span class="n">alias</span><span class="o">=</span><span class="err">&#39;</span><span class="n">vim</span> <span class="o">~/</span><span class="p">.</span><span class="n">alias</span><span class="o">/</span><span class="n">ssh</span><span class="p">.</span><span class="n">alias</span><span class="err">&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="cp"># Heroku alias for ezitask</span>
</span><span class='line'><span class="n">source</span> <span class="o">~/</span><span class="p">.</span><span class="n">alias</span><span class="o">/</span><span class="n">heroku</span><span class="p">.</span><span class="n">alias</span>
</span><span class='line'><span class="n">alias</span> <span class="n">open</span><span class="o">-</span><span class="n">heroku</span><span class="o">-</span><span class="n">alias</span><span class="o">=</span><span class="err">&#39;</span><span class="n">vim</span> <span class="o">~/</span><span class="p">.</span><span class="n">alias</span><span class="o">/</span><span class="n">heroku</span><span class="p">.</span><span class="n">alias</span><span class="err">&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="cp"># Git alias</span>
</span><span class='line'><span class="n">source</span> <span class="o">~/</span><span class="p">.</span><span class="n">alias</span><span class="o">/</span><span class="n">git</span><span class="p">.</span><span class="n">alias</span>
</span><span class='line'><span class="n">alias</span> <span class="n">open</span><span class="o">-</span><span class="n">git</span><span class="o">-</span><span class="n">alias</span><span class="o">=</span><span class="err">&#39;</span><span class="n">vim</span> <span class="o">~/</span><span class="p">.</span><span class="n">alias</span><span class="o">/</span><span class="n">git</span><span class="p">.</span><span class="n">alias</span><span class="err">&#39;</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Building Mobile Applications with Rails and Ionic]]></title>
    <link href="http://justin-lu.github.io/blog/2015/07/21/building-mobile-applications-with-rails-and-ionic/"/>
    <updated>2015-07-21T21:52:21+08:00</updated>
    <id>http://justin-lu.github.io/blog/2015/07/21/building-mobile-applications-with-rails-and-ionic</id>
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨railsä¸Šé¢å¼€å‘ionic.</p>

<!-- More -->


<h1>Rails å…³é”® Gem ä»‹ç»</h1>

<h2><a href="https://github.com/intridea/grape">grape</a></h2>

<blockquote><p>An opinionated micro-framework for creating REST-like APIs in Ruby</p></blockquote>

<ol>
<li>éå¸¸è½»é‡ï¼Œå¯ä»¥è„±ç¦»Railsï¼Œç›´æ¥è¿è¡Œåœ¨RackæœåŠ¡å™¨ä¹‹ä¸Šï¼Œé€Ÿåº¦éå¸¸å¿«ï¼›</li>
<li>å®Œå…¨ç¬¦åˆRESTé£æ ¼ï¼›</li>
<li>å¤§é‡DSLç®€åŒ–APIçš„ç¼–å†™ï¼›</li>
<li>æä¾›ç®€å•çš„ç‰ˆæœ¬æ§åˆ¶ï¼›</li>
<li>æ–‡ä»¶ç›®å½•ç»“æ„ï¼š</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>â”œâ”€â”€ services
</span><span class='line'>|   â”œâ”€â”€ api
</span><span class='line'>|   |   â”œâ”€â”€ entities
</span><span class='line'>|   |   â”œâ”€â”€ helpers
</span><span class='line'>|   |   |   â”œâ”€â”€ api_strong_parameters.rb
</span><span class='line'>|   |   |   â”œâ”€â”€ authorization_helper.rb
</span><span class='line'>|   |   |   â””â”€â”€ response_helper.rb
</span><span class='line'>|   |   â””â”€â”€ v1
</span><span class='line'>|   |       â”œâ”€â”€ model.rb
</span><span class='line'>|   |       â””â”€â”€ ...
</span><span class='line'>|   â”œâ”€â”€ api.rb</span></code></pre></td></tr></table></div></figure>


<pre><code>6. æ·»åŠ é…ç½®è‡³application.rb
</code></pre>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">add</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;app&#39;</span><span class="p">,</span> <span class="s1">&#39;api&#39;</span><span class="p">),</span> <span class="ss">glob</span><span class="p">:</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;**&#39;</span><span class="p">,</span> <span class="s1">&#39;*.rb&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">autoload_paths</span> <span class="o">+=</span> <span class="no">Dir</span><span class="o">[</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">config</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">/app/services/*&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<h2><a href="https://github.com/intridea/grape-entity">grape-entity</a></h2>

<blockquote><p>Entities - a simple Facade to use with your models and API - extracted from Grape.</p></blockquote>

<pre><code>1. è‡ªå®šä¹‰æ”¾å›çš„å†…å®¹
2. åµŒå¥—è¿”å›æ•°æ®
3. ...
</code></pre>

<h2><a href="https://github.com/BrandyMint/grape-swagger-rails">grape-swagger-rails</a></h2>

<blockquote><p>Integration swagger to grape in rails</p></blockquote>

<pre><code>1. APIåœ¨çº¿æµ‹è¯•å·¥å…·
</code></pre>

<h2><a href="https://github.com/cyu/rack-cors">rack-cors</a></h2>

<blockquote><p>Rack Middleware for handling Cross-Origin Resource Sharing (CORS), which makes cross-origin AJAX possible.</p></blockquote>

<pre><code>1. é…ç½®æœåŠ¡ç«¯å…è®¸è·¨åŸŸè¯·æ±‚
2. æ·»åŠ é…ç½®è‡³application.rb,ä»¥å…è®¸æ‰€æœ‰è¯·æ±‚çš„è·¨åŸŸæ“ä½œ
</code></pre>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">middleware</span><span class="o">.</span><span class="n">insert_before</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Rack::Cors&quot;</span><span class="p">,</span> <span class="ss">:debug</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span><span class="ss">:logger</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="o">-&gt;</span> <span class="p">{</span> <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span> <span class="p">})</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">allow</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">origins</span> <span class="s1">&#39;*&#39;</span>
</span><span class='line'>        <span class="n">resource</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="ss">:headers</span> <span class="o">=&gt;</span> <span class="ss">:any</span><span class="p">,</span>
</span><span class='line'>        <span class="ss">:methods</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">:delete</span><span class="p">,</span> <span class="ss">:put</span><span class="p">,</span> <span class="ss">:options</span><span class="p">,</span> <span class="ss">:head</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>        <span class="ss">:max_age</span> <span class="o">=&gt;</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2><a href="https://github.com/jpush/jpush-api-ruby-client">jpush</a></h2>

<blockquote><p>  æå…‰æ¨é€å®˜æ–¹æ”¯æŒçš„ Ruby ç‰ˆæœ¬æœåŠ¡å™¨ç«¯ SDK</p></blockquote>

<pre><code>1. é€šè¿‡é…ç½®app_key å’Œ app_secret å³å¯å‘æ¨é€é€šçŸ¥
2. demo ä»£ç 
</code></pre>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">PushNotifier</span>
</span><span class='line'>  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">client</span>
</span><span class='line'>      <span class="k">return</span> <span class="vi">@client</span> <span class="k">if</span> <span class="vi">@clien</span>
</span><span class='line'>      <span class="n">jpush_configs</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">secrets</span><span class="o">[</span><span class="s1">&#39;jpush&#39;</span><span class="o">]</span>
</span><span class='line'>      <span class="vi">@client</span> <span class="o">=</span> <span class="no">JPush</span><span class="o">::</span><span class="no">JPushClient</span><span class="o">.</span><span class="n">new</span> <span class="o">*</span><span class="n">jpush_configs</span><span class="o">.</span><span class="n">values_at</span><span class="p">(</span><span class="s1">&#39;app_key&#39;</span><span class="p">,</span> <span class="s1">&#39;app_secret&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">receiver_credential_ids</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="p">{})</span>
</span><span class='line'>      <span class="c1"># See how to define audience for pushing message, visit:</span>
</span><span class='line'>      <span class="c1"># https://github.com/jpush/jpush-api-ruby-client/blob/master/example/push_example.rb</span>
</span><span class='line'>      <span class="n">receiver_credential_ids</span> <span class="o">=</span> <span class="o">[*</span><span class="n">receiver_credential_ids</span><span class="o">]</span>
</span><span class='line'>      <span class="n">payload</span> <span class="o">=</span> <span class="no">JPush</span><span class="o">::</span><span class="no">PushPayload</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
</span><span class='line'>        <span class="ss">platform</span><span class="p">:</span> <span class="no">JPush</span><span class="o">::</span><span class="no">Platform</span><span class="o">.</span><span class="n">all</span><span class="p">,</span>
</span><span class='line'>        <span class="ss">audience</span><span class="p">:</span> <span class="no">JPush</span><span class="o">::</span><span class="no">Audience</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="ss">:_alias</span><span class="o">=&gt;</span> <span class="n">receiver_credential_ids</span><span class="p">),</span>
</span><span class='line'>        <span class="ss">notification</span><span class="p">:</span> <span class="no">JPush</span><span class="o">::</span><span class="no">Notification</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
</span><span class='line'>          <span class="ss">alert</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">ios</span><span class="p">:</span> <span class="no">JPush</span><span class="o">::</span><span class="no">IOSNotification</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
</span><span class='line'>            <span class="ss">alert</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
</span><span class='line'>            <span class="ss">badge</span><span class="p">:</span> <span class="s2">&quot;+1&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="ss">sound</span><span class="p">:</span> <span class="s2">&quot;happy&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="ss">extras</span><span class="p">:</span> <span class="n">extras</span>
</span><span class='line'>          <span class="p">),</span>
</span><span class='line'>          <span class="ss">android</span><span class="p">:</span> <span class="no">JPush</span><span class="o">::</span><span class="no">AndroidNotification</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
</span><span class='line'>            <span class="ss">alert</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
</span><span class='line'>            <span class="ss">builder_id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>            <span class="ss">extras</span><span class="p">:</span> <span class="n">extras</span>
</span><span class='line'>          <span class="p">)</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="ss">message</span><span class="p">:</span> <span class="no">JPush</span><span class="o">::</span><span class="no">Message</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
</span><span class='line'>          <span class="ss">msg_content</span><span class="p">:</span> <span class="s2">&quot;message content test&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">title</span><span class="p">:</span> <span class="s2">&quot;schoolmatch&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">content_type</span><span class="p">:</span> <span class="s2">&quot;message content type test&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">extras</span><span class="p">:</span> <span class="n">extras</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>        <span class="ss">options</span><span class="p">:</span><span class="no">JPush</span><span class="o">::</span><span class="no">Options</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
</span><span class='line'>          <span class="ss">sendno</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">apns_production</span><span class="p">:</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">production?</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>      <span class="p">)</span>
</span><span class='line'>      <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">sendPush</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span><span class='line'>      <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span> <span class="s2">&quot;Pushed message: </span><span class="si">#{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="n">result</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">debug?</span>
</span><span class='line'>      <span class="sx">%w(development test staging)</span><span class="o">.</span><span class="n">include?</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="c1"># usage: PushNotifier.push(&#39;test&#39;, 1)</span>
</span></code></pre></td></tr></table></div></figure>


<pre><code>3. æ³¨æ„`badge: "+1"`é…ç½®ï¼Œè¯¥é…ç½®æ˜¯jpushé€šè¿‡ç»´æŠ¤ç”¨æˆ·æœªè¯»æ¶ˆæ¯æ•°ï¼Œæ¯æ¬¡æ¨é€æ—¶ï¼Œéƒ½ä¼šè‡ªåŠ¨åœ¨å½“å‰æ¶ˆæ¯æ•°ä¸ŠåšåŠ 1æ“ä½œ
</code></pre>

<h2><a href="https://stripe.com/">stripe</a></h2>

<blockquote><p>å…³äºstripeçš„é›†æˆï¼Œæ¸…å‚è€ƒMartingå¤§ç¥çš„ <a href="https://ruby-china.org/topics/24897">blog</a></p></blockquote>

<h2><a href="https://github.com/saberma/china_sms">china_sms</a></h2>

<blockquote><p>ä¸­å›½å„ä¸ªçŸ­ä¿¡å¹³å° Ruby æ¥å£ï¼Œç°æ”¯æŒäº‘ç‰‡ç½‘ã€æ¨ç«‹æ–¹ã€äº¿ç¾è½¯é€šã€çŸ­ä¿¡å®ã€ç•…å‹ç½‘ç»œ</p></blockquote>

<pre><code>1. åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨[äº‘ç‰‡ç½‘](yunpian.com)è¿›è¡ŒçŸ­ä¿¡éªŒè¯
2. æ·»åŠ secret_key
3. åœ¨äº‘ç‰‡ç½‘åå°æ·»åŠ æœåŠ¡å™¨IPç™½åå•ï¼Œç­¾åï¼Œæ¨¡æ¿ï¼Œç­‰å¾…å®¡æ ¸
4. å®¡æ ¸é€šè¿‡ï¼Œå¯åœ¨Rails Consoleé‡Œé¢å‘é€çŸ­ä¿¡
  demo code
</code></pre>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">ChinaSMS</span><span class="o">.</span><span class="n">use</span> <span class="ss">:yunpian</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">china_sms</span><span class="o">[</span><span class="s2">&quot;password&quot;</span><span class="o">]</span>
</span><span class='line'><span class="no">ChinaSMS</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">debug</span>
</span><span class='line'>    <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">development?</span> <span class="o">||</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">test?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">send_to</span><span class="p">(</span><span class="n">phone</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">debug</span> <span class="o">=</span> <span class="kp">false</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">debug</span> <span class="o">||</span> <span class="nb">self</span><span class="o">.</span><span class="n">debug</span>
</span><span class='line'>      <span class="no">Rails</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="c1"># use sidekiq to send sms asynchronously</span>
</span><span class='line'>      <span class="n">delay</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">phone</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="c1"># &quot;ã€ç•™å­¦åŠ©æ‰‹ã€‘#{3721}ï¼ˆçŸ­ä¿¡éªŒè¯ç ï¼Œæœ‰æ•ˆæœŸ3åˆ†é’Ÿï¼Œè¯·å°½å¿«ä½¿ç”¨ï¼‰&quot; è¯¥æ¨¡æ¿å¿…é¡»å®¡æ ¸é€šè¿‡</span>
</span><span class='line'><span class="c1"># usage: ChinaSMS.send_to 15820700248, &quot;ã€ç•™å­¦åŠ©æ‰‹ã€‘#{3721}ï¼ˆçŸ­ä¿¡éªŒè¯ç ï¼Œæœ‰æ•ˆæœŸ3åˆ†é’Ÿï¼Œè¯·å°½å¿«ä½¿ç”¨ï¼‰&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<pre><code>5.åœ¨è¿™é‡Œï¼Œä¸ºäº†é…åˆéªŒè¯ç éªŒè¯éœ€æ±‚ï¼Œéœ€è¦åœ¨ç›¸åº”modelä¸Šæ·»åŠ `verification_code`ã€`verification_expire_at`ç­‰å­—æ®µ
</code></pre>

<h1>Iionic</h1>

<h2>Ionicç®€å•ä»‹ç»</h2>

<ol>
<li>H5 navative app(HTML,CSS,Javascript)</li>
<li>Cordova/PhoneGap + AngularJs + AngularJs

<h2>å‘½ä»¤è¡Œå·¥å…·</h2></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>  <span class="nb">alias</span> <span class="s1">&#39;ionic-serve&#39;</span><span class="o">=</span><span class="s1">&#39;ionic serve&#39;</span>
</span><span class='line'>  <span class="nb">alias</span> <span class="s1">&#39;ionic-build-ios&#39;</span><span class="o">=</span><span class="s1">&#39;ionic build ios&#39;</span>
</span><span class='line'>  <span class="nb">alias</span> <span class="s1">&#39;ionic-run-ios&#39;</span><span class="o">=</span><span class="s1">&#39;ionic run ios&#39;</span>
</span><span class='line'>  <span class="nb">alias</span> <span class="s1">&#39;ionic-emulate-ios&#39;</span><span class="o">=</span><span class="s1">&#39;ionic emulate ios --livereload&#39;</span>
</span><span class='line'>  <span class="nb">alias</span> <span class="s1">&#39;ionic-update-ios&#39;</span><span class="o">=</span><span class="s1">&#39;ionic platform update ios&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>æ„å»ºå·¥å…·</h2>

<p>  å›¾å½¢åŒ– ionic APP æ„å»ºå·¥å…· <a href="https://creator.ionic.io/">Ionic Creator</a>ï¼Œåªéœ€è¦æ‹–æ‹½å°±èƒ½åˆ›å»ºåŸºäº ionic çš„ APPäº†</p>

<h2>ç›®å½•ç»“æ„</h2>

<p>ç®€å•ä»‹ç»angularçš„ç›®å½•ç»“æ„</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>â”œâ”€â”€ www
</span><span class='line'><span class="p">|</span>   â”œâ”€â”€ js
</span><span class='line'><span class="p">|</span>   <span class="p">|</span>   â”œâ”€â”€ app.js
</span><span class='line'><span class="p">|</span>   <span class="p">|</span>   â”œâ”€â”€ controllers.js
</span><span class='line'><span class="p">|</span>   <span class="p">|</span>   â”œâ”€â”€ directives.js
</span><span class='line'><span class="p">|</span>   <span class="p">|</span>   â”œâ”€â”€ helper.js
</span><span class='line'><span class="p">|</span>   <span class="p">|</span>   â”œâ”€â”€ routes.js
</span><span class='line'><span class="p">|</span>   <span class="p">|</span>   â”œâ”€â”€ services.js
</span><span class='line'><span class="p">|</span>   <span class="p">|</span>   â””â”€â”€ translations.js
</span><span class='line'><span class="p">|</span>   â”œâ”€â”€ css
</span><span class='line'><span class="p">|</span>   â”œâ”€â”€ templates
</span><span class='line'><span class="p">|</span>   â”œâ”€â”€ img
</span><span class='line'><span class="p">|</span>   â”œâ”€â”€ lib
</span><span class='line'><span class="p">|</span>   â””â”€â”€ index.html
</span></code></pre></td></tr></table></div></figure>


<h2>IOSå¼€å‘è¯ä¹¦é…ç½®ç®€å•ä»‹ç»</h2>

<ol>
<li>åˆ›å»ºApp Id</li>
<li>åˆ›å»º Apnsè¯ä¹¦</li>
<li>åˆ›å»º Provisioning Profile è¯ä¹¦</li>
<li>é…ç½®Xcode
æ³¨æ„ï¼šæœ‰æ—¶å€™Provisioning Profileè¯ä¹¦åœ¨xcodeæ²¡æœ‰ç”Ÿæ•ˆï¼Œé‡å¯xcodeå³å¯
å›¾æ–‡é“¾æ¥æ¸…å‚è€ƒï¼š</li>
<li><a href="http://docs.jpush.io/client/ios_tutorials/#ios_1">jpush å®˜ç½‘</a></li>
<li><a href="http://blog.fir.im/how-to-build-adhoc-ipa/">fir å®˜ç½‘</a></li>
</ol>


<h2>è°ƒè¯•æŠ€å·§</h2>

<ol>
<li>Debug using Chrome <a href="https://chrome.google.com/webstore/detail/angularjs-batarang/ighdmehidhipcmcojjgiloacoafjmpfk?hl=en">AngularJS Batarang</a></li>
<li>Debug Using Safari</li>
<li>Using Xcode</li>
<li>Debug with Ionic CLI</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">alias</span> <span class="s1">&#39;ionic-emulate&#39;</span><span class="o">=</span><span class="s1">&#39;ionic emulate ios -l -c -s&#39;</span>
</span><span class='line'>ionic  <span class="o">[</span>run<span class="p">|</span>emulate<span class="o">]</span> &lt;platform&gt; <span class="o">[</span>options<span class="o">]</span>
</span><span class='line'>    <span class="o">[</span>--livereload<span class="p">|</span>-l<span class="o">]</span> .... Live Reload app dev files from the device
</span><span class='line'>    <span class="o">[</span>--consolelogs<span class="p">|</span>-c<span class="o">]</span> ... Print app console logs to Ionic CLI
</span><span class='line'>    <span class="o">[</span>--serverlogs<span class="p">|</span>-s<span class="o">]</span> .... Print dev server logs to Ionic CLI
</span><span class='line'>
</span><span class='line'>1. restart or r to restart the client app from the root
</span><span class='line'>2. goto or g and a url to have the app navigate to the given url
</span><span class='line'>3. consolelogs or c to <span class="nb">enable</span>/disable console log output
</span><span class='line'>4. serverlogs or s to <span class="nb">enable</span>/disable server log output
</span><span class='line'>5. quit or q to shutdown the server and <span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure>


<h2>æ€§èƒ½ä¼˜åŒ–</h2>

<ol>
<li>æ•´åˆ Crosswalk è‡³ Cordovaï¼ˆä¸€ä¸ªWebè¿è¡Œç¯å¢ƒï¼‰ï¼Œæ›¿æ¢è‡ªå¸¦çš„ Webviewã€‚
å…·ä½“åšæ³•ï¼Œå¯ä»¥å‚è€ƒ ionic ä¸Šçš„é“¾æ¥ï¼š <a href="http://forum.ionicframework.com/t/crosswalk-build/5778">Crosswalk Build</a></li>
<li>å…³é—­é¡µé¢åˆ‡æ¢åŠ¨ç”»ï¼Œå³ animation=&ldquo;no-animation&rdquo;</li>
<li>è¯»å–æ¨¡æ¿çš„æ—¶å€™ï¼Œæ˜¾ç¤ºâ€œåŠ è½½ä¸­â€åœˆåœˆï¼Œé¿å…å‡ºç°æ— å“åº”çš„é”™è§‰</li>
<li>ä½¿ç”¨ <a href="https://github.com/Pasvaz/bindonce">Pasvaz/bindonce</a>ï¼Œé¿å… Angular.js å¯¹é™æ€å†…å®¹ç»‘å®šæ‰€å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—</li>
</ol>


<h2>Ionicèƒ½åšä»€ä¹ˆï¼Ÿ</h2>

<h3>å¤šè¯­è¨€æ”¯æŒ</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">translations</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">en</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">students</span><span class="o">:</span> <span class="s1">&#39;Students&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">zh</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">students</span><span class="o">:</span> <span class="s1">&#39;åŒå­¦&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$translateProvider</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//Get system language</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">systemLang</span> <span class="o">=</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">language</span> <span class="o">||</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">userLanguage</span><span class="p">;</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="nx">lang</span> <span class="k">in</span> <span class="nx">translations</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">$translateProvider</span><span class="p">.</span><span class="nx">translations</span><span class="p">(</span><span class="nx">lang</span><span class="p">,</span> <span class="nx">translations</span><span class="p">[</span><span class="nx">lang</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="c1">//Set app language</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">appLang</span> <span class="o">=</span> <span class="nx">helper</span><span class="p">.</span><span class="nx">matchLanguageString</span><span class="p">(</span><span class="nx">systemLang</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">$translateProvider</span><span class="p">.</span><span class="nx">preferredLanguage</span><span class="p">(</span><span class="nx">appLang</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h3>æ¶ˆæ¯æ¨é€</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;xx.services&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;Push&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">push</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">setAlias</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">alias</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">push</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;jpush: set alias&#39;</span><span class="p">,</span> <span class="nx">alias</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">plugins</span><span class="p">.</span><span class="nx">jPushPlugin</span><span class="p">.</span><span class="nx">setAlias</span><span class="p">(</span><span class="nx">alias</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">notificationCallback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;jpush: start init-----------------------&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">push</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">plugins</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">jPushPlugin</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">push</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;jpush: init&#39;</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">plugins</span><span class="p">.</span><span class="nx">jPushPlugin</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
</span><span class='line'>          <span class="nx">plugins</span><span class="p">.</span><span class="nx">jPushPlugin</span><span class="p">.</span><span class="nx">setDebugMode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">plugins</span><span class="p">.</span><span class="nx">jPushPlugin</span><span class="p">.</span><span class="nx">openNotificationInAndroidCallback</span> <span class="o">=</span> <span class="nx">notificationCallback</span><span class="p">;</span>
</span><span class='line'>          <span class="nx">plugins</span><span class="p">.</span><span class="nx">jPushPlugin</span><span class="p">.</span><span class="nx">receiveNotificationIniOSCallback</span> <span class="o">=</span> <span class="nx">notificationCallback</span><span class="p">;</span>
</span><span class='line'>          <span class="nx">plugins</span><span class="p">.</span><span class="nx">jPushPlugin</span><span class="p">.</span><span class="nx">receiveMessageIniOSCallback</span> <span class="o">=</span> <span class="nx">notificationCallback</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Push</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">notificationCallback</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">notificationCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">notification</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">fromJson</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//app æ˜¯å¦å¤„äºæ­£åœ¨è¿è¡ŒçŠ¶</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">isActive</span> <span class="o">=</span> <span class="nx">notification</span><span class="p">.</span><span class="nx">notification</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">// here add your code</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3><a href="http://ngcordova.com/">ngcordova</a> <a href="http://ngcordova.com/docs/plugins/">Plugin</a></h3>

<blockquote><p>  è°ƒç”¨æ‰‹æœºæ‘„åƒå¤´
  IOSæŒ‡çº¹è¯†åˆ«
  OAuth
  è·å–åœ°ç†ä½ç½®</p></blockquote>

<h2>å¦‚ä½•ä¸Railsç»“åˆ</h2>

<ul>
<li>Rails è´Ÿè´£æä¾›REST API</li>
<li>Ionic é€šè¿‡ng-resourceè°ƒç”¨REST API</li>
</ul>


<h2>æµ‹è¯•ä¸å‘å¸ƒ</h2>

<ul>
<li>Android æ‰“åŒ…</li>
<li>iOS æ‰“åŒ…</li>
<li>å‘å¸ƒæµ‹è¯•ç‰ˆæœ¬ <a href="http://fir.im/">fir.im</a></li>
<li>ç”Ÿæˆæˆªå›¾ <a href="https://launchkit.io/screenshots/onboard/add-screenshot?layout=below">screenshots</a></li>
<li>æäº¤åˆ° app store</li>
</ul>


<h2>ä»€ä¹ˆæ—¶å€™ç”¨Ionic</h2>

<ul>
<li><p>ç”¨Ionicå¼€å‘çš„ä¼˜ç‚¹å’Œç¼ºç‚¹</p>

<ul>
<li>ä¼˜ç‚¹: ä¸€æ¬¡å¼€å‘ï¼Œå¤šä¸ªå¹³å°ï¼Œå¼€å‘æ•ˆç‡é«˜</li>
<li>ç¼ºç‚¹ï¼š
1.å¯¹å¼€å‘äººå‘˜çš„è¦æ±‚å¾ˆé«˜ï¼Œå¦‚æœéœ€è¦ç¼–è¯‘æˆnative appéœ€è¦å¼€å‘äººå‘˜äº†è§£ webã€iosã€andriod ä¸‰ç§å¼€å‘æŠ€æœ¯
2.æ€§èƒ½é—®é¢˜
3.ä¸æ”¯æŒè¾ƒä½Androidç‰ˆæœ¬ï¼ˆ4.1ï¼‰</li>
</ul>
</li>
<li><p>å“ªäº›åº”ç”¨é€‚åˆç”¨Ionicæ¥å¼€å‘:</p>

<ul>
<li>ä¸å±äºæ¸¸æˆä¹‹ç±»çš„APPç±»å‹ï¼›</li>
<li>æƒ³ä½æˆæœ¬ã€å¿«é€Ÿè¿­ä»£åœ°å¼€å‘ Androidã€iOS å¹³å°ä¸Šçš„åº”ç”¨ï¼›</li>
<li>ç›®æ ‡ç»ˆç«¯çš„è®¾å¤‡æ€§èƒ½ä¸ç®—ä½ï¼›</li>
<li><a href="http://ionichina.com/showcase">å›½å†…ä¾‹å­</a></li>
<li><a href="http://showcase.ionicframework.com">å›½å¤–ä¾‹å­</a></li>
</ul>
</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Google map with ionic]]></title>
    <link href="http://justin-lu.github.io/blog/2015/07/06/google-map-with-ionic/"/>
    <updated>2015-07-06T16:03:52+08:00</updated>
    <id>http://justin-lu.github.io/blog/2015/07/06/google-map-with-ionic</id>
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ionicæ·»åŠ google map.</p>

<!-- More -->


<p>åˆå§‹åŒ–ionicé¡¹ç›®</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>  ionic start map blank --sass --id com.beansmile.maps
</span><span class='line'>  <span class="nb">cd </span>map
</span><span class='line'>  npm install
</span><span class='line'>  gulp sass
</span></code></pre></td></tr></table></div></figure>


<p>æ·»åŠ ä»¥ä¸‹ä»£ç åˆ°ionic.project</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="s2">&quot;gulpStartupTasks&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;sass&quot;</span><span class="p">,</span> <span class="s2">&quot;watch&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸ªäººå»ºè®®åœ¨åˆå§‹åŒ–ionicé¡¹ç›®çš„æ—¶å€™ï¼Œ<code>id</code>å‚æ•°æ˜¯å¿…é¡»çš„ï¼Œç”Ÿæˆçš„idå°†åšä¸ºios app çš„<code>bundle id</code>å’Œandroid appçš„<code>package name</code>
&ndash;sass å‚æ•°é»˜è®¤å¯åŠ¨sassåŠŸèƒ½,ä¹Ÿå¯ä»¥åœ¨ä»¥åæ·»åŠ ï¼Œè¯¦è§<a href="http://ionicframework.com/docs/cli/sass.html">Using Sass</a></p>

<p>æ·»åŠ å®šä½æ’ä»¶geolocation</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>  ionic plugin add cordova-plugin-geolocation
</span></code></pre></td></tr></table></div></figure>


<p>æŸ¥çœ‹<a href="https://developers.google.com/maps/documentation/javascript/tutorial">Google Maps Javascript SKD</a>å¹¶åˆ°<a href="https://code.google.com/apis/console/b/0/?pli=1">Google API Console</a>åˆ›å»ºä¸€ä¸ªGoogle Maps application.</p>

<p>å½“ä½ æ‹¿åˆ°ä½ çš„<code>google api key</code>åï¼Œæ·»åŠ åˆ°<code>www/index.html</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">charset</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;viewport&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;&lt;</span><span class="err">/title&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">&lt;!--</span> <span class="nx">IF</span> <span class="nx">using</span> <span class="nx">Sass</span> <span class="p">(</span><span class="nx">run</span> <span class="nx">gulp</span> <span class="nx">sass</span> <span class="nx">first</span><span class="p">),</span> <span class="nx">then</span> <span class="nx">uncomment</span> <span class="nx">below</span> <span class="nx">and</span> <span class="nx">remove</span> <span class="nx">the</span> <span class="nx">CSS</span> <span class="nx">includes</span> <span class="nx">above</span> <span class="o">--&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">link</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;css/ionic.app.css&quot;</span> <span class="nx">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">&lt;!--</span> <span class="nx">ionic</span><span class="o">/</span><span class="nx">angularjs</span> <span class="nx">js</span> <span class="o">--&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;lib/ionic/js/ionic.bundle.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;https://maps.googleapis.com/maps/api/js?key=[YOU KEY HERE]&amp;sensor=true&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">&lt;!--</span> <span class="nx">cordova</span> <span class="nx">script</span> <span class="p">(</span><span class="k">this</span> <span class="nx">will</span> <span class="nx">be</span> <span class="nx">a</span> <span class="mi">404</span> <span class="nx">during</span> <span class="nx">development</span><span class="p">)</span> <span class="o">--&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;cordova.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">&lt;!--</span> <span class="nx">your</span> <span class="nx">app</span><span class="err">&#39;</span><span class="nx">s</span> <span class="nx">js</span> <span class="o">--&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;js/app.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;js/controllers.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;js/directives.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">/head&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">body</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">app</span><span class="o">=</span><span class="s2">&quot;starter&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">controller</span><span class="o">=</span><span class="s2">&quot;MapCtrl&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">ion</span><span class="o">-</span><span class="nx">header</span><span class="o">-</span><span class="nx">bar</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;bar-stable&quot;</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">h1</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;title&quot;</span><span class="o">&gt;</span><span class="nx">Map</span><span class="o">&lt;</span><span class="err">/h1&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="err">/ion-header-bar&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">ion</span><span class="o">-</span><span class="nx">content</span> <span class="nx">scroll</span><span class="o">=</span><span class="s2">&quot;false&quot;</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">a</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;button button-icon icon ion-location map-icon-location active&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">click</span><span class="o">=</span><span class="s2">&quot;centerOnMe()&quot;</span><span class="o">&gt;&lt;</span><span class="err">/a&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">a</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;button button-icon icon ion-navicon map-icon-menu&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">click</span><span class="o">=</span><span class="s2">&quot;direction()&quot;</span><span class="o">&gt;&lt;</span><span class="err">/a&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">map</span> <span class="nx">on</span><span class="o">-</span><span class="nx">create</span><span class="o">=</span><span class="s2">&quot;mapCreated(map)&quot;</span><span class="o">&gt;&lt;</span><span class="err">/map&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="err">/ion-content&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">ion</span><span class="o">-</span><span class="nx">footer</span><span class="o">-</span><span class="nx">bar</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;bar-stable&quot;</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">a</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;button button-icon icon ion-woman item-button-left&quot;</span><span class="o">&gt;&lt;</span><span class="err">/a&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">a</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;button button-icon icon ion-chevron-right item-button-right&quot;</span><span class="o">&gt;&lt;</span><span class="err">/a&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">/a&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="err">/ion-footer-bar&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">/body&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ·»åŠ æ ·å¼</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">map</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">display</span><span class="o">:</span> <span class="k">block</span><span class="p">;</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
</span><span class='line'>  <span class="k">height</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nc">.scroll</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">height</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.map-icon-location</span><span class="p">{</span>
</span><span class='line'>  <span class="k">background-color</span><span class="o">:</span> <span class="m">#fff</span><span class="p">;</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span> <span class="m">47px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">47px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">margin-top</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">margin-left</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">position</span><span class="o">:</span> <span class="k">fixed</span><span class="p">;</span>
</span><span class='line'>  <span class="k">z-index</span><span class="o">:</span> <span class="m">10000</span><span class="p">;</span>
</span><span class='line'>  <span class="n">box</span><span class="o">-</span><span class="n">shadow</span><span class="o">:</span> <span class="m">1px</span> <span class="m">1px</span> <span class="m">3px</span> <span class="m">2px</span> <span class="m">#C2BDBD</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nc">.map-icon-location.active</span><span class="o">,</span> <span class="nc">.map-icon-menu.active</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">background-color</span><span class="o">:</span> <span class="m">#49AEF8</span> <span class="cp">!important</span><span class="p">;</span>
</span><span class='line'>  <span class="k">opacity</span><span class="o">:</span> <span class="m">1</span> <span class="cp">!important</span><span class="p">;</span>
</span><span class='line'>  <span class="k">color</span><span class="o">:</span> <span class="m">#fff</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.map-icon-menu</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">background-color</span><span class="o">:</span> <span class="m">#fff</span><span class="p">;</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span> <span class="m">47px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">47px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">margin-top</span><span class="o">:</span> <span class="m">100px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">margin-left</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">position</span><span class="o">:</span> <span class="k">fixed</span><span class="p">;</span>
</span><span class='line'>  <span class="k">z-index</span><span class="o">:</span> <span class="m">10000</span><span class="p">;</span>
</span><span class='line'>  <span class="n">box</span><span class="o">-</span><span class="n">shadow</span><span class="o">:</span> <span class="m">1px</span> <span class="m">1px</span> <span class="m">3px</span> <span class="m">2px</span> <span class="m">#C2BDBD</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ·»åŠ mapçš„directives</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;starter.directives&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span class='line'>
</span><span class='line'><span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">restrict</span><span class="o">:</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">scope</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">onCreate</span><span class="o">:</span> <span class="s1">&#39;&amp;&#39;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">link</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$element</span><span class="p">,</span> <span class="nx">$attr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">function</span> <span class="nx">initialize</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">mapOptions</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">center</span><span class="o">:</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="mf">43.07493</span><span class="p">,</span> <span class="o">-</span><span class="mf">89.381388</span><span class="p">),</span>
</span><span class='line'>          <span class="nx">zoom</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">mapTypeId</span><span class="o">:</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">MapTypeId</span><span class="p">.</span><span class="nx">ROADMAP</span>
</span><span class='line'>        <span class="p">};</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">Map</span><span class="p">(</span><span class="nx">$element</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">mapOptions</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">onCreate</span><span class="p">({</span><span class="nx">map</span><span class="o">:</span> <span class="nx">map</span><span class="p">});</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Stop the side bar from dragging when mousedown/tapdown on the map</span>
</span><span class='line'>        <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">addDomListener</span><span class="p">(</span><span class="nx">$element</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;mousedown&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span><span class='line'>          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="s2">&quot;complete&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">initialize</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">addDomListener</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="nx">initialize</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ·»åŠ å¯¹äºçš„controller.js</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;starter.controllers&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span class='line'>
</span><span class='line'><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;MapCtrl&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$ionicLoading</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">mapCreated</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">map</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">map</span> <span class="o">=</span> <span class="nx">map</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">direction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$scope</span><span class="p">.</span><span class="nx">map</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">loading</span> <span class="o">=</span> <span class="nx">$ionicLoading</span><span class="p">.</span><span class="nx">show</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;Getting current location...&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">showBackdrop</span><span class="o">:</span> <span class="kc">false</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">.</span><span class="nx">getCurrentPosition</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">pos</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Got pos&#39;</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">center</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="mf">37.772323</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.214897</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">target</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="mf">37.771923</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.219339</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">$scope</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">setCenter</span><span class="p">(</span><span class="nx">center</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">directionsDisplay</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">DirectionsRenderer</span><span class="p">();</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">directionsService</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">DirectionsService</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">directionsDisplay</span><span class="p">.</span><span class="nx">setMap</span><span class="p">(</span><span class="nx">$scope</span><span class="p">.</span><span class="nx">map</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">origin</span><span class="o">:</span><span class="nx">center</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">destination</span><span class="o">:</span><span class="nx">target</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">travelMode</span><span class="o">:</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">TravelMode</span><span class="p">.</span><span class="nx">DRIVING</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>      <span class="nx">directionsService</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">,</span> <span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">status</span> <span class="o">==</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">DirectionsStatus</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">directionsDisplay</span><span class="p">.</span><span class="nx">setDirections</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">$ionicLoading</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
</span><span class='line'>    <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Unable to get location: &#39;</span> <span class="o">+</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">centerOnMe</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Centering&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$scope</span><span class="p">.</span><span class="nx">map</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">.</span><span class="nx">loading</span> <span class="o">=</span> <span class="nx">$ionicLoading</span><span class="p">.</span><span class="nx">show</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;Getting current location...&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">showBackdrop</span><span class="o">:</span> <span class="kc">false</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">.</span><span class="nx">getCurrentPosition</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">pos</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Got pos&#39;</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">center</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">latitude</span><span class="p">,</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">longitude</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">$scope</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">setCenter</span><span class="p">(</span><span class="nx">center</span><span class="p">);</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">marker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">Marker</span><span class="p">({</span>
</span><span class='line'>        <span class="nx">position</span><span class="o">:</span> <span class="nx">center</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">map</span><span class="o">:</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">map</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Hello World!&#39;</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>      <span class="nx">$ionicLoading</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
</span><span class='line'>    <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Unable to get location: &#39;</span> <span class="o">+</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ‰“å¼€app.jsï¼Œæ³¨å…¥controllers directives</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;starter&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ionic&#39;</span><span class="p">,</span><span class="s1">&#39;starter.controllers&#39;</span><span class="p">,</span> <span class="s1">&#39;starter.directives&#39;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä»¥ä¸Šæ ¹æ®google api, æ·»åŠ äº†å®šä½åŠŸèƒ½;ä¸¤ä¸ªåœ°ç‚¹çš„è·¯çº¿è§„åˆ’åŠŸèƒ½,ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼ŒAåœ°ç‚¹å’ŒBåœ°ç‚¹çš„ç»çº¬åº¦æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥éšæ„æ›´æ”¹ã€‚</p>

<p>æœ€åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå³å¯åœ¨ä½ çš„æ‰‹æœºä½¿ç”¨è¿™ä¸ªappäº†ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>  ionic build ios
</span><span class='line'>  ionic run ios --devise
</span></code></pre></td></tr></table></div></figure>


<p>æ›´å¤šgoogle map apiï¼Œè¯·çœ‹ <a href="https://developers.google.com/maps/documentation/javascript/examples/">example</a></p>

<p>é™„ä¸Šæ•ˆæœå›¾ä¸€å¼ </p>

<p><img src="http://justin-lu.github.io/images/blog/google-map.jpg" alt="google map" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç†è§£ ActiveSupport::Concern ]]></title>
    <link href="http://justin-lu.github.io/blog/2015/07/05/li-jie-activesupport-concern/"/>
    <updated>2015-07-05T21:49:00+08:00</updated>
    <id>http://justin-lu.github.io/blog/2015/07/05/li-jie-activesupport-concern</id>
    <content type="html"><![CDATA[<p>åˆ†äº«ä¸€ä¸‹è‡ªå·±é˜…è¯»ActiveSupport::Concernæºç çš„è¿‡ç¨‹ï¼Œå¸Œæœ›å’Œå¤§å®¶ä¸€èµ·å­¦ä¹ ï¼Œé”™è¯¯ä¹‹å¤„ï¼Œè¿˜è¯·æŒ‡å‡º</p>

<!-- More -->


<p>åœ¨æŸ¥çœ‹ActiveSupport::Concern <a href="https://github.com/rails/rails/blob/master/activesupport/lib/active_support/concern.rb">æºç </a>ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç†è§£å‡ ä¸ªæ¦‚å¿µ</p>

<h2>class_eval and instance_eval</h2>

<h3>instance_eval</h3>

<p>é¦–å…ˆä»åå­—å¯ä»¥å¾—åˆ°çš„ä¿¡æ¯æ˜¯ï¼Œ<code>instance_eval</code>çš„è°ƒç”¨è€…<code>receiver</code>å¿…é¡»æ˜¯ä¸€ä¸ªå®ä¾‹<code>instance</code>ï¼Œè€Œåœ¨<code>instance_eval</code> blockçš„å†…éƒ¨ï¼Œselfå³ä¸ºreceiverå®ä¾‹æœ¬èº«ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># ä¾‹å­ä¸€</span>
</span><span class='line'><span class="n">obj_instance</span><span class="o">.</span><span class="n">instance_eval</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">self</span>  <span class="c1"># =&gt; obj_instance</span>
</span><span class='line'>  <span class="c1"># current class =&gt; obj_instance&#39;s singleton class</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ ¹æ®è¿™ä¸ªå®šä¹‰ï¼Œå¦‚æœåœ¨ä¸€ä¸ªå®ä¾‹ä¸Šè°ƒç”¨äº†<code>instance_eval</code>ï¼Œå°±å¯ä»¥åœ¨å…¶ä¸­å®šä¹‰è¯¥å®ä¾‹çš„å•æ€å‡½æ•°<code>singleton_method</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># ä¾‹å­äºŒ</span>
</span><span class='line'><span class="k">class</span> <span class="nc">A</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">a</span><span class="o">.</span><span class="n">instance_eval</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="nb">self</span>  <span class="c1"># =&gt; a</span>
</span><span class='line'>  <span class="c1"># current class =&gt; a&#39;s singleton class</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">method1</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;this is a singleton method of instance a&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">a</span><span class="o">.</span><span class="n">method1</span>
</span><span class='line'><span class="c1">#=&gt; this is a singleton method of instance a</span>
</span><span class='line'>
</span><span class='line'><span class="n">b</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">b</span><span class="o">.</span><span class="n">method1</span>
</span><span class='line'><span class="c1">#=&gt; NoMethodError: undefined method `method1&#39; for #&lt;A:0x007fbc2ced9550&gt;</span>
</span><span class='line'><span class="n">from</span> <span class="p">(</span><span class="n">pry</span><span class="p">):</span><span class="mi">13</span><span class="ss">:in</span> <span class="sb">`&lt;main&gt;&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æˆ‘ä»¬æ‰€çŸ¥ï¼Œå› ä¸ºç±»æœ¬èº«ä¹Ÿæ˜¯Classç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œinstance_evalä¹Ÿå¯ä»¥ç”¨åœ¨ç±»ä¸Šï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥åœ¨å…¶ä¸­å®šä¹‰è¯¥ç±»çš„singleton_methodï¼Œå³ä¸ºè¯¥ç±»çš„ç±»æ–¹æ³•.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># ä¾‹å­ä¸‰</span>
</span><span class='line'><span class="k">class</span> <span class="nc">A</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">A</span><span class="o">.</span><span class="n">instance_eval</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="nb">self</span>  <span class="c1"># =&gt; A</span>
</span><span class='line'>  <span class="c1"># current class =&gt; A&#39;s singleton class</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">method1</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s1">&#39;this is a singleton method of class A&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">A</span><span class="o">.</span><span class="n">method1</span>
</span><span class='line'><span class="c1"># this is a singleton method of class A</span>
</span><span class='line'><span class="c1">#=&gt;  nil</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#=&gt; NoMethodError: undefined method `method1&#39; for #&lt;A:0x007fbc3009e180&gt;</span>
</span><span class='line'><span class="n">from</span> <span class="p">(</span><span class="n">pry</span><span class="p">):</span><span class="mi">11</span><span class="ss">:in</span> <span class="sb">`&lt;main&gt;&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>class_eval</h3>

<p>å†æ¥çœ‹<code>class_eval</code>ï¼Œé¦–å…ˆä»åå­—å¯ä»¥å¾—åˆ°çš„ä¿¡æ¯æ˜¯ï¼Œclass_evalçš„è°ƒç”¨è€…receiverå¿…é¡»æ˜¯ä¸€ä¸ªç±»ï¼Œè€Œåœ¨<code>class_eval</code> <code>block</code>çš„å†…éƒ¨ï¼Œ<code>self</code>å³ä¸ºreceiverç±»æœ¬èº«ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># ä¾‹å­å››</span>
</span><span class='line'><span class="k">class</span> <span class="nc">A</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">A</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="nb">self</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="c1"># =&gt; A</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ ¹æ®è¿™ä¸ªå®šä¹‰ï¼Œå¦‚æœåœ¨ä¸€ä¸ªç±»ä¸Šè°ƒç”¨äº†class_evalï¼Œå°±å¯ä»¥åœ¨å…¶ä¸­å®šä¹‰è¯¥ç±»çš„å®ä¾‹æ–¹æ³•(instance_method)ï¼Œä¾‹å¦‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># ä¾‹å­äº”</span>
</span><span class='line'><span class="k">class</span> <span class="nc">A</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">a</span><span class="o">.</span><span class="n">method1</span>
</span><span class='line'><span class="c1">#=&gt; NoMethodError: undefined method `method1&#39; for &lt;A:0x007fbc29a826f8&gt; from (pry):21:in `&lt;main&gt;&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">A</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">method1</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s1">&#39;this is a instance method of class A&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">a</span><span class="o">.</span><span class="n">method1</span>
</span><span class='line'><span class="c1">#=&gt; this is a instance method of class A</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç»¼åˆä¸Šé¢ä¾‹å­ï¼Œæˆ‘ä»¬å¯å¾—å‡º</p>

<pre><code>1. `instance_eval`å¿…é¡»ç”±instanceæ¥è°ƒç”¨ï¼Œå¯ä»¥ç”¨æ¥å®šä¹‰å•ä¾‹å‡½æ•°ï¼ˆ`singleton_methods`)
2. `class_eval`å¿…é¡»æ˜¯ç”±classæ¥è°ƒç”¨ï¼Œå¯ä»¥ç”¨æ¥å®šä¹‰ç±»çš„å®ä¾‹æ–¹æ³•(`instance_methods`)
</code></pre>

<h2>include and extend</h2>

<p>åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆçœ‹ä»£ç ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># ä¾‹å­å…­</span>
</span><span class='line'><span class="k">module</span> <span class="nn">Foo</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">foo</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s1">&#39;foo method with include...&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Bar</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Foo</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Bar</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">foo</span>
</span><span class='line'><span class="c1"># foo method with include...</span>
</span><span class='line'><span class="c1"># =&gt; nil</span>
</span><span class='line'><span class="no">Bar</span><span class="o">.</span><span class="n">foo</span>
</span><span class='line'><span class="c1"># NoMethodError: undefined method `foo&#39; for Bar:Class</span>
</span><span class='line'><span class="c1"># from (pry):75:in `&lt;main&gt;&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Baz</span>
</span><span class='line'>  <span class="kp">extend</span> <span class="no">Foo</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Baz</span><span class="o">.</span><span class="n">foo</span>
</span><span class='line'><span class="c1"># foo method with include...</span>
</span><span class='line'><span class="c1"># =&gt; nil</span>
</span><span class='line'>
</span><span class='line'><span class="no">Baz</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">foo</span>
</span><span class='line'><span class="c1"># NoMethodError: undefined method `foo&#39; for #&lt;Baz:0x007f8061dec068&gt;</span>
</span><span class='line'><span class="c1"># from (pry):80:in `&lt;main&gt;&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç”±ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œ<code>include</code>ä¼šæŠŠ<code>module</code>çš„æ–¹æ³•å˜æˆå®ä¾‹æ–¹æ³•ï¼Œ<code>extend</code> ä¼šæŠŠæ–¹æ³•å˜æˆç±»æ–¹æ³•ã€‚
ä½†æ˜¯ï¼Œå¤§å¤šæ—¶å€™æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨<code>include</code>æ¥å®ç°ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•ï¼Œè¯·çœ‹ä»¥ä¸‹ä¾‹å­ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># ä¾‹å­ä¸ƒ</span>
</span><span class='line'><span class="k">module</span> <span class="nn">Foo</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
</span><span class='line'>    <span class="n">base</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="no">ClassMethods</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">module</span> <span class="nn">ClassMethods</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">bar</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s1">&#39;class method&#39;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">foo</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s1">&#39;instance method&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Baz</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Foo</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Baz</span><span class="o">.</span><span class="n">bar</span>
</span><span class='line'><span class="c1"># class method</span>
</span><span class='line'><span class="c1"># =&gt; nil</span>
</span><span class='line'><span class="no">Baz</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">foo</span>
</span><span class='line'><span class="c1"># instance method</span>
</span><span class='line'><span class="c1"># =&gt; nil</span>
</span><span class='line'><span class="no">Baz</span><span class="o">.</span><span class="n">foo</span>
</span><span class='line'><span class="c1"># NoMethodError: undefined method `foo&#39; for Baz:Class</span>
</span><span class='line'><span class="no">Baz</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">bar</span>
</span><span class='line'><span class="c1"># NoMethodError: undefined method `bar&#39; for #&lt;Baz:0x007fbc30274ab8&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä»ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œ<code>include</code>æœ‰ä¸€ä¸ªå«<code>included</code>çš„é’©å­ï¼Œæ­£æ˜¯é€šè¿‡è¿™ä¸ªé’©å­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code>include</code>å®ç°æ·»åŠ ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•
æˆ‘ä»¬æ¥çœ‹çœ‹<code>included</code>è¿™ä¸ªé’©å­åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">module</span> <span class="nn">A</span>
</span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">self</span><span class="si">}</span><span class="s2"> included in </span><span class="si">#{</span><span class="n">mod</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">Enumerable</span>
</span><span class='line'>    <span class="kp">include</span> <span class="n">A</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="c1"># A included in Enumerable</span>
</span><span class='line'>  <span class="c1"># =&gt; Enumerable</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä»ä»£ç æˆ‘ä»¬çš„è¾“å‡ºæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œ<code>included</code>ç±»æ–¹æ³•ä½œç”¨åŸŸ<code>self</code>ä¸º<code>Module A</code>ï¼Œå¹¶ä¼ å…¥<code>include A</code>çš„<code>receiver Enumerable</code>ã€‚ç„¶åæˆ‘ä»¬å†çœ‹çœ‹ä¾‹å­ä¸ƒï¼Œç»“åˆ<code>extend</code>ä¸<code>include</code>çš„ç†è§£ï¼Œå°±èƒ½æ˜ç™½å…¶ä¸­çš„åŸç†æ‰€åœ¨ã€‚</p>

<p>å†æ¥çœ‹çœ‹ActiveSupport::Concernçš„å®ç°ï¼š</p>

<ol>
<li>åœ¨æ²¡æœ‰å¼•å…¥<code>ActiveSupport::Concern</code>ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è¿›è¡Œæ¨¡å—åˆ†ç¦»</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">module</span> <span class="nn">M</span>
</span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
</span><span class='line'>      <span class="n">base</span><span class="o">.</span><span class="n">extend</span> <span class="no">ClassMethods</span>
</span><span class='line'>      <span class="n">base</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">scope</span> <span class="ss">:disabled</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">disabled</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="kp">include</span> <span class="no">InstanceMethods</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">module</span> <span class="nn">ClassMethods</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">say_hello</span>
</span><span class='line'>        <span class="nb">puts</span> <span class="s2">&quot;say hello&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">module</span> <span class="nn">InstanceMethods</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">say_no</span>
</span><span class='line'>        <span class="nb">puts</span> <span class="s2">&quot;say no&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä»ä»£ç å¯çŸ¥ï¼Œé€šè¿‡<code>extend</code>å’Œ<code>class_eval</code>ä¸º<code>base</code>å®šä¹‰äº†<code>ClassMethods</code>é‡Œé¢çš„ç±»æ–¹æ³•ï¼Œé€šè¿‡<code>include</code> ä¸º<code>base</code>å®šä¹‰äº†<code>InstanceMethods</code>é‡Œé¢çš„å®åŠ›æ–¹æ³•ã€‚</p>

<p>å½“æˆ‘ä»¬å¼•å…¥<code>ActiveSupport::Concern</code>ä¹‹åï¼Œä»¥ä¸Šä¾‹å­æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="nb">require</span> <span class="s1">&#39;active_support/concern&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">module</span> <span class="nn">M</span>
</span><span class='line'>    <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">included</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">scope</span> <span class="ss">:disabled</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">disabled</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="kp">include</span> <span class="no">InstanceMethods</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">module</span> <span class="nn">ClassMethods</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">say_hello</span>
</span><span class='line'>        <span class="nb">puts</span> <span class="s2">&quot;say hello&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">module</span> <span class="nn">InstanceMethods</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">say_no</span>
</span><span class='line'>        <span class="nb">puts</span> <span class="s2">&quot;say no&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>æœ€åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹[ActiveSupport::Concern] (<a href="https://github.com/rails/rails/blob/master/activesupport/lib/active_support/concern.rb">https://github.com/rails/rails/blob/master/activesupport/lib/active_support/concern.rb</a>),æ˜¯ä¸æ˜¯å°±å¾ˆå¥½ç†è§£äº†ï¼Ÿ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Concern</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">MultipleIncludedBlocks</span> <span class="o">&lt;</span> <span class="no">StandardError</span> <span class="c1">#:nodoc:</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>        <span class="k">super</span> <span class="s2">&quot;Cannot define multiple &#39;included&#39; blocks for a Concern&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">extended</span><span class="p">(</span><span class="n">base</span><span class="p">)</span> <span class="c1">#:nodoc:</span>
</span><span class='line'>      <span class="n">base</span><span class="o">.</span><span class="n">instance_variable_set</span><span class="p">(</span><span class="ss">:@_dependencies</span><span class="p">,</span> <span class="o">[]</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">append_features</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">base</span><span class="o">.</span><span class="n">instance_variable_defined?</span><span class="p">(</span><span class="ss">:@_dependencies</span><span class="p">)</span>
</span><span class='line'>        <span class="n">base</span><span class="o">.</span><span class="n">instance_variable_get</span><span class="p">(</span><span class="ss">:@_dependencies</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
</span><span class='line'>        <span class="k">return</span> <span class="kp">false</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="k">return</span> <span class="kp">false</span> <span class="k">if</span> <span class="n">base</span> <span class="o">&lt;</span> <span class="nb">self</span>
</span><span class='line'>        <span class="vi">@_dependencies</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">dep</span><span class="o">|</span> <span class="n">base</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">super</span>
</span><span class='line'>        <span class="n">base</span><span class="o">.</span><span class="n">extend</span> <span class="nb">const_get</span><span class="p">(</span><span class="ss">:ClassMethods</span><span class="p">)</span> <span class="k">if</span> <span class="nb">const_defined?</span><span class="p">(</span><span class="ss">:ClassMethods</span><span class="p">)</span>
</span><span class='line'>        <span class="n">base</span><span class="o">.</span><span class="n">class_eval</span><span class="p">(</span><span class="o">&amp;</span><span class="vi">@_included_block</span><span class="p">)</span> <span class="k">if</span> <span class="n">instance_variable_defined?</span><span class="p">(</span><span class="ss">:@_included_block</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">included</span><span class="p">(</span><span class="n">base</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">base</span><span class="o">.</span><span class="n">nil?</span>
</span><span class='line'>        <span class="k">raise</span> <span class="no">MultipleIncludedBlocks</span> <span class="k">if</span> <span class="n">instance_variable_defined?</span><span class="p">(</span><span class="ss">:@_included_block</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="vi">@_included_block</span> <span class="o">=</span> <span class="n">block</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="k">super</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">class_methods</span><span class="p">(</span><span class="o">&amp;</span><span class="n">class_methods_module_definition</span><span class="p">)</span>
</span><span class='line'>      <span class="n">mod</span> <span class="o">=</span> <span class="nb">const_defined?</span><span class="p">(</span><span class="ss">:ClassMethods</span><span class="p">,</span> <span class="kp">false</span><span class="p">)</span> <span class="p">?</span>
</span><span class='line'>        <span class="nb">const_get</span><span class="p">(</span><span class="ss">:ClassMethods</span><span class="p">)</span> <span class="p">:</span>
</span><span class='line'>        <span class="nb">const_set</span><span class="p">(</span><span class="ss">:ClassMethods</span><span class="p">,</span> <span class="no">Module</span><span class="o">.</span><span class="n">new</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">mod</span><span class="o">.</span><span class="n">module_eval</span><span class="p">(</span><span class="o">&amp;</span><span class="n">class_methods_module_definition</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Rails4.1 ä¹‹åï¼ŒModuleè¿˜åŠ å…¥äº†<a href="http://api.rubyonrails.org/v4.1.0/classes/Module/Concerning.html">Concerning</a>æ–¹æ³•</p>

<h2>Concerning</h2>

<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç»†åŒ–concernçš„å‡ ç§æ–¹æ³•</p>

<ul>
<li>é€šè¿‡æ³¨é‡Š</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Todo</span>
</span><span class='line'>  <span class="c1"># Other todo implementation</span>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">## Event tracking</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:events</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">before_create</span> <span class="ss">:track_creation</span>
</span><span class='line'>  <span class="n">after_destroy</span> <span class="ss">:track_deletion</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">track_creation</span>
</span><span class='line'>      <span class="c1"># ...</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>é€šè¿‡<code>ActiveSupport::Concern</code></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Todo</span>
</span><span class='line'>  <span class="c1"># Other todo implementation</span>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">module</span> <span class="nn">EventTracking</span>
</span><span class='line'>    <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">included</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">has_many</span> <span class="ss">:events</span>
</span><span class='line'>      <span class="n">before_create</span> <span class="ss">:track_creation</span>
</span><span class='line'>      <span class="n">after_destroy</span> <span class="ss">:track_deletion</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="kp">private</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">track_creation</span>
</span><span class='line'>        <span class="c1"># ...</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">EventTracking</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>é€šè¿‡<code>concerning</code></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Todo</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="c1"># Other todo implementation</span>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">concerning</span> <span class="ss">:EventTracking</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">included</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">has_many</span> <span class="ss">:events</span>
</span><span class='line'>      <span class="n">before_create</span> <span class="ss">:track_creation</span>
</span><span class='line'>      <span class="n">after_destroy</span> <span class="ss">:track_deletion</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="kp">private</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">track_creation</span>
</span><span class='line'>        <span class="c1"># ...</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Todo</span><span class="o">.</span><span class="n">ancestors</span>
</span><span class='line'><span class="c1"># [Todo,Todo::EventTracking,...]</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ€»å¾—æ¥è¯´ï¼Œ<code>concerning</code>ä¸»è¦ç”¨äºåˆ‡åˆ†æ¯”è¾ƒå°çš„model
å¦å¤–ï¼Œè¿˜æœ‰è¿˜æä¾›äº†ç±»ä¼¼çš„<code>concern</code>ç­‰æ–¹æ³•</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">concern</span> <span class="ss">:EventTracking</span> <span class="k">do</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">is</span> <span class="n">equivalent</span> <span class="n">to</span>
</span><span class='line'>
</span><span class='line'><span class="k">module</span> <span class="nn">EventTracking</span>
</span><span class='line'>  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>æœ€åè´´ä¸Šè‡ªç”¨ <a href="https://gist.github.com/Justin-lu/156bd4a1cba1c507e485">sublime snippet</a>,ä½†æ˜¯æˆ‘æ˜¯Vimå…š.</p>

<p>Reference:
<a href="http://www.railstips.org/blog/archives/2009/05/15/include-vs-extend-in-ruby/">http://www.railstips.org/blog/archives/2009/05/15/include-vs-extend-in-ruby/</a>
<a href="https://github.com/rails/rails/blob/master/activesupport/lib/active_support/concern.rb">https://github.com/rails/rails/blob/master/activesupport/lib/active_support/concern.rb</a>
<a href="https://github.com/rails/rails/blob/master/activesupport/lib/active_support/concern.rb">https://github.com/rails/rails/blob/master/activesupport/lib/active_support/concern.rb</a></p>

<hr />

<p>è¡¥å……ï¼š</p>

<h2>ActiveSupport::Concern#append_features</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">append_features</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">base</span><span class="o">.</span><span class="n">instance_variable_defined?</span><span class="p">(</span><span class="ss">:@_dependencies</span><span class="p">)</span>
</span><span class='line'>    <span class="n">base</span><span class="o">.</span><span class="n">instance_variable_get</span><span class="p">(</span><span class="ss">:@_dependencies</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
</span><span class='line'>    <span class="k">return</span> <span class="kp">false</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="k">return</span> <span class="kp">false</span> <span class="k">if</span> <span class="n">base</span> <span class="o">&lt;</span> <span class="nb">self</span>
</span><span class='line'>    <span class="vi">@_dependencies</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">dep</span><span class="o">|</span> <span class="n">base</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">super</span>
</span><span class='line'>    <span class="n">base</span><span class="o">.</span><span class="n">extend</span> <span class="nb">const_get</span><span class="p">(</span><span class="ss">:ClassMethods</span><span class="p">)</span> <span class="k">if</span> <span class="nb">const_defined?</span><span class="p">(</span><span class="ss">:ClassMethods</span><span class="p">)</span>
</span><span class='line'>    <span class="n">base</span><span class="o">.</span><span class="n">class_eval</span><span class="p">(</span><span class="o">&amp;</span><span class="vi">@_included_block</span><span class="p">)</span> <span class="k">if</span> <span class="n">instance_variable_defined?</span><span class="p">(</span><span class="ss">:@_included_block</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>append_features</code>ä¹Ÿæ˜¯moduleçš„ä¸€ä¸ªcallbackï¼Œä¼šåœ¨includeä¹‹åï¼Œä¸ºå½“å‰classæ·»åŠ moduleçš„å˜é‡ï¼Œå¸¸é‡ï¼Œæ–¹æ³•ç­‰ã€‚append_features ä¼šå…ˆä¸included è¢«è°ƒç”¨ï¼Œè¯¦è§ï¼š<a href="http://apidock.com/ruby/Module/append_features">append_features</a>
ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå¦‚@neverlandxy_naixæ‰€è¯´çš„ä¸€æ ·ï¼Œæ­£æ˜¯é€šè¿‡é€’å½’çš„æ–¹æ³•å¤„ç†å¤šé‡åµŒå¥—</p>

<p>é¦–å…ˆçœ‹åˆ°ä¸€ä¸ª<code>if</code>åˆ¤æ–­,è¿™é‡Œåˆ¤æ–­å½“å‰ç±»(base)æ˜¯å¦å®šä¹‰äº†<code>@_dependencies</code>ï¼Œå¦‚æœè¢«å®šä¹‰ï¼Œåˆ™æŠŠå½“å‰moduleåŠ å…¥<code>@_dependencies</code>ã€‚æ€ä¹ˆè¯´å‘¢ï¼Ÿæˆ‘ä»¬å†æ¥çœ‹çœ‹</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">extended</span><span class="p">(</span><span class="n">base</span><span class="p">)</span> <span class="c1">#:nodoc:</span>
</span><span class='line'>  <span class="n">base</span><span class="o">.</span><span class="n">instance_variable_set</span><span class="p">(</span><span class="ss">:@_dependencies</span><span class="p">,</span> <span class="o">[]</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>extended</code>ç±»ä¼¼äº<code>included</code>,å…·ä½“ç”¨æ³•è§<a href="http://ruby-doc.org/core-2.2.0/Module.html#method-i-extended">extended</a>
çœ‹å®Œ<code>extended</code>çš„ç”¨æ³•ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœå½“å‰ç±»<code>extend</code>äº†<code>ActiveSupport::Concern</code>,åˆ™<code>@_dependencies</code>ä¼šè¢«å®šä¹‰ã€‚</p>

<p>ç¬¬äºŒä¸ªifåˆ¤æ–­ï¼Œåˆ¤æ–­å½“å‰ç±»æ˜¯å¦ç»§æ‰¿äºå½“å‰æ¨¡å—ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¸éœ€è¦åšå…¶ä»–æ“ä½œï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™è¯´æ˜å½“å‰ç±»æ—¢ä¸æ˜¯å½“å‰æ¨¡å—çš„å­ç±»ï¼Œä¹Ÿæ²¡æœ‰<code>extend</code> <code>ActiveSupport::Concern</code>ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ€ç»ˆè¦<code>include</code>å½“å‰æ¨¡å—çš„ç±»ï¼Œæ­¤æ—¶ï¼Œå½“å‰ç±»<code>include</code>å½“å‰æ¨¡å—æ‰€æœ‰ä¾èµ–<code>@_dependencies</code>,å¹¶å®šä¹‰<code>ClassMethods</code>å’Œ<code>included</code>blocké‡Œé¢çš„æ–¹æ³•ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Scopes é¢„åŠ è½½]]></title>
    <link href="http://justin-lu.github.io/blog/2015/07/05/rails-scopes-yu-jia-zai/"/>
    <updated>2015-07-05T21:48:00+08:00</updated>
    <id>http://justin-lu.github.io/blog/2015/07/05/rails-scopes-yu-jia-zai</id>
    <content type="html"><![CDATA[<p>å‰å‡ å¤©åœ¨<a href="http://rubyweekly.com/">rubyweekly</a>é‡Œé¢çœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œæ„Ÿè§‰å†™å¾—ä¸é”™ã€‚æ‹¿å‡ºæ¥åˆ†äº«ä¸€ä¸‹ã€‚<a href="http://www.justinweiss.com/%0Ablog/2015/06/23/how-to-preload-rails-scopes/?utm_source=rubyweekly&amp;utm_medium=email">åŸæ–‡</a>æ›´ç²¾å½©</p>

<!-- More -->


<h1>scope ä¼šé€ æˆN+1æŸ¥è¯¢</h1>

<p>ä½œä¸ºä¸€ä¸ªRailså¼€å‘è€…ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨<a href="http://guides.rubyonrails.org/active_record_querying.html#scopes">scope</a>æ¥åšæŸ¥è¯¢ï¼Œä»¥ç®€åŒ–ä½ çš„ä»£ç ï¼Œå¦‚ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Review</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:restaurant</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:positive</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="s2">&quot;rating &gt; 3.0&quot;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">001</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">reviews</span><span class="o">.</span><span class="n">positive</span><span class="o">.</span><span class="n">count</span>
</span><span class='line'>  <span class="no">Restaurant</span> <span class="no">Load</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">4</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span>  <span class="sb">`restaurants`</span><span class="o">.</span><span class="n">*</span> <span class="no">FROM</span> <span class="sb">`restaurants`</span>  <span class="no">ORDER</span> <span class="no">BY</span> <span class="sb">`restaurants`</span><span class="o">.</span><span class="n">`</span><span class="nb">id</span><span class="sb">` ASC LIMIT 1</span>
</span><span class='line'><span class="sb">   (0.6ms)  SELECT COUNT(*) FROM `</span><span class="n">reviews</span><span class="sb">` WHERE `</span><span class="n">reviews</span><span class="sb">`.`</span><span class="n">restaurant_id</span><span class="sb">` = 1 AND (rating &gt; 3.0)</span>
</span><span class='line'><span class="sb">=&gt; 5</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½†æ˜¯ï¼Œå½“ä½ ä¸€ä¸å°å¿ƒï¼Œè¿™å°†ä¸¥é‡çš„å½±å“ä½ åº”ç”¨çš„æ€§èƒ½ã€‚
ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä½¿ç”¨<code>scope</code>è¿›è¡Œå®šä¹‰çš„æŸ¥è¯¢å¹¶ä¸ä¼šè¢«é¢„åŠ è½½ã€‚
å‡è®¾ä½ è¦æŸ¥è¯¢ä¸€äº›<code>restaurants</code>æ‰€æœ‰<code>positive reviews</code>ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">001</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">restauraunts</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">002</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">restauraunts</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">restaurant</span><span class="o">|</span>
</span><span class='line'><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">003</span><span class="p">:</span><span class="mi">1</span><span class="o">*</span>   <span class="s2">&quot;</span><span class="si">#{</span><span class="n">restaurant</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">restaurant</span><span class="o">.</span><span class="n">reviews</span><span class="o">.</span><span class="n">positive</span><span class="o">.</span><span class="n">length</span><span class="si">}</span><span class="s2"> positive reviews.&quot;</span>
</span><span class='line'><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">004</span><span class="p">:</span><span class="mi">1</span><span class="o">&gt;</span> <span class="k">end</span>
</span><span class='line'>  <span class="no">Review</span> <span class="no">Load</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">6</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="sb">`reviews`</span><span class="o">.</span><span class="n">*</span> <span class="no">FROM</span> <span class="sb">`reviews`</span> <span class="no">WHERE</span> <span class="sb">`reviews`</span><span class="o">.</span><span class="n">`restaurant_id</span><span class="sb">` = 1 AND (rating &gt; 3.0)</span>
</span><span class='line'><span class="sb">  Review Load (0.5ms)  SELECT `</span><span class="n">reviews</span><span class="sb">`.* FROM `</span><span class="n">reviews</span><span class="sb">` WHERE `</span><span class="n">reviews</span><span class="sb">`.`</span><span class="n">restaurant_id</span><span class="sb">` = 2 AND (rating &gt; 3.0)</span>
</span><span class='line'><span class="sb">  Review Load (0.7ms)  SELECT `</span><span class="n">reviews</span><span class="sb">`.* FROM `</span><span class="n">reviews</span><span class="sb">` WHERE `</span><span class="n">reviews</span><span class="sb">`.`</span><span class="n">restaurant_id</span><span class="sb">` = 3 AND (rating &gt; 3.0)</span>
</span><span class='line'><span class="sb">  Review Load (0.7ms)  SELECT `</span><span class="n">reviews</span><span class="sb">`.* FROM `</span><span class="n">reviews</span><span class="sb">` WHERE `</span><span class="n">reviews</span><span class="sb">`.`</span><span class="n">restaurant_id</span><span class="sb">` = 4 AND (rating &gt; 3.0)</span>
</span><span class='line'><span class="sb">  Review Load (0.7ms)  SELECT `</span><span class="n">reviews</span><span class="sb">`.* FROM `</span><span class="n">reviews</span><span class="sb">` WHERE `</span><span class="n">reviews</span><span class="sb">`.`</span><span class="n">restaurant_id</span><span class="sb">` = 5 AND (rating &gt; 3.0)</span>
</span><span class='line'><span class="sb">=&gt; [&quot;Judd&#39;s Pub: 5 positive reviews.&quot;, &quot;Felix&#39;s Nightclub: 6 positive reviews.&quot;, &quot;Mabel&#39;s Burrito Shack: 7 positive reviews.&quot;, &quot;Kendall&#39;s Burrito Shack: 2 positive reviews.&quot;, &quot;Elisabeth&#39;s Deli: 15 positive reviews.&quot;]</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>scope:positive</code>å¹¶æ²¡æœ‰è¢«ç¼“å­˜èµ·æ¥ï¼Œè¿™æ˜æ˜¾çš„æ˜¯ä¸€ä¸ª<code>N+1</code>æŸ¥è¯¢ã€‚</p>

<h1>ç”¨associationsä»£æ›¿scopes</h1>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ç”¨associationsä»£æ›¿scopesï¼Œæ¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚è¯·çœ‹ä¸‹é¢ä¾‹å­ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Restaurant</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:reviews</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>å½“æˆ‘ä»¬æŸ¥çœ‹è¿™ä¸ª<a href="http://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html">æ–‡æ¡£</a>æ—¶,æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>has_many</code>å…è®¸æˆ‘ä»¬æ·»åŠ è‡ªå®šä¹‰æŸ¥è¯¢</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Restaurant</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:reviews</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:positive_reviews</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="s2">&quot;rating &gt; 3.0&quot;</span><span class="p">)</span> <span class="p">},</span> <span class="ss">class_name</span><span class="p">:</span> <span class="s2">&quot;Review&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½†æˆ‘ä»¬å¯ä»¥è¿™æ ·å­è·å–ä¸€ä¸ª<code>restaurant</code>çš„æ‰€æœ‰<code>positive_reviews</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">001</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">positive_reviews</span><span class="o">.</span><span class="n">count</span>
</span><span class='line'>  <span class="no">Restaurant</span> <span class="no">Load</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">2</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span>  <span class="sb">`restaurants`</span><span class="o">.</span><span class="n">*</span> <span class="no">FROM</span> <span class="sb">`restaurants`</span>  <span class="no">ORDER</span> <span class="no">BY</span> <span class="sb">`restaurants`</span><span class="o">.</span><span class="n">`</span><span class="nb">id</span><span class="sb">` ASC LIMIT 1</span>
</span><span class='line'><span class="sb">   (0.4ms)  SELECT COUNT(*) FROM `</span><span class="n">reviews</span><span class="sb">` WHERE `</span><span class="n">reviews</span><span class="sb">`.`</span><span class="n">restaurant_id</span><span class="sb">` = 1 AND (rating &gt; 3.0)</span>
</span><span class='line'><span class="sb">=&gt; 5</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>include</code>æ¥é¢„åŠ è½½è¿™ä¸ªå…³è”å…³ç³»äº†</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">001</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">restauraunts</span> <span class="o">=</span> <span class="no">Restaurant</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="ss">:positive_reviews</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'>  <span class="no">Restaurant</span> <span class="no">Load</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">3</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span>  <span class="sb">`restaurants`</span><span class="o">.</span><span class="n">*</span> <span class="no">FROM</span> <span class="sb">`restaurants`</span>  <span class="no">ORDER</span> <span class="no">BY</span> <span class="sb">`restaurants`</span><span class="o">.</span><span class="n">`</span><span class="nb">id</span><span class="sb">` ASC LIMIT 5</span>
</span><span class='line'><span class="sb">  Review Load (1.2ms)  SELECT `</span><span class="n">reviews</span><span class="sb">`.* FROM `</span><span class="n">reviews</span><span class="sb">` WHERE (rating &gt; 3.0) AND `</span><span class="n">reviews</span><span class="sb">`.`</span><span class="n">restaurant_id</span><span class="sb">` IN (1, 2, 3, 4, 5)</span>
</span><span class='line'><span class="sb">irb(main):002:0&gt; restauraunts.map do |restaurant|</span>
</span><span class='line'><span class="sb">irb(main):003:1*   &quot;</span><span class="si">#{</span><span class="n">restaurant</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="sb">: </span><span class="si">#{</span><span class="n">restaurant</span><span class="o">.</span><span class="n">positive_reviews</span><span class="o">.</span><span class="n">length</span><span class="si">}</span><span class="sb"> positive reviews.&quot;</span>
</span><span class='line'><span class="sb">irb(main):004:1&gt; end</span>
</span><span class='line'><span class="sb">=&gt; [&quot;Judd&#39;s Pub: 5 positive reviews.&quot;, &quot;Felix&#39;s Nightclub: 6 positive reviews.&quot;, &quot;Mabel&#39;s Burrito Shack: 7 positive reviews.&quot;, &quot;Kendall&#39;s Burrito Shack: 2 positive reviews.&quot;, &quot;Elisabeth&#39;s Deli: 15 positive reviews.&quot;]</span>
</span></code></pre></td></tr></table></div></figure>


<p>è‡³æ­¤ï¼Œ6ä¸ªSqlæŸ¥è¯¢å˜æˆ2ä¸ª</p>

<h1>æ¶ˆé™¤é‡å¤</h1>

<p>ç°åœ¨æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>scope:positive</code>å’Œä¸€ä¸ªå…³ç³»<code>has_many :positive_reviews</code>ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ƒä»¬æ˜¯é‡å¤çš„ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•çš„æ¶ˆé™¤è¿™ä¸ªDRY.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Review</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:restaurant</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:positive</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="s2">&quot;rating &gt; 3.0&quot;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Restaurant</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:reviews</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:positive_reviews</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">positive</span> <span class="p">},</span> <span class="ss">class_name</span><span class="p">:</span> <span class="s2">&quot;Review&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“<code>scope</code>è™½ç„¶å¥½ç”¨ï¼Œä½†æ˜¯å½“ä½ å‘ç°çš„ä»£ç å‡ºç°ä»¥ä¸Šé—®é¢˜æ—¶ï¼Œç®€å•çš„ä¿®æ”¹ï¼Œèƒ½å‡å°‘è®¸å¤š<code>sql</code>æŸ¥è¯¢</p>

<p>æ–‡ç« æ²¡æœ‰é€å­—ç¿»è¯‘ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œéº»çƒ¦æŒ‡å‡ºã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Oauth2.0]]></title>
    <link href="http://justin-lu.github.io/blog/2014/05/30/oauth2-dot-0-shi-yong-ji-qiao/"/>
    <updated>2014-05-30T15:13:00+08:00</updated>
    <id>http://justin-lu.github.io/blog/2014/05/30/oauth2-dot-0-shi-yong-ji-qiao</id>
    <content type="html"><![CDATA[<p>Oauth2.0 éªŒè¯æµç¨‹ç®€å•ä»‹ç»(ä½¿ç”¨doorkeeper)</p>

<!-- More -->


<h1>Oauth 2.0</h1>

<ol>
<li><p>client è·å– provider æä¾›çš„èµ„æº</p></li>
<li><p>æµç¨‹:</p></li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+----------+
</span><span class='line'>| Resource |
</span><span class='line'>|   Owner  |
</span><span class='line'>|          |
</span><span class='line'>+----------+
</span><span class='line'>     ^
</span><span class='line'>     |
</span><span class='line'>    (B)
</span><span class='line'>+----|-----+          Client Identifier      +---------------+
</span><span class='line'>|         -+----(A)-- & Redirection URI ----&gt;|               |
</span><span class='line'>|  User-   |                                 | Authorization |
</span><span class='line'>|  Agent  -+----(B)-- User authenticates ---&gt;|     Server    |
</span><span class='line'>|          |                                 |               |
</span><span class='line'>|         -+----(C)-- Authorization Code ---&lt;|               |
</span><span class='line'>+-|----|---+                                 +---------------+
</span><span class='line'>  |    |                                         ^      v
</span><span class='line'> (A)  (C)                                        |      |
</span><span class='line'>  |    |                                         |      |
</span><span class='line'>  ^    v                                         |      |
</span><span class='line'>+---------+                                      |      |
</span><span class='line'>|         |&gt;---(D)-- Authorization Code ---------'      |
</span><span class='line'>|  Client |          & Redirection URI                  |
</span><span class='line'>|         |                                             |
</span><span class='line'>|         |&lt;---(E)----- Access Token -------------------'
</span><span class='line'>+---------+       ( Optional Refresh Token)</span></code></pre></td></tr></table></div></figure>


<p>Aï¼‰ç”¨æˆ·è®¿é—®å®¢æˆ·ç«¯ï¼Œåè€…å°†å‰è€…å¯¼å‘è®¤è¯æœåŠ¡å™¨ã€‚
Bï¼‰ç”¨æˆ·é€‰æ‹©æ˜¯å¦ç»™äºˆå®¢æˆ·ç«¯æˆæƒã€‚
Cï¼‰å‡è®¾ç”¨æˆ·ç»™äºˆæˆæƒï¼Œè®¤è¯æœåŠ¡å™¨å°†ç”¨æˆ·å¯¼å‘å®¢æˆ·ç«¯äº‹å…ˆæŒ‡å®šçš„"é‡å®šå‘URI"ï¼ˆredirection URIï¼‰ï¼ŒåŒæ—¶é™„ä¸Šä¸€ä¸ªæˆæƒç ã€‚
Dï¼‰å®¢æˆ·ç«¯æ”¶åˆ°æˆæƒç ï¼Œé™„ä¸Šæ—©å…ˆçš„"é‡å®šå‘URI"ï¼Œå‘è®¤è¯æœåŠ¡å™¨ç”³è¯·ä»¤ç‰Œã€‚è¿™ä¸€æ­¥æ˜¯åœ¨å®¢æˆ·ç«¯çš„åå°çš„æœåŠ¡å™¨ä¸Šå®Œæˆçš„ï¼Œå¯¹ç”¨æˆ·ä¸å¯è§ã€‚
Eï¼‰è®¤è¯æœåŠ¡å™¨æ ¸å¯¹äº†æˆæƒç å’Œé‡å®šå‘URIï¼Œç¡®è®¤æ— è¯¯åï¼Œå‘å®¢æˆ·ç«¯å‘é€è®¿é—®ä»¤ç‰Œï¼ˆaccess tokenï¼‰å’Œæ›´æ–°ä»¤ç‰Œï¼ˆrefresh tokenï¼‰ã€‚</p>

<ol>
<li>Resource Owner -> devise</li>
<li>API -> Grape</li>
<li>Provider -> doorkeeper</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">doorkeeper_for</span> <span class="ss">:all</span>                 <span class="c1"># Require access token for all actions</span>
</span><span class='line'>  <span class="n">doorkeeper_for</span> <span class="ss">:all</span><span class="p">,</span> <span class="ss">except</span><span class="p">:</span> <span class="ss">:index</span> <span class="c1"># All actions except index</span>
</span><span class='line'>  <span class="n">doorkeeper_for</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span>        <span class="c1"># Only for index and show action</span>
</span><span class='line'>  <span class="n">doorkeeper_for</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:scopes</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:write</span><span class="o">]</span> <span class="c1">#Only for create action and writable</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>client</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">OmniAuth</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">Strategies</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Doorkeeper</span> <span class="o">&lt;</span> <span class="no">OmniAuth</span><span class="o">::</span><span class="no">Strategies</span><span class="o">::</span><span class="no">OAuth2</span>
</span><span class='line'>      <span class="n">option</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:doorkeeper</span>
</span><span class='line'>      <span class="n">option</span> <span class="ss">:client_options</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="ss">:site</span> <span class="o">=&gt;</span> <span class="s2">&quot;http://localhost:8090/&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="ss">:authorize_path</span> <span class="o">=&gt;</span> <span class="s2">&quot;/oauth/authorize&quot;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">uid</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">raw_info</span><span class="o">[</span><span class="s2">&quot;id&quot;</span><span class="o">]</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="n">info</span> <span class="k">do</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>          <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="n">raw_info</span><span class="o">[</span><span class="s2">&quot;email&quot;</span><span class="o">]</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">raw_info</span>
</span><span class='line'>        <span class="vi">@raw_info</span> <span class="o">||=</span> <span class="n">access_token</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/api/v1/me.json&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">parsed</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç”Ÿæˆclientå’Œaccess_token</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="c1"># get or create an client with OAuth2</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">doorkeeper_oauth_client</span>
</span><span class='line'>    <span class="vi">@client</span> <span class="o">||=</span> <span class="no">OAuth2</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">DOORKEEPER_APP_ID</span><span class="p">,</span> <span class="no">DOORKEEPER_APP_SECRET</span><span class="p">,</span> <span class="ss">:site</span> <span class="o">=&gt;</span> <span class="no">DOORKEEPER_APP_URL</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># get or create an AccessToken</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">doorkeeper_access_token</span>
</span><span class='line'>    <span class="vi">@token</span> <span class="o">||=</span> <span class="no">OAuth2</span><span class="o">::</span><span class="no">AccessToken</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">doorkeeper_oauth_client</span><span class="p">,</span> <span class="n">current_user</span><span class="o">.</span><span class="n">doorkeeper_access_token</span><span class="p">)</span> <span class="k">if</span> <span class="n">current_user</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>é€šè¿‡<code>access_token</code>æ¥è·å–apiæ•°æ®</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>    <span class="vi">@order</span> <span class="o">=</span> <span class="n">doorkeeper_access_token</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/v1/orders&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">parsed</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è®©zshä¸ºä½ çš„Terminalå¸¦æ¥ä¸ä¸€æ ·çš„æ„Ÿè§‰]]></title>
    <link href="http://justin-lu.github.io/blog/2013/10/27/rang-zshwei-ni-de-terminaldai-lai-bu-%5B%3F%5D-yang-de-gan-jue/"/>
    <updated>2013-10-27T15:28:00+08:00</updated>
    <id>http://justin-lu.github.io/blog/2013/10/27/rang-zshwei-ni-de-terminaldai-lai-bu-[?]-yang-de-gan-jue</id>
    <content type="html"><![CDATA[<p>åˆšæ¥è§¦Mac,å‘ç°æœ‰zshè¿™ä¸€ç¥å™¨</p>

<!-- More -->


<blockquote><p>ä½¿ç”¨Gitå¹¶ä¸”åœ¨å¤šä¸ªåˆ†æ”¯ä¸‹å¼€å‘çš„åŒå­¦å¯èƒ½çŸ¥é“ï¼Œå½“æˆ‘ä»¬è€æ˜¯åœ¨ä¸åŒåˆ†æ”¯ä¸‹åˆ‡æ¢çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™ä¼šå¿˜è®°è‡ªå·±åœ¨å“ªä¸ªåˆ†æ”¯ï¼Œå¯¼è‡´æˆ‘ä»¬æäº¤çš„å†…å®¹æ··ä¹±ï¼Œä»¥å‰åœ¨Ubuntuä¸‹ï¼Œæ˜¯ç›´æ¥ä¿®æ”¹<code>.bashrc</code>ï¼Œè®©å…¶æ˜¾ç¤ºåˆ†æ”¯åç§°
æœ¬æ‰“ç®—ç”¨åŒæ ·çš„æ–¹æ³•ä¿®æ”¹OS Xç³»ç»Ÿï¼Œè®©å…¶æ˜¾ç¤ºåˆ†æ”¯åï¼Œå´è®©æˆ‘å‘ç°äº†Zsh</p></blockquote>

<hr />

<h2>ä½¿ç”¨<code>oh-my-zsh</code></h2>

<h3>ä½¿ç”¨<code>oh-my-zsh</code>çš„ä¼˜ç‚¹</h3>

<ul>
<li>å„ç§è¡¥å…¨

<ul>
<li>ç›®å½•è¡¥å…¨å¯ä»¥åªè¾“å…¥ç›®å½•çš„ä¸­é—´éƒ¨åˆ†è¿›è¡Œè¡¥å…¨</li>
<li>å‘½ä»¤å¯ä»¥è¡¥å…¨å‚æ•°,å¹¶ä¸”å¯ä»¥æ˜¾ç¤ºå‚æ•°å¯¹åº”çš„è¯´æ˜</li>
</ul>
</li>
<li>å„ç§ä¸»é¢˜</li>
<li>ç›®å½•åˆ‡æ¢:

<ul>
<li>d : æ˜¾ç¤ºæœ€è¿‘ä½¿ç”¨è¿‡çš„å‡ ä¸ªç›®å½•,æŒ‰1-9å¯ä»¥ç›´æ¥åˆ‡æ¢è¿‡å»</li>
<li>1-9 : åˆ‡æ¢è‡³æœ€è¿‘ä½¿ç”¨è¿‡çš„å‰nä¸ªç›®å½•</li>
<li>.. ç­‰äº cd ..</li>
<li>â€¦ ç­‰äº cd ../..</li>
<li>mcd xxx ç­‰äº mkdir xxx &amp; cd xxx</li>
<li>ä½¿ç”¨~xxxå¿«æ·ç›®å½•æ¥é€šè¿‡ cd ~xxx ç”šè‡³æ˜¯ ~xxx å¿«é€Ÿè¿›å…¥å¯¹åº”çš„ç›®å½•</li>
</ul>
</li>
<li>å„ç§æ’ä»¶:

<ul>
<li>extract ç›´æ¥extract filename ,æ”¯æŒå„ç§tar.gz, bz2, 7zç­‰å„ç§å‹ç¼©æ ¼å¼</li>
<li>terminalapp è®©OS X Lionä¸‹çš„Terminal å¯åŠ¨æ—¶æ‰“å¼€ä¸Šæ¬¡çš„ç›®å½•</li>
</ul>
</li>
<li>osx

<ul>
<li>pfd æ‰“å°finderçš„å½“å‰è·¯å¾„</li>
<li>cdf cdåˆ°finderçš„å½“å‰è·¯å¾„</li>
<li>pushdf pushd åˆ°finderçš„å½“å‰è·¯å¾„</li>
</ul>
</li>
</ul>


<h3>å®‰è£…<code>oh-my-zsh</code></h3>

<h4>è‡ªåŠ¨å®‰è£…ï¼š</h4>

<blockquote><p>å½“ç„¶ï¼Œå¦‚æœä½ ä¿¡ä»»è¿™ä¸ªå¼€æºé¡¹ç›®ä½œè€…çš„è¯ä½ å¯ä»¥å°è¯•ä½¿ç”¨è‡ªåŠ¨å®‰è£…çš„æ–¹æ³•ã€‚</p></blockquote>

<p><code>wget https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh -O - | sh</code></p>

<h4>æ‰‹åŠ¨å®‰è£…ï¼š</h4>

<ul>
<li>å…‹éš†è¿™ä¸ªé¡¹ç›®åˆ°æœ¬åœ°(å‰ææ˜¯ä½ å¾—æœ‰è£…git)</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">git</span> <span class="nb">clone</span> <span class="ss">git</span><span class="p">:</span><span class="sr">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">robbyrussell</span><span class="o">/</span><span class="n">oh</span><span class="o">-</span><span class="n">my</span><span class="o">-</span><span class="n">zsh</span><span class="o">.</span><span class="n">git</span> <span class="o">~</span><span class="sr">/.oh-my-zsh</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>åˆ›å»ºä¸€ä¸ªzshçš„é…ç½®æ–‡ä»¶
æ³¨æ„:å¦‚æœä½ å·²ç»æœ‰ä¸€ä¸ª~/.zshrcæ–‡ä»¶çš„è¯ï¼Œå»ºè®®ä½ å…ˆåšå¤‡ä»½ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">cp</span> <span class="o">~</span><span class="sr">/.zshrc ~/</span><span class="o">.</span><span class="n">zshrc</span><span class="o">.</span><span class="n">orig</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç„¶åå¼€å§‹åˆ›å»ºzshçš„é…ç½®æ–‡ä»¶</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">cp</span> <span class="o">~</span><span class="sr">/.oh-my-zsh/</span><span class="n">templates</span><span class="o">/</span><span class="n">zshrc</span><span class="o">.</span><span class="n">zsh</span><span class="o">-</span><span class="n">template</span> <span class="o">~</span><span class="sr">/.zshrc</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>è®¾ç½®zshä¸ºä½ çš„é»˜è®¤çš„shell</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">chsh</span> <span class="o">-</span><span class="n">s</span> <span class="sr">/bin/</span><span class="n">zsh</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>å› ä¸ºzshå’Œbashæ˜¯å…¼å®¹çš„ï¼Œæ‰€ä»¥ï¼Œä½ å¯ä»¥æŠŠä½ <code>.bashrc</code>æˆ–è€…<code>.bashrc_profile</code>é‡Œé¢çš„å†…å®¹ç›´æ¥é»è´´åˆ°<code>.zshrc</code>é‡Œé¢</p></blockquote>

<ul>
<li><a href="https://github.com/robbyrussell/oh-my-zsh">githubç½‘å€</a></li>
<li><a href="https://github.com/robbyrussell/oh-my-zsh/wiki/themes">å„ç§ä¸»é¢˜</a></li>
</ul>


<h4>å¯èƒ½é‡åˆ°çš„é—®é¢˜</h4>

<blockquote><p>ä¹ æƒ¯äº†<code>UTF-8</code>ç¼–ç çš„åŒå­¦ï¼Œå¯èƒ½éœ€è¦åœ¨<code>.zshrc</code>é‡Œé¢æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">export</span> <span class="no">LANG</span><span class="o">=</span><span class="n">en_US</span><span class="o">.</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span> <span class="n">export</span> <span class="no">LC_ALL</span><span class="o">=</span><span class="n">en_US</span><span class="o">.</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä»Vimåˆ°Sublime Text]]></title>
    <link href="http://justin-lu.github.io/blog/2013/10/26/cong-vimdao-sublime-text/"/>
    <updated>2013-10-26T19:32:00+08:00</updated>
    <id>http://justin-lu.github.io/blog/2013/10/26/cong-vimdao-sublime-text</id>
    <content type="html"><![CDATA[<p>è®²è¿°æˆ‘ä»vimè½¬åŒ–åˆ°sublime textçš„è¿‡ç¨‹</p>

<!-- More -->


<h3>ä¸ºä»€ä¹ˆé€‰æ‹©Sublime Text</h3>

<blockquote><p>ä½¿ç”¨Gvimå·²ç»ä¸‰å¹´äº†ï¼Œä¸€ç›´å¾ˆå–œæ¬¢Vimé‡Œé¢çš„hjklç­‰å¿«æ·é”®å’Œå¤šç§æ¨¡å¼ï¼Œä»¥è‡´äºåœ¨Chromeä¸Šå®‰è£…Vimiumæ’ä»¶ï¼Œè®©æˆ‘èƒ½å¤Ÿæ°¸è¿œçš„è„±ç¦»é¼ æ ‡ï¼Œå¾ˆå–œæ¬¢è¿™ç§æ„Ÿè§‰ã€‚
ä½†æ˜¯ï¼Œæœ€è¿‘ï¼Œç”±äºå·¥ä½œéœ€è¦ï¼Œåœ¨Macä¸Šè¿›è¡Œå¼€å‘ï¼Œäºæ˜¯è£…ä¸Šäº†MacVimï¼Œä½†æ˜¯ï¼Œä»¥å‰ä¸€ç›´ç”¨çš„å¥½å¥½åœ°Vimå‡ºç°bugäº†ï¼Œæ— æ³•ç›´æ¥åŒå‡»æ‰“å¼€æ–‡ä»¶ï¼ˆåæ¥å‘ä¸‹åœ¨ç»ˆç«¯ä¸‹æ‰“å¼€gvimå°±å¯ä»¥ï¼‰åŠ ä¸Šä¹‹å‰ä¸€ç›´å¬å¸ˆå…„è¯´Sublime Textå¾ˆå¥½ç”¨ï¼Œæ‰€ä»¥ï¼Œæˆ‘è¯•ç€Googleäº›èµ„æ–™ï¼Œç„¶åå¼€å§‹å„ç§å°è¯•&hellip;</p></blockquote>

<h3>Sublime Text ä¸‹å¼€å¯Vimæ¨¡å¼</h3>

<blockquote><p>å¯¹äºä¸€ä¸ªä¹ æƒ¯äº†Vimæ“ä½œæ–¹å¼çš„ç¨‹åºå‘˜ï¼Œè¿™æ— ç–‘æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ¶ˆæ¯ï¼Œä¸€ä¸‹æ˜¯é…ç½®æ–¹å¼</p></blockquote>

<ul>
<li>æŒ‰ä¸‹<code>Shift + Command + P</code>,è°ƒå‡ºå‘½ä»¤é¢æ¿</li>
<li>è¾“å…¥<code>setting user</code>,æ‰“å¼€ç”¨æˆ·é…ç½®æ–‡ä»¶</li>
<li>å¦‚æœä¹‹å‰å¯¹é…ç½®è¿‡ï¼Œæ­¤æ—¶åº”è¯¥æ˜¯ä¸€ä¸ªç©ºæ–‡ä»¶ï¼ŒæŠŠä¸€ä¸‹ä»£ç è´´å…¥</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;ignored_packages&quot;</span><span class="o">:</span> <span class="p">[]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>ä¿å­˜è¿™ä¸ªæ–‡ä»¶ï¼ŒæŒ‰ä¸‹ESCé”®ï¼Œè¿™æ—¶å€™ï¼Œä½ ç†Ÿæ‚‰çš„Vimå‘½ä»¤å°±å›æ¥å•¦&hellip;</li>
</ul>


<h3>æœ€æ–°ç‰ˆSublime Text 3 ,ç‚¹å‡»<a href="http://www.sublimetext.com/3">è¿™é‡Œ</a>ä¸‹è½½</h3>

<h3>Sublime Text å¸¸ç”¨å¿«æ·é”®</h3>

<h4>æ‰“å¼€/å‰å¾€</h4>

<ul>
<li>âŒ˜T   å‰å¾€æ–‡ä»¶(å’ŒâŒ˜Pä¸€æ ·ï¼‰</li>
<li>âŒ˜âŒƒP  å‰å¾€é¡¹ç›®</li>
<li>âŒ˜R   å‰å¾€ method(markdownä¸‹ï¼Œè·³è½¬è‡³æ ‡é¢˜)</li>
<li>âŒ˜â‡§P  å‘½ä»¤æç¤º</li>
<li>âŒƒG   å‰å¾€è¡Œ</li>
<li>âŒ˜KB  å¼€å…³ä¾§æ </li>
<li>âŒƒ `  python æ§åˆ¶å°</li>
<li>âŒ˜â‡§N  æ–°å»ºçª—å£</li>
</ul>


<h4>ç¼–è¾‘(ä¼šç”¨Vimçš„åŒå­¦ï¼Œå¯ä»¥å¼€å¯Vimæ¨¡å¼ï¼Œå’Œä»¥å‰ä¸€æ ·)</h4>

<ul>
<li>âŒ˜L   é€‰æ‹©è¡Œ (é‡å¤æŒ‰ä¸‹å°†ä¸‹ä¸€è¡ŒåŠ å…¥é€‰æ‹©)</li>
<li>âŒ˜D   é€‰æ‹©è¯ (é‡å¤æŒ‰ä¸‹æ—¶å¤šé‡é€‰æ‹©ç›¸åŒçš„è¯è¿›è¡Œå¤šé‡ç¼–è¾‘)</li>
<li>âŒƒâ‡§M  é€‰æ‹©æ‹¬å·å†…çš„å†…å®¹</li>
<li>âŒ˜â‡§â†©  åœ¨å½“å‰è¡Œå‰æ’å…¥æ–°è¡Œ</li>
<li>âŒ˜â†©   åœ¨å½“å‰è¡Œåæ’å…¥æ–°è¡Œ</li>
<li>âŒƒâ‡§K  åˆ é™¤è¡Œ</li>
<li>âŒ˜KK  ä»å…‰æ ‡å¤„åˆ é™¤è‡³è¡Œå°¾</li>
<li>âŒ˜KâŒ«  ä»å…‰æ ‡å¤„åˆ é™¤è‡³è¡Œé¦–</li>
<li>âŒ˜â‡§D  å¤åˆ¶(å¤š)è¡Œ</li>
<li>âŒ˜J   åˆå¹¶(å¤š)è¡Œ</li>
<li>âŒ˜KU  æ”¹ä¸ºå¤§å†™</li>
<li>âŒ˜KL  æ”¹ä¸ºå°å†™</li>
<li>âŒ˜ /  æ³¨é‡Š</li>
<li>âŒ˜âŒ¥ /   å—æ³¨é‡Š</li>
<li>âŒ˜Y   æ¢å¤æˆ–é‡å¤</li>
<li>âŒ˜â‡§V  ç²˜è´´å¹¶è‡ªåŠ¨ç¼©è¿›</li>
<li>âŒƒ space  è‡ªåŠ¨å®Œæˆ(é‡å¤æŒ‰ä¸‹é€‰æ‹©ä¸‹ä¸€ä¸ªæç¤º)</li>
<li>âŒƒM   è·³è½¬è‡³å¯¹åº”çš„æ‹¬å·</li>
<li>âŒ˜U   è½¯æ’¤é”€ï¼ˆå¯æ’¤é”€å…‰æ ‡ç§»åŠ¨ï¼‰</li>
<li>âŒ˜â‡§U  è½¯é‡åšï¼ˆå¯é‡åšå…‰æ ‡ç§»åŠ¨ï¼‰</li>
</ul>


<h4>XML/HTML</h4>

<ul>
<li>âŒ˜â‡§A  é€‰æ‹©æ ‡ç­¾å†…çš„å†…å®¹</li>
<li>âŒ˜âŒ¥ .   é—­åˆå½“å‰æ ‡ç­¾</li>
</ul>


<h4>æŸ¥æ‰¾/æ›¿æ¢</h4>

<ul>
<li>âŒ˜F   æŸ¥æ‰¾</li>
<li>âŒ˜âŒ¥F  æ›¿æ¢</li>
<li>âŒ˜âŒ¥G  æŸ¥æ‰¾ä¸‹ä¸€ä¸ªç¬¦åˆå½“å‰æ‰€é€‰çš„å†…å®¹</li>
<li>âŒ˜âŒƒG  æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆå½“å‰æ‰€é€‰çš„å†…å®¹è¿›è¡Œå¤šé‡ç¼–è¾‘</li>
<li>âŒ˜â‡§F  åœ¨æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶ä¸­è¿›è¡ŒæŸ¥æ‰¾</li>
</ul>


<h4>æ‹†åˆ†çª—å£/æ ‡ç­¾é¡µ</h4>

<ul>
<li>âŒ˜âŒ¥1  å•åˆ—</li>
<li>âŒ˜âŒ¥2  åŒåˆ—</li>
<li>âŒ˜âŒ¥5  ç½‘æ ¼ (4ç»„)</li>
<li>âŒƒ[1,2,3,4]   ç„¦ç‚¹ç§»åŠ¨è‡³ç›¸åº”ç»„</li>
<li>âŒƒâ‡§[1,2,3,4]  å°†å½“å‰æ–‡ä»¶ç§»åŠ¨è‡³ç›¸åº”ç»„</li>
<li>âŒ˜[1,2,3â€¦]  é€‰æ‹©ç›¸åº”æ ‡ç­¾é¡µ</li>
</ul>


<h4>ä¹¦ç­¾</h4>

<ul>
<li>âŒ˜F2  æ·»åŠ /å»é™¤ä¹¦ç­¾</li>
<li>F2   ä¸‹ä¸€ä¸ªä¹¦ç­¾</li>
<li>â‡§F2  å‰ä¸€ä¸ªä¹¦ç­¾</li>
<li>âŒ˜â‡§F2   æ¸…é™¤ä¹¦ç­¾</li>
</ul>


<h4>æ ‡è®°</h4>

<ul>
<li>âŒ˜K space   è®¾ç½®æ ‡è®°</li>
<li>âŒ˜KW  ä»å…‰æ ‡ä½ç½®åˆ é™¤è‡³æ ‡è®°</li>
<li>âŒ˜KA  ä»å…‰æ ‡ä½ç½®é€‰æ‹©è‡³æ ‡è®°</li>
<li>âŒ˜KG  æ¸…é™¤æ ‡è®°</li>
</ul>


<hr />

<blockquote><blockquote><p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡æŒ‰ä½<code>command+shift+p</code>,è¾“å…¥<code>keybinding user</code>ï¼Œå¾€é‡Œé¢æ·»åŠ è‡ªå®šä¹‰å¿«æ·é”®ã€‚ä¾‹å¦‚ï¼š</p></blockquote></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span>
</span><span class='line'>    <span class="p">{</span> <span class="s2">&quot;keys&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;ctrl+alt+p&quot;</span><span class="p">],</span> <span class="s2">&quot;command&quot;</span><span class="o">:</span> <span class="s2">&quot;markdown_preview&quot;</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;target&quot;</span><span class="o">:</span> <span class="s2">&quot;browser&quot;</span><span class="p">}</span> <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>å®‰è£…åŒ…æ§åˆ¶(Package Control)</h3>

<blockquote><p>æˆ‘ä¹ˆå¯ä»¥é€šè¿‡Sublime Package Controlæ¥è¿›è¡Œæ’ä»¶çš„å®‰è£…ï¼Œå¸è½½ï¼Œå‡çº§
å®‰è£…æ–¹æ³•å¦‚ä¸‹ï¼š</p>

<blockquote><ol>
<li>æ‰“å¼€Sublime Text ï¼ŒæŒ‰ä½ ctrl + `ï¼Œæ‰“å¼€Consoleï¼Œé€šå¸¸è¿™ä¸ªå¿«æ·åŠ å¯èƒ½ä¼šå†²çªï¼Œéœ€è¦é‡æ–°ä¿®æ”¹</li>
<li>å°†ä»¥ä¸‹ä»£ç ç²˜è´´è‡³æ§åˆ¶å°</li>
</ol>
</blockquote></blockquote>

<p>  import urllib.request,os; pf = &lsquo;Package Control.sublime-package&rsquo;; ipp = sublime.installed_packages_path(); urllib.request.install_opener( urllib.request.build_opener( urllib.request.ProxyHandler()) ); open(os.path.join(ipp, pf), &lsquo;wb&rsquo;).write(urllib.request.urlopen( &lsquo;<a href="http://sublime.wbond.net/">http://sublime.wbond.net/</a>&rsquo; + pf.replace(&lsquo; &rsquo;,&lsquo;%20&rsquo;)).read())</p>

<blockquote><blockquote><ol>
<li>é‡å¯Sbulime,å¦‚æœåœ¨Preferences -> Package Settingsä¸­è§åˆ°Package Controlè¿™ä¸€é¡¹ï¼Œå°±è¯´æ˜å®‰è£…æˆåŠŸäº†ã€‚

<h3>Sublime Text å¸¸ç”¨æ’ä»¶</h3>

<h4>MarkdownEditing</h4>

<p>å¦‚æœå®‰è£…äº† Package Controlï¼Œå¯ä»¥é€šè¿‡æ·»åŠ  repositoryï¼Œè¾“å…¥<code>http://github.com/ttscoff/MarkdownEditing</code> ç„¶ååœ¨ Install Package é‡Œæ‰¾åˆ° MarkdownEditingã€‚
å½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨ Clone è¿™ä¸ª repo åˆ° ~/Library/Application Support/Sublime Text 3/Packagesã€‚</p></li>
</ol>
</blockquote>

<p>MarkdownEditing ä»è§†è§‰å’Œä¾¿æ·æ€§ä¸Šé’ˆå¯¹ Markdown æ–‡æ¡£çš„ç¼–è¾‘è¿›è¡Œäº†ä¸€ç³»åˆ—çš„ä¼˜åŒ–</p></blockquote>

<pre><code>*  å®‰è£…åé’ˆå¯¹ md\mdown\mmd\txt æ ¼å¼æ–‡ä»¶å¯ç”¨æ’ä»¶ã€‚é¢œè‰²æ–¹æ¡ˆä»¿ Byword åŠ iA writerã€‚
*  è‡ªåŠ¨åŒ¹é…æ˜Ÿå·ï¼ˆ*ï¼‰ã€ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰åŠåå¼•å·ï¼ˆ`ï¼‰ï¼Œé€‰ä¸­æ–‡æœ¬æŒ‰ä¸‹ä»¥ä¸Šç¬¦å·èƒ½è‡ªåŠ¨åœ¨æ‰€é€‰æ–‡æœ¬å‰åæ·»åŠ é…å¯¹çš„ç¬¦å·ï¼Œæ–¹ä¾¿ç²—ä½“ã€æ–œä½“å’Œä»£ç æ¡†çš„è¾“å…¥ã€‚
*  ç›´æ¥è¾“å…¥é…å¯¹çš„ç¬¦å·åæŒ‰ä¸‹é€€æ ¼é”®ï¼ˆbackspaceï¼‰ï¼Œåˆ™ä¸¤ä¸ªç¬¦å·éƒ½ä¼šè¢«åˆ é™¤ï¼›ç›´æ¥è¾“å…¥é…å¯¹çš„ç¬¦å·åæŒ‰ä¸‹ç©ºæ ¼é”®ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ é™¤åä¸€ä¸ªã€‚
*  å¯¹â€œé€‰ä¸­æ–‡å­—åè¾“å…¥å·¦æ‹¬å·â€è¿™ä¸€åŠ¨ä½œè¿›è¡Œäº†è°ƒæ•´ï¼Œä»¥ä¾¿æ’å…¥ markdown é“¾æ¥ã€‚
*  æ‹·è´ä¸€ä¸ªé“¾æ¥ï¼Œé€‰ä¸­æ–‡æœ¬åæŒ‰ä¸‹ âŒ˜âŒ¥V ä¼šè‡ªåŠ¨æ’å…¥å†…è”é“¾æ¥ã€‚
*  æ‹·è´ä¸€ä¸ªé“¾æ¥ï¼Œé€‰ä¸­æ–‡æœ¬åæŒ‰ä¸‹ âŒ˜âŒ¥R ä¼šè‡ªåŠ¨æ’å…¥å¼•ç”¨é“¾æ¥ã€‚
*  âŒ˜K æ’å…¥é“¾æ¥ï¼›âŒ˜â‡§K æ’å…¥å›¾ç‰‡ã€‚
*  âŒ˜B å’Œ âŒ˜I åˆ†åˆ«ç”¨äºåŠ ç²—ä½“å’Œæ–œä½“ã€‚
*  é€‰ä¸­æ–‡æœ¬åæŒ‰ä¸‹ # ä¼šè‡ªåŠ¨åœ¨æ–‡æœ¬å‰åè¿›è¡Œé…å¯¹ï¼Œå¯é‡å¤æŒ‰ä¸‹æ¥å®šä¹‰æ ‡é¢˜çº§åˆ«ï¼Œè¿˜å¯ç”¨ âŒ˜â‡§ç©ºæ ¼ æ¥å¢åŠ  # ä¸æ‰€é€‰æ–‡æœ¬ä¹‹é—´çš„ç©ºæ ¼ï¼ˆä¹Ÿæ˜¯è‡ªåŠ¨é…å¯¹çš„ï¼‰ã€‚
</code></pre>

<blockquote><p>æœ‰äº›å¿«æ·é”®å¯èƒ½ä¸ç³»ç»Ÿçš„ä¸€äº›å‘ç”Ÿå†²çªï¼Œå¯ä»¥è·Ÿä¹‹å‰ä¸€æ ·ï¼Œé€šè¿‡ä¿®æ”¹è‡ªå®šä¹‰å¿«æ·é”®æ–‡ä»¶</p></blockquote>

<h4>JsFormat</h4>

<blockquote><p>åŠŸèƒ½ç±»ä¼¼ä¹‹å‰Vimä½¿ç”¨çš„Js beautifulæ’ä»¶ï¼Œç¾åŒ–ä½ çš„Jsä»£ç ï¼Œå¯ä»¥é€šè¿‡Package Control ç›´æ¥å®‰è£…ã€‚æŒ‰ä½<code>shift + cmd + p</code>è¾“å…¥js formatå¯ä»¥å¯¹jsæ–‡ä»¶è¿›è¡Œç¾åŒ–ã€‚</p></blockquote>

<h4>Git</h4>

<blockquote><p>ä½ å¯ä»¥é€šè¿‡æŒ‰ä½<code>shift + cmd + p</code>ç„¶åè¾“å…¥å‡ ä¹æ‰€æœ‰<code>git</code>å‘½ä»¤,ä¸ªäººå¾ˆå–œæ¬¢é‡Œé¢çš„<code>git blame</code>å‘½ä»¤,åœ¨å½“å‰æ–‡ä»¶ä¸‹ï¼Œè¾“å…¥<code>git blame</code>å‘½ä»¤åï¼Œä¼šæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶,ç›´æ¥çœ‹åˆ°å½“å‰æ–‡ä»¶çš„ä¿®æ”¹å†…å®¹ï¼Œè¿™äº›æ˜¯è°ä¿®æ”¹çš„å°±ä¸€æ¸…äºŒæ¥šå•¦&hellip;</p></blockquote>

<h4>Alignment</h4>

<blockquote><p>è¿™ä¸ªæ’ä»¶å¯¹äºæœ‰å¼ºè¿«ç—‡çš„åŒå­¦ï¼Œç®€ç›´å°±æ˜¯ç¦éŸ³å•Šã€‚ä¾‹å¦‚ä¸€ä¸‹ä»£ç </p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">clothPartInfoGrid</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createGridPanel</span><span class="p">();</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">yarnGrid</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createYarnGrid</span><span class="p">();</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">indexPanel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createIndexPanel</span><span class="p">();</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">mainPanel</span> <span class="o">=</span>  <span class="k">this</span><span class="p">.</span><span class="nx">createMainPanel</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>ç®€å•é€šè¿‡é€‰æ‹©ï¼Œ<code>ctrl+command+a</code>,å³å¯ç¾åŒ–</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">clothPartInfoGrid</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createGridPanel</span><span class="p">();</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">yarnGrid</span>          <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createYarnGrid</span><span class="p">();</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">indexPanel</span>        <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createIndexPanel</span><span class="p">();</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">mainPanel</span>         <span class="o">=</span>  <span class="k">this</span><span class="p">.</span><span class="nx">createMainPanel</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ä¸ºSublime Text æ·»åŠ ä¸»é¢˜</h3>

<blockquote><p>å¯ä»¥é€šè¿‡Package Control å®‰è£…æœç´¢,æŒ‰ä½<code>cmd+shift+p</code>,è¾“å…¥<code>install package</code>,ç„¶åè¾“å…¥ç›¸åº”ä¸»é¢˜åï¼Œç„¶ååœ¨<code>user setting</code>é‚£é‡Œæ¿€æ´»ä¸»é¢˜</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;color_scheme&quot;</span><span class="o">:</span> <span class="s2">&quot;Packages/Theme - Flatland/Flatland Dark.tmTheme&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;theme&quot;</span><span class="o">:</span> <span class="s2">&quot;Flatland Dark.sublime-theme&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://www.masnun.com/2013/07/08/beautiful-themes-for-sublime-text-3.html">æ¨èä¸»é¢˜åˆ—è¡¨</a></p>

<h3>Sublime Text å°æŠ€å·§</h3>

<ol>
<li>é˜²æ­¢è‡ªåŠ¨æ›´æ–°: æ‰¾åˆ°Preferences -> Settings-User,ç„¶ååœ¨é‡Œé¢æ·»åŠ <code>"update_check":false</code></li>
<li>ä¸ºäº†èƒ½å¤Ÿåœ¨ç»ˆç«¯ç›´æ¥æ‰“å¼€Sublime,ä½ å¯ä»¥å»ºç«‹ä¸€ä¸ªè½¯è¿æ¥,åœ¨ç»ˆç«¯è¾“å…¥
<code>sudo ln -s "/Applications/Sublime Text.app/Contents/SharedSupport/bin/subl" /bin/subl</code>ï¼Œç„¶åå°±å¯ä»¥è¿è¡Œ<code>subl --help</code>æ¥æŸ¥çœ‹å‘½ä»¤å¸®åŠ©</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">ä½¿ç”¨</span><span class="p">:</span>  <span class="n">subl</span> <span class="o">[</span><span class="err">å‚æ•°</span><span class="o">]</span> <span class="o">[</span><span class="err">æ–‡ä»¶</span><span class="o">]</span>         <span class="err">ç¼–è¾‘æŒ‡å®šæ–‡ä»¶</span>
</span><span class='line'>   <span class="err">æˆ–</span><span class="p">:</span> <span class="n">subl</span> <span class="o">[</span><span class="err">å‚æ•°</span><span class="o">]</span> <span class="o">[</span><span class="err">ç›®å½•</span><span class="o">]</span>            <span class="err">æ‰“å¼€æŒ‡å®šç›®å½•</span>
</span><span class='line'>   <span class="err">æˆ–</span><span class="p">:</span> <span class="n">subl</span> <span class="o">[</span><span class="err">å‚æ•°</span><span class="o">]</span> <span class="o">-</span>             <span class="err">ç¼–è¾‘</span> <span class="n">stdin</span>
</span><span class='line'><span class="err">å¯ç”¨å‚æ•°</span><span class="p">:</span>
</span><span class='line'>  <span class="o">--</span><span class="n">project</span> <span class="o">&lt;</span><span class="err">é¡¹ç›®</span><span class="o">&gt;</span><span class="p">:</span> <span class="err">è¯»å–æŒ‡å®šé¡¹ç›®</span>
</span><span class='line'>  <span class="o">--</span><span class="n">command</span> <span class="o">&lt;</span><span class="err">å‘½ä»¤</span><span class="o">&gt;</span><span class="p">:</span> <span class="err">è¿è¡ŒæŒ‡å®šå‘½ä»¤</span>
</span><span class='line'>  <span class="o">-</span><span class="n">n</span> <span class="err">æˆ–</span> <span class="o">--</span><span class="kp">new</span><span class="o">-</span><span class="ss">window</span><span class="p">:</span>  <span class="err">æ‰“å¼€æ–°çª—å£</span>
</span><span class='line'>  <span class="o">-</span><span class="n">a</span> <span class="err">æˆ–</span> <span class="o">--</span><span class="ss">add</span><span class="p">:</span>         <span class="err">å‘å½“å‰çª—å£ä¸­æ·»åŠ æ–‡ä»¶å¤¹</span>
</span><span class='line'>  <span class="o">-</span><span class="n">w</span> <span class="err">æˆ–</span> <span class="o">--</span><span class="ss">wait</span><span class="p">:</span>        <span class="err">ç­‰å¾…æ–‡ä»¶å…³é—­åå†è¿”å›</span>
</span><span class='line'>  <span class="o">-</span><span class="n">b</span> <span class="err">æˆ–</span> <span class="o">--</span><span class="ss">background</span><span class="p">:</span>  <span class="err">ä¸æ¿€æ´»ç¨‹åºçª—å£</span>
</span><span class='line'>  <span class="o">-</span><span class="n">s</span> <span class="err">æˆ–</span> <span class="o">--</span><span class="ss">stay</span><span class="p">:</span>        <span class="err">å…³é—­æ–‡ä»¶åä¿æŒç¨‹åºçª—å£æ¿€æ´»</span>
</span><span class='line'>  <span class="o">-</span><span class="n">h</span> <span class="err">æˆ–</span> <span class="o">--</span><span class="ss">help</span><span class="p">:</span>        <span class="err">æ˜¾ç¤ºæ­¤å¸®åŠ©</span>
</span><span class='line'>  <span class="o">-</span><span class="n">v</span> <span class="err">æˆ–</span> <span class="o">--</span><span class="ss">version</span><span class="p">:</span>     <span class="err">æ˜¾ç¤ºç‰ˆæœ¬å·</span>
</span><span class='line'><span class="err">è¯»å–</span> <span class="n">stdin</span> <span class="err">æ—¶ä¼šä½¿ç”¨</span> <span class="o">--</span><span class="n">wait</span> <span class="err">å‚æ•°ã€‚é€šè¿‡</span> <span class="o">--</span><span class="n">stay</span> <span class="err">å¯ä»¥åœ¨æ–‡ä»¶å…³é—­åä¸è¿”å›ç»ˆç«¯ï¼ˆä»…é’ˆå¯¹å•ä¸ªæ–‡ä»¶ï¼‰ã€‚</span>
</span><span class='line'><span class="err">å¯ä»¥é€šè¿‡å‘æ–‡ä»¶åæ·»åŠ </span> <span class="sb">`:è¡Œå·`</span> <span class="err">æˆ–</span> <span class="sb">`:è¡Œå·:åˆ—å·`</span> <span class="err">åç¼€æ¥æ‰“å¼€åˆ°æ›´å…·ä½“çš„ä½ç½®ã€‚</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><p>å¼€å¯è‡ªåŠ¨æ¢è¡Œï¼šæŒ‰ä½<code>command+shift+p</code>,è¾“å…¥<code>setting user</code>ï¼Œå¾€é‡Œé¢æ·»åŠ <code>"word_wrap" : true</code></p></li>
<li><p>æœ€åçš„é…ç½®æ˜¯è¿™æ ·çš„ï¼š</p></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;color_scheme&quot;</span><span class="p">:</span> <span class="s2">&quot;Packages/Theme - Flatland/Flatland Dark.tmTheme&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;ignored_packages&quot;</span><span class="p">:</span> <span class="o">[]</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;theme&quot;</span><span class="p">:</span> <span class="s2">&quot;Flatland Dark.sublime-theme&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;update_check&quot;</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;word_wrap&quot;</span> <span class="p">:</span> <span class="kp">true</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rubyä¸­çš„block]]></title>
    <link href="http://justin-lu.github.io/blog/2013/10/24/rubyzhong-de-block/"/>
    <updated>2013-10-24T18:16:00+08:00</updated>
    <id>http://justin-lu.github.io/blog/2013/10/24/rubyzhong-de-block</id>
    <content type="html"><![CDATA[<p>rubyç¼–ç¨‹ä¸­çš„blockç®€å•ä»‹ç»</p>

<!-- More -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rubyä¸­çš„instance_eavlå’Œclass_eval]]></title>
    <link href="http://justin-lu.github.io/blog/2013/09/26/rubyzhong-de-instance-eavlhe-class-eval/"/>
    <updated>2013-09-26T12:27:00+08:00</updated>
    <id>http://justin-lu.github.io/blog/2013/09/26/rubyzhong-de-instance-eavlhe-class-eval</id>
    <content type="html"><![CDATA[<p>rubyå…ƒç¼–ç¨‹ä¸­çš„instance_eavlå’Œclass_evalç®€å•ä»‹ç»</p>

<!-- More -->


<p>ç¬¬äºŒæ¬¡çœ‹Rubyå…ƒç¼–ç¨‹è¿™æœ¬ä¹¦ï¼Œæ„Ÿè§‰é‡Œé¢èƒ½å­¦åˆ°çš„ä¸œè¥¿å¾ˆå¤šï¼Œä½†æ˜¯å¾ˆå®¹æ˜“å¿˜è®°ï¼Œæ‰€ä»¥æŠŠä¸€äº›æƒ³æ³•å†™ä¸‹æ¥ï¼Œä»¥å¤‡åç”¨ã€‚</p>

<h1>instance_eval</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">My</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>    <span class="vi">@v</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">obj</span> <span class="o">=</span> <span class="no">My</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">v</span> <span class="o">=</span> <span class="mi">3</span>
</span><span class='line'><span class="n">obj</span><span class="o">.</span><span class="n">instance_eval</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="nb">self</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="vi">@v</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">v</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">one_method</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;I&#39;m one_method&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="c1">#=&gt; #&lt;My:0xa2b76a4&gt;</span>
</span><span class='line'><span class="c1">#=&gt; 1</span>
</span><span class='line'><span class="c1">#=&gt; 3</span>
</span><span class='line'><span class="n">obj</span><span class="o">.</span><span class="n">one_method</span>
</span><span class='line'><span class="c1">#=&gt; I&#39;m one_method</span>
</span><span class='line'><span class="n">obj2</span> <span class="o">=</span> <span class="no">My</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">obj2</span><span class="o">.</span><span class="n">one_method</span>
</span><span class='line'><span class="c1">#=&gt; NoMethodError: undefined method `one_method&#39; for #&lt;My:0xa2f3f14 @v=1&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ†æä¸Šé¢ä»£ç ï¼š</p>

<ul>
<li>å½“æˆ‘ä»¬å®ä¾‹åŒ–ä¸€ä¸ªç±»æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡instance_evalæ¥è®¿é—®åˆ°è¯¥ç±»çš„å®ä¾‹æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>self</code>è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œ<code>@v</code>è¿”å›1</li>
<li>ç”±äºblockæ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œæ‰€ä»¥åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œå¯ä»¥è®¿é—®å±€éƒ¨å˜é‡<code>v</code>ï¼Œè€Œä¸”èƒ½è®¿é—®å±€éƒ¨å˜é‡@vï¼Œè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æŠŠä»–å«åš<code>ä¸Šä¸‹æ–‡æ¢é’ˆ</code>ï¼Œå®ƒå°±åƒæ˜¯ä¸€ä¸ªæ·±å…¥åˆ°å¯¹è±¡ä¸­çš„ä»£ç ç‰‡æ®µï¼Œå¯¹å…¶è¿›è¡Œæ“ä½œã€‚</li>
<li>å½“æˆ‘ä»¬åœ¨instance_evalå—é‡Œé¢å®šä¹‰æ–¹æ³•æ˜¯ï¼Œç”±äºselfä¸ºå½“å‰å¯¹è±¡ï¼Œæ‰€ä»¥ <code>def</code>å…³é”®å­æ‰“å¼€çš„ä½œç”¨åŸŸé—¨ä¸ºselfï¼Œå³å®šä¹‰çš„æ–¹æ³•åªæœ‰objå¯ä»¥è®¿é—®ï¼Œæˆ‘ä»¬ç§°å®ƒä¸ºå•ä»¶æ–¹æ³•ã€‚</li>
</ul>
</li>
<li><p>ç„¶åï¼Œæˆ‘ä»¬æ€»ç»“instance_evalçš„ä½œç”¨ï¼š</p>

<ul>
<li>instance_evalçš„è°ƒç”¨è€…å¿…é¡»æ˜¯ä¸€ä¸ªå®ä¾‹</li>
<li>æ”¹å˜å½“å‰blockçš„æ¥å—è€…ä¸ºselfï¼Œå› æ­¤å®ƒå¯ä»¥è®¿é—®æ¥å—è€…çš„ç§æœ‰æ–¹æ³•å’Œå®ä¾‹å˜é‡</li>
<li>å¯ä»¥åœ¨blockå†…ä½¿ç”¨å•ä»¶æ–¹æ³•</li>
</ul>
</li>
<li><p>æœ€åï¼Œæˆ‘ä»¬è¿˜å‘ç°ï¼Œå¯ä»¥ç”¨instance_eavlæ¥å®šä¹‰ç±»æ–¹æ³•</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">A</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="n">A</span><span class="o">.</span><span class="n">instance_eval</span> <span class="k">do</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">a_method</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;I&#39;m class method&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="n">A</span><span class="o">.</span><span class="n">a_method</span>
</span><span class='line'><span class="c1">#=&gt;I&#39;m class method</span>
</span></code></pre></td></tr></table></div></figure>


<h1>class_eval(åˆåmodule_eval)</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">add_method_to</span><span class="p">(</span><span class="n">a_class</span><span class="p">)</span>
</span><span class='line'>  <span class="n">a_class</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="nb">self</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">m</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s1">&#39;hello&#39;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="c1">#=&gt; String</span>
</span><span class='line'>
</span><span class='line'><span class="s2">&quot;abc&quot;</span><span class="o">.</span><span class="n">m</span>
</span><span class='line'><span class="n">add_method_to</span> <span class="nb">String</span>
</span><span class='line'><span class="s1">&#39;abc&#39;</span><span class="o">.</span><span class="n">m</span>
</span><span class='line'><span class="c1">#=&gt; NoMethodError: undefined method `m&#39; for &quot;abc&quot;:String</span>
</span><span class='line'><span class="c1">#=&gt; &quot;hello&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>åˆ†æä¸Šé¢ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°<code>class_eval</code>å’Œ<code>instance_eval</code>çš„åŒºåˆ«ï¼š
  <em><code>class_eval</code>çš„è°ƒç”¨å¯¹è±¡å¿…é¡»æ˜¯ä¸€ä¸ªç±»
  </em><code>class_eval</code>blocké‡Œé¢çš„selfä¸ºç±»æœ¬èº«(å®é™…ä¸Šæ˜¯é‡æ–°æ‰“å¼€äº†è¯¥ç±»ï¼Œç›¸å½“äºå…³é”®å­—<code>class</code>)
  *<code>class_eval</code>å®šä¹‰çš„æ–¹æ³•ä¸ºç±»çš„å®ä¾‹æ–¹æ³•ï¼ˆinstance_evalæ˜¯å•ä»¶æ–¹æ³•ï¼‰</li>
</ul>


<h1>æ€»ç»“ï¼šä»€ä¹ˆæ—¶å€™ç”¨<code>class_eval</code>å’Œ<code>instance_eval</code></h1>

<p>  <em>å¦‚æœæ‰“å¼€çš„å¯¹è±¡ä¸æ˜¯ç±»ï¼Œåˆ™ä½¿ç”¨<code>instance_eval</code>,å¦‚æœæƒ³æ‰“å¼€ä¸€ä¸ªç±»å®šä¹‰å¹¶ä¸”ç”¨<code>def</code>å®šä¹‰å®ä¾‹æ–¹æ³•ï¼Œåˆ™é€‰æ‹©<code>class_eval</code>
  </em>æ ¹æ®è°ƒç”¨è€…æ¥å†³å®š
  *æ ¹æ®ä½ çš„æ„å›¾æ¥å†³å®š</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Asset pipeline ç†è§£]]></title>
    <link href="http://justin-lu.github.io/blog/2013/08/10/asset-pipeline-li-jie/"/>
    <updated>2013-08-10T16:46:00+08:00</updated>
    <id>http://justin-lu.github.io/blog/2013/08/10/asset-pipeline-li-jie</id>
    <content type="html"><![CDATA[<p>ç®€å•ä»‹ç»ä¸ªäººå¯¹Asset pipelineçš„ç†è§£</p>

<!-- More -->


<h3>Asset Pipeline æ˜¯ä»€ä¹ˆ</h3>

<blockquote><p>asset pipline æ˜¯ä¸€ä¸ªæä¾›è¿ç»“ç¼©å°æˆ–è€…å‹ç¼© JavaScript å’Œ CSS èµ„æºçš„æ¡†æ¶ã€‚å®ƒä¹Ÿæ·»åŠ äº†ç”¨å…¶å®ƒè¯­è¨€ç¼–å†™è¿™äº›èµ„æºçš„åŠŸèƒ½, å¦‚ CoffeeScript, Sass å’Œ ERBã€‚</p>

<p>å¯¹äºæ–°æ‰‹æ¥è¯´ï¼ŒAsset Pipelineæ— ç–‘æ˜¯ä¸€ä¸ªæ¯”è¾ƒéš¾æŒæ¡çš„å†…å®¹ï¼Œç‰¹åˆ«æ˜¯å½“Productionæ¨¡å¼ä¹‹åï¼Œå¯èƒ½é‡åˆ°çš„é—®é¢˜ä¼šæ›´å¤šï¼Œæˆ‘ä»¬åªæœ‰ç†è§£å®ƒï¼Œæ‰èƒ½æ›´å¥½çš„ä½¿ç”¨å®ƒã€‚</p></blockquote>

<ol>
<li>Rails 3.1 ä¹‹åï¼Œ<code>asset pipeline</code>æ˜¯è‡ªåŠ¨æ‰“å¼€çš„ï¼Œä½ æœ‰ä¸¤ç§æ–¹å¼ä¸ä½¿ç”¨å®ƒ:</li>
<li>åœ¨<code>config/application.rb</code>é‡Œé¢æ·»åŠ ï¼š<code>config.assets.enabled = false</code></li>
<li>ä¹Ÿå¯ä»¥åœ¨æ–°å»ºAppçš„æ—¶å€™é€šè¿‡å‚æ•°æ¥å…³é—­:<code>rails new appname --skip-sprockets</code></li>
<li>ç›®å½•ç»“æ„</li>
<li><code>app/assets</code>å­˜æ”¾åº”ç”¨ç¨‹åºæœ¬èº«æ‰€ä½¿ç”¨çš„JSã€CSSå’ŒImage</li>
<li><code>lib/assets</code>å­˜æ”¾è‡ªå·±æ‹“å±•çš„JSã€CSSå’ŒImage</li>
<li><code>vendor/assets</code>å­˜æ”¾ç¬¬ä¸‰æ–¹æ‹“å±•JSã€CSSå’ŒImageï¼Œä¾‹å¦‚Jqueryã€Extjsç­‰ä¸€äº›ç±»åº“</li>
<li>æœç´¢è·¯å¾„</li>
<li>åœ¨<code>config/application.rb</code>é‡Œé¢<code>config.assets.paths &lt;&lt; Rails.root.join("app", "assets")</code>é‡Œé¢å¯ä»¥æ·»åŠ åˆ°é¢„ç¼–è¯‘åˆ—è¡¨</li>
<li>ä¾‹å¦‚ï¼Œéœ€è¦åŠ è½½è¿™ä¸ªæ–‡ä»¶<code>app/assets/javascripts/home.js</code>,è¿™åªéœ€è¦åœ¨<code>application.js</code>é‡Œé¢æ·»åŠ <code>=// require home</code>å³å¯</li>
<li>æ³¨æ„ï¼šå¦‚æœå¼•ç”¨èµ„æºæ¸…å•å¤–çš„æ–‡ä»¶ï¼Œå¿…é¡»åŠ è½½åˆ°é¢„ç¼–è¯‘åˆ—è¡¨ï¼Œå¦çŸ¥producionç¯å¢ƒä¸å¯ç”¨</li>
</ol>


<hr />

<p>æ›´å¤šè¯¦ç»†èµ„æ–™ï¼Œè¯·å‚é˜…</p>

<ul>
<li><a href="http://guides.ruby-china.org/asset_pipeline.html">Asset Pipline ä¸­æ–‡ç‰ˆ</a></li>
<li><a href="http://guides.rubyonrails.org/asset_pipeline.html">Asset Pipline è‹±æ–‡ç‰ˆ</a></li>
<li>å¦‚æœéœ€è¦ï¼Œå¯åœ¨<code>config/application.rb</code>æ·»åŠ <code>config.assets.enabled = false</code>å…³é—­<code>asset pipeline</code>åŠŸèƒ½</li>
</ul>


<h3>å¦‚ä½•ç®¡ç†æ•°æ®</h3>

<ol>
<li>ä¸€ä¸ªæ–°çš„<code>Rails</code>åº”ç”¨ç¨‹åºåŒ…å«äº†ä¸€ä¸ªé»˜è®¤çš„<code>app/assets/javascripts/application.js</code>æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«äº†ä¸€äº›è¡Œ:</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// ...</span>
</span><span class='line'><span class="c1">//= require jquery</span>
</span><span class='line'><span class="c1">//= require jquery_ujs</span>
</span><span class='line'><span class="c1">//= require_tree .</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>require_tree</code>æŒ‡ä»¤å‘Šè¯‰<code>Sprockets</code>é€’å½’åœ°å»åŒ…å«åœ¨æŒ‡å®šç›®å½•ä¸‹<code>æ‰€æœ‰</code>çš„ JavaScript æ–‡ä»¶åˆ°è¾“å‡ºé‡Œ</li>
<li><code>require_directory</code>å®ƒä¼šå°†åœ¨æŸä¸ªç‰¹å®šç›®å½•ä¸‹æ‰€æœ‰çš„ JavaScript æ–‡ä»¶åŒ…å«è¿›å»ï¼Œä½†ä¸é€’å½’.</li>
<li><code>include</code>ä¸require ä¸€æ ·ï¼Œå·®åˆ«åœ¨äºå³ä½¿æ˜¯è¢«åŠ è½½è¿‡çš„æ–‡ä»¶ï¼Œä¹Ÿä¼šè¢«å†æ¬¡åŠ è½½</li>
<li><code>require_self</code> å‘Šè¨´<code>Sprockets</code>åœ¨è½½å…¥å…¶ä»–çš„æ–‡ä»¶æ—¶ï¼Œå…ˆå°†è‡ªå·±çš„å†…å®¹</li>
<li><code>stub</code>å°†è·¯å¾„ä¸­å¾—assetsåŠ å…¥é»‘åå•ï¼Œæ‰€æœ‰å…¶ä»–çš„requireéƒ½ä¸ä¼šå°†å®ƒè½½å…¥</li>
<li>æ³¨æ„ï¼šå¼•ç”¨æ—¶ä¸éœ€è¦æ˜¾ç¤ºæä¾›æ‹“å±•å,<code>require_tree</code>åŒ…å«çš„æ–‡ä»¶æ˜¯æ²¡æœ‰é¡ºåºçš„ã€‚</li>
<li>å…³æ‰<code>require_tree .</code>,å®ƒä¼šé€’å½’åŠ è½½å½“å‰æ–‡ä»¶ä¸‹å¾—æ‰€æœ‰æ–‡ä»¶ï¼Œå¯¹äºå°ç³»ç»Ÿæ¥è¯´ï¼Œå¯èƒ½æ²¡å¤šå¤§å½±å“ï¼Œç³»ç»Ÿå¤æ‚äº†ï¼Œæ¯æ¬¡éƒ½åŠ è½½é‚£ä¹ˆå¤šæ–‡ä»¶ï¼Œè®¿é—®å°±ä¼šå˜æ…¢äº†ã€‚</li>
<li>æ ¹æ®éœ€æ±‚ï¼Œç»„ç»‡ä½ è‡ªå·±çš„åŠ è½½æ–¹å¼ï¼Œä¸€ä¸‹æ ¹æ®åšERPç³»ç»Ÿï¼Œå†™å‡ºæˆ‘çš„åŠ è½½æ–¹å¼</li>
<li>å»æ‰<code>require_tree .</code></li>
<li>åœ¨ä¸‰ä¸ª<code>appliction.js</code>æ–‡ä»¶ä¸­ï¼Œæ·»åŠ é¡¹ç›®å·¥ç”¨çš„JSå’ŒCSSä»£ç ï¼Œé»˜è®¤éƒ½ä¼šç¼–è¯‘</li>
<li>é€šè¿‡ä¿®æ”¹<code>config.assets.precompile += %w( other.js , another.js)</code>ï¼Œå¢åŠ é™¤äº†<code>application.js</code>å¤–çš„æ–‡ä»¶ï¼‰</li>
<li>åœ¨<code>/app/application_controller.rb</code>é‡Œé¢æ·»åŠ <code>&lt;%= javascript_include_tag params[:controller]/params[:action] %&gt;</code>æˆ–è€…<code>&lt;%= stylesheet_link_tag params[:controller]/params[:action] %&gt;</code>åŠ è½½æ¯ä¸ªé¡µé¢æ‰€ä½¿ç”¨åˆ°çš„Jså’ŒCSSæ–‡ä»¶</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rspecæµ‹è¯•(Grurd+spork+capybara)]]></title>
    <link href="http://justin-lu.github.io/blog/2013/08/10/rspecce-shi-grurd-plus-sporcapybara/"/>
    <updated>2013-08-10T16:45:00+08:00</updated>
    <id>http://justin-lu.github.io/blog/2013/08/10/rspecce-shi-grurd-plus-sporcapybara</id>
    <content type="html"><![CDATA[<p>Rspecæµ‹è¯•æ¡†æ¶ä»‹ç»
æ—¶é—´ä¸å¤Ÿï¼Œè¿‡åè¡¥ä¸Š</p>

<!-- More -->

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[chanceEasy Summary]]></title>
    <link href="http://justin-lu.github.io/blog/2013/07/15/chanceeasy-summary/"/>
    <updated>2013-07-15T08:39:00+08:00</updated>
    <id>http://justin-lu.github.io/blog/2013/07/15/chanceeasy-summary</id>
    <content type="html"><![CDATA[<p>chanceEasy é¡¹ç›®æ€»ç»“</p>

<!-- More -->




<!--* æ–‡æ¡£ï¼šæ–‡æ¡£è§„èŒƒåŒ–é—®é¢˜-->


<!--* ä¸šåŠ¡ï¼šä¸šåŠ¡ä¸ç†Ÿç»ƒ-->


<!--    * ç›‘æ§-->


<!--* æ—¶é—´ä¸å¤Ÿã€çŠ¶æ€ä¸ä½³-->




<!--* æˆå‘˜åˆ†å·¥ä¸æ˜ç¡®ã€è´£èŒæ˜ç¡®ã€ç›®æ ‡ä¸æ˜ç¡®-->


<!--* ç›®æ ‡ä¸æ˜ç¡®ã€ä¸ºå®Œæˆä»»åŠ¡è€Œåšä»»åŠ¡ã€å¯¼è‡´ä¸æ€è€ƒã€æ²¡åŠ¨åŠ›ã€æ²¡çŠ¶æ€-->


<!--* æ–‡æ¡£æè¿°ä¸æ¸…ã€æ²¡æœ‰å°½åˆ°è¯¥æœ‰çš„æ•ˆæœ ã€æ²¡æœ‰æ£€æŸ¥ã€ç›‘ç£æ–‡æ¡£-->


<!--* å†³ç­–æœ‰è¯¯-->


<!--* å¼€å‘æ°”æ°›ï¼ˆå¤´è„‘é£æš´ã€æŠ€æœ¯ç ”ç©¶ï¼‰-->


<!--* è´£ä»»å¿ƒä¸å¼º-->


<!--* å¿ƒé‡Œå‹åŠ›-->


<!--* è¿›åº¦æŠŠæ§-->


<!--* åŸ¹å…»æ–¹æ¡ˆæ”¹é©-->




<!--è½¯ä»¶å·¥ç¨‹è¿‡ç¨‹ï¼ˆéœ€æ±‚æ–‡æ¡£ã€æ•°æ®åº“è®¾è®¡ã€è§„èŒƒæ–‡æ¡£ã€ä»£ç å°è£…æ–‡æ¡£ï¼‰-->


<!--å¼€å‘å·¥å…·-->


<!--è®¡åˆ’ä¸è¿›åº¦æŠŠæ§-->


<!--å›¢é˜Ÿé¢ä¸´é—®é¢˜-->


<h2>è®²è¯¾å†…å®¹</h2>

<!--åå‘ç®¡ç†-->


<blockquote><p>ä»Šå¤©åˆ†äº«çš„å†…å®¹ï¼Œä¸»è¦æ˜¯æ€»ç»“ChanceEasyç¬¬ä¸€é˜¶æ®µä»éœ€æ±‚åˆ†æåˆ°ç³»ç»Ÿéƒ¨ç½²çš„æ•´ä¸€ä¸ªè½¯ä»¶å¼€å‘è¿‡ç¨‹ï¼Œæ¯ä¸€ä¸ªé˜¶æ®µæ‰€ä½¿ç”¨çš„å·¥å…·ã€æ–¹æ³•ã€å’Œé¢ä¸´çš„é—®é¢˜å’Œè§£å†³æ–¹æ³•ã€‚</p>

<blockquote><ul>
<li>éœ€æ±‚åˆ†æ</li>
<li>æ•°æ®åº“è®¾è®¡</li>
<li>å¼€å‘è¿‡ç¨‹</li>
<li>ç³»ç»Ÿæµ‹è¯•</li>
<li>ç³»ç»Ÿéƒ¨ç½²</li>
<li>ä¸ªäººæ€»ç»“</li>
<li>è®²è¯¾è¿‡ç¨‹ä¸­ï¼Œå¸Œæœ›å¤§å®¶ç§¯æå‚ä¸è®¨è®º</li>
</ul>
</blockquote></blockquote>

<h2>éœ€æ±‚åˆ†æ</h2>

<ul>
<li>æ–¹æ³•ï¼šé€šè¿‡å£å¤´äº¤æµè·å–éœ€æ±‚ï¼Œåˆ†æå•æ®ä¿¡æ¯ï¼Œå½¢æˆéœ€æ±‚ï¼Œå®ç°é¡µé¢åŸå‹ï¼Œä¾›ç”¨æˆ·ç¡®è®¤ï¼›æ¯æ¬¡è°ƒç ”å‰çš„è®¡åˆ’æ–‡æ¡£ã€è°ƒç ”åçš„æ€»ç»“æ–‡æ¡£ï¼›ç»è¿‡å¤šæ¬¡ä¿®æ”¹ï¼Œå½¢æˆç¡®è®¤ç‰ˆæœ¬ï¼Œé’ˆå¯¹æ¯ä¸ªé¡µé¢åšè¯¦ç»†å¼€å‘æ³¨é‡Šæ–‡æ¡£</li>
<li>äº§ç‰©ï¼šæµç¨‹å›¾+é¡µé¢åŸå‹+è°ƒç ”æ–‡æ¡£</li>
<li>ä¼˜ç‚¹ï¼šç”±äºç•Œé¢æ¸…æ™°å¯è§ï¼Œå¯ä»¥è·Ÿç”¨æˆ·å¾ˆå¥½çš„è¿›è¡Œæ²Ÿé€š</li>
<li>ç¼ºç‚¹ï¼šæ–‡æ¡£è§„èŒƒæ€§ã€å¯è¯»æ€§ã€å¯ä¿®æ”¹æ€§ã€å‡†ç¡®æ€§ã€å®Œæ•´æ€§ï¼ˆå“ªäº›è¦å¡«å“ªäº›ä¸è¦å¡«ï¼‰</li>
<li>ç»éªŒæ€»ç»“ï¼š

<ul>
<li>æµç¨‹å›¾ï¼šå¿…é¡»å‡†ç¡®æ— è¯¯ã€æ·»åŠ å¿…è¦æ³¨é‡Šã€èƒ½å‡†ç¡®æ— è¯¯æè¿°éœ€æ±‚ã€ï¼ˆå¹¶éœ€è¦å’Œå®¢æˆ·ç¡®è®¤ï¼‰</li>
<li>é™æ€é¡µé¢ï¼šå°½é‡èƒ½å¤Ÿè®©è¿™äº›å‰å°ä»£ç èƒ½å¤Ÿåœ¨å¼€å‘æ—¶ä½¿ç”¨ï¼Œå‡å°‘å¼€å‘æ—¶é—´</li>
<li>å¼€å‘æ–‡æ¡£ï¼šå¿…é¡»æœ‰éå¼€å‘è€…æ£€æŸ¥ã€ä¿è¯æ–‡æ¡£çš„å‡†ç¡®æ€§ã€å¯è¯»æ€§ã€æ— äºŒä¹‰æ€§</li>
<li>è°ƒç ”æ–‡æ¡£ï¼šç”±äºéœ€æ±‚è·Ÿæ”¹è¾ƒå¿«ã€æ–‡æ¡£è¿‡å¤šã€ç»´æŠ¤è‰°éš¾</li>
<li>æ²¡ç«™åœ¨å®¢æˆ·çš„è§’åº¦çœ‹é—®é¢˜ã€æ²¡å½¢æˆæ•°æ®æµå›¾</li>
</ul>
</li>
</ul>


<h2>æ•°æ®åº“è®¾è®¡</h2>

<ul>
<li>æ–¹æ³•ï¼šç”±æ¯ä¸ªæ¨¡å—çš„è´Ÿè´£äººæå‰è®¾è®¡å¥½å„è‡ªæ¨¡å—çš„æ•°æ®åº“å…³ç³»ï¼Œæ ¹æ®é¡µé¢åŸå‹ï¼Œç»Ÿä¸€è®¨è®ºå„ä¸ªæ¨¡å—çš„è®¾è®¡ï¼Œå¹¶å®Œæˆæ•°æ®åº“å…³ç³»å›¾å’ŒGoogleæ–‡æ¡£ã€é¡µé¢æ³¨é‡Š</li>
<li>äº§ç‰©ï¼šç³»ç»Ÿæ•°æ®åº“å…³ç³»å›¾+Googleæ–‡æ¡£+é¡µé¢æ³¨é‡Š+çŠ¶æ€æ–‡æ¡£</li>
<li>ä¼˜ç‚¹ï¼šèƒ½å¤Ÿæ¸…æ¥šçš„çŸ¥é“æ•°æ®åº“è¡¨é—´å…³ç³»ã€æ•°æ®åº“è¡¨å­—æ®µå®šä¹‰å¯ä»¥ç›´æ¥å¯¼å…¥</li>
<li>ç¼ºç‚¹ï¼šç”±äºå¤šäººè®¨è®ºï¼Œæ•°æ®åº“è¡¨é—´å…³ç³»ã€å­—æ®µå‡†ç¡®æ€§å¾ˆéš¾ç¡®å®šï¼›æ²¡è¿›å…¥å®é™…å¼€å‘ï¼Œæœ‰äº›è®¾è®¡ä¸åˆç†</li>
<li>ç»éªŒæ€»ç»“ï¼š

<ul>
<li>å¿…é¡»æœ‰äººæ£€æŸ¥è¯¥è¿‡ç¨‹æ‰€å½¢æˆæ–‡æ¡£ã€ç¡®ä¿æ–‡æ¡£çš„å‡†ç¡®æ€§ã€ä¸ç„¶å®é™…å¼€å‘æ—¶ï¼Œè¯¥æ–‡æ¡£å¹¶æ²¡æœ‰èµ·åˆ°å¾ˆå¥½çš„ä½œç”¨</li>
<li>æ¯”è¾ƒç‰¹æ®Šçš„å­—æ®µï¼Œå¿…é¡»å†™æ¸…æ¥šä¸ºä½•è¿™æ ·è®¾è®¡</li>
<li>å­—æ®µå¿…é¡»ç»Ÿä¸€</li>
<li>å……åˆ†è€ƒè™‘æ•°æ®åº“çš„æ‹“å±•æ€§ï¼Œä¸ºéœ€æ±‚æ·»åŠ åšå‡†å¤‡</li>
</ul>
</li>
</ul>


<h2>ä»£ç å°è£…</h2>

<ul>
<li>æ–¹æ³•ï¼šæ ¹æ®ä¹‹å‰å¼€å‘ç»éªŒï¼Œç»Ÿä¸€è®¨è®ºéœ€è¦å°è£…çš„å†…å®¹ï¼Œå¹¶è½å®ç»™æ¯ä¸€ä¸ªäººã€‚å¹¶å®Œæˆç›¸å…³æ–‡æ¡£</li>
<li>äº§ç‰©ï¼šRuby+Jsçš„APIæ–‡æ¡£</li>
<li>ä¼˜ç‚¹ï¼šåŠ å¿«å¼€å‘é€Ÿåº¦ã€æœ‰åˆ©äºæŠ€æœ¯çš„æé«˜</li>
<li>ç¼ºç‚¹ï¼šæ— </li>
<li>ç»éªŒæ€»ç»“ï¼š

<ul>
<li>ç¼ºå°‘ä»£ç è´¨é‡ç›‘æ§ï¼Œä¸èƒ½ä¿è¯å°è£…çš„ä»£ç å·²åœ¨ä½¿ç”¨->Redmineä»£ç ç›‘æ§ã€Yammeré€šçŸ¥</li>
<li>ä¸èƒ½ä¸€å‘³ç¬¦åˆåŠŸèƒ½éœ€æ±‚->æœæ–­æ‘’å¼ƒä¸é€‚åˆåŠŸèƒ½</li>
<li>ä»£ç å°è£…åº”è¯¥äº¤ç»™ç»éªŒè¾ƒä¸ºä¸°å¯Œçš„å¼€å‘è€…</li>
<li>åœ¨å®é™…å¼€å‘ä¹‹å‰ï¼Œå¿…é¡»æŠŠä»£ç å°è£…ä»»åŠ¡å®Œæˆ->å¾…å°è£…ä»£ç æ–‡æ¡£</li>
<li>å…±ç”¨æ€§ä»£ç ã€æ–‡æ¡£å‡†ç¡®æ€§ï¼Œè¯¦ç»†æ€§</li>
</ul>
</li>
</ul>


<h2>å¼€å‘è¿‡ç¨‹</h2>

<ul>
<li>æ–¹æ³•ï¼šå…ˆå¤§æ¦‚è®²ä¸‹ä¸šåŠ¡æµç¨‹ï¼Œå¼€å‘è€…é€šè¿‡æµç¨‹å›¾ã€é¡µé¢æ³¨é‡Šã€æ•°æ®åº“è®¾è®¡è¿›è¡Œå¼€å‘</li>
<li>äº§ç‰©ï¼šé¡µé¢åŸå‹ï¼ˆæ¯ä¸ªé¡µé¢çš„é¡µé¢æ³¨é‡Šã€æ‰€ç”¨åˆ°çš„æ•°æ®åº“å…³ç³»ã€è¡¨å­—æ®µã€å•æ®ï¼‰</li>
<li>ä¼˜ç‚¹ï¼šå¼€å‘è€…èƒ½å¤Ÿæ˜ç¡®è·å¾—å¼€å‘æ—¶æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯</li>
<li>ç¼ºç‚¹ï¼šç»´æŠ¤è¿™ä»½æ–‡æ¡£æ¯”è¾ƒå›°éš¾ã€éœ€è¦è€—è´¹æ—¶é—´é•¿</li>
<li>å¼€å‘æ€»ç»“ï¼š

<ul>
<li> æ¯å¤©çš„ä¸‰åˆ†é’Ÿä¼šè®®æ— æ³•è·å–è¿›åº¦ä¸”æµªè´¹æ—¶é—´ï¼Œé€šè¿‡ä½¿ç”¨Yammeræ±‡æŠ¥è¿›åº¦ã€ä¸€å‘¨æ€»çš„è¿›åº¦æ±‡æŠ¥</li>
<li> ä»£ç è´¨é‡->ä½¿ç”¨Redmineä»£ç è¯„å®¡åŠŸèƒ½</li>
<li> å¼€å‘ç»“æœä¸éœ€æ±‚ä¸ç¬¦ã€ç›®æ ‡ä¸æ˜ç¡®</li>
<li> ç”±äºå®ç°çš„éœ€è¦ï¼Œæœ‰äº›é—®é¢˜å·²ç»è·ŸåŸæ¥éœ€æ±‚ç›¸ç¬¦->å¼€å‘æ—¶é—´å¤ªé•¿ã€å†ç¡®è®¤æ¯”è¾ƒéº»çƒ¦</li>
</ul>
</li>
</ul>


<h2>ç³»ç»Ÿæµ‹è¯•</h2>

<ul>
<li>æ–¹æ³•ï¼š å„è‡ªè´Ÿè´£é¡µé¢è¿›è¡Œæµ‹è¯•ã€å„è‡ªè´Ÿè´£æ¨¡å—æµ‹è¯•ã€è´Ÿè´£äººé›†æˆæµ‹è¯•ã€ç”¨æˆ·éªŒæ”¶æµ‹è¯•</li>
<li>äº§ç‰©ï¼šæµ‹è¯•æ–‡æ¡£</li>
<li>ä¼˜ç‚¹ï¼š</li>
<li>ç¼ºç‚¹ï¼š éœ€è¦å¤§é‡çš„äººå·¥æµ‹è¯•</li>
<li>ç»éªŒæ€»ç»“ï¼š

<ul>
<li>ç»éªŒä¸è¶³ï¼Œæ— æ³•ç¡®å®šæµ‹è¯•éœ€è¦æ—¶é—´ã€æ²¡æœ‰æ˜ç¡®çš„æµ‹è¯•ç›®æ ‡</li>
<li>æ²¡æœ‰è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰</li>
</ul>
</li>
</ul>


<h2>ç³»ç»Ÿéƒ¨ç½²</h2>

<ul>
<li>æ–¹æ³•ï¼šé…ç½®å¾…éƒ¨ç½²æœåŠ¡å™¨ã€éƒ¨ç½²å‰å‡†å¤‡å·¥ä½œã€æ¯ä¸€ä¸ªäººçš„åŸ¹è®­å®‰æ’</li>
<li>äº§ç‰©ï¼šéƒ¨ç½²è®¡åˆ’ã€éƒ¨ç½²æ–‡æ¡£</li>
<li>ä¼˜ç‚¹ï¼š</li>
<li>ç¼ºç‚¹ï¼š</li>
</ul>


<h2>ä¸ªäººæ€»ç»“</h2>

<ul>
<li>è®¡åˆ’çš„å®‰æ’åˆç†æ€§->å…ˆè¯•ç”¨ã€çœ‹æ˜¯å¦å®‰æ’åˆç†</li>
<li>è¿›åº¦çš„æŠŠæ§</li>
<li>ä»£ç è´¨é‡ç›‘æ§</li>
<li>ä»»åŠ¡å®Œæˆæƒ…å†µæŠŠæ§</li>
<li>çŠ¶æ€è°ƒæ•´</li>
<li>è§£å†³é—®é¢˜->å‘ç°é—®é¢˜è½¬å˜</li>
<li>ç›®æ ‡ä¸æ˜ç¡®->ä¸ºäº†å®Œæˆä»»åŠ¡è€Œåšä»»åŠ¡ã€å¯¼è‡´ä¸æ€è€ƒã€æ²¡åŠ¨åŠ›ã€æ²¡çŠ¶æ€</li>
<li>å¦‚ä½•å…¼é¡¾æŠ€æœ¯æé«˜å’Œé¡¹ç›®è¿›åº¦åˆç†ï¼ˆå¤´è„‘é£æš´ã€æŠ€æœ¯è®¨è®ºä¼šï¼‰</li>
<li>å®éªŒå®¤å¯ä»¥å½¢æˆè‡ªå·±çš„ä»£ç åº“</li>
<li>å†³ç­–å¤±è¯¯</li>
<li>æŠ€æœ¯æå‡çš„ä¸‰ä¸ªé˜¶æ®µæš‘å‡åŸ¹è®­ã€åŸ¹è®­å¸ˆå¼Ÿã€é¡¹ç›®ç®¡ç†</li>
</ul>


<h2>å®éªŒå®¤é¢ä¸´çš„é—®é¢˜</h2>

<ul>
<li>åŸ¹è®­æ–¹æ¡ˆ</li>
<li>é¡¹ç›®å‹ç€æˆ‘ä»¬ï¼Œå˜æˆå¼€å‘å·¥å…·ã€å­¦ä¹ ä¸åˆ°ä¸œè¥¿</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby on Railsé…ç½®]]></title>
    <link href="http://justin-lu.github.io/blog/2013/07/12/ruby-on-railspei-zhi/"/>
    <updated>2013-07-12T11:32:00+08:00</updated>
    <id>http://justin-lu.github.io/blog/2013/07/12/ruby-on-railspei-zhi</id>
    <content type="html"><![CDATA[<p>å®‰è£…Ruby On Rails è„šæœ¬.</p>

<!-- More -->


<ul>
<li><p>æŠŠä¸‹é¢å†…å®¹å¤åˆ¶åˆ°ä¸€ä¸ªåç¼€ä¸º<code>RVMé…ç½®ROR.sh</code>æ–°æ–‡ä»¶</p></li>
<li><p><code>chmod +x RVMé…ç½®ROR.sh</code> #å˜ä¸ºå¯æ‰§è¡Œæ–‡ä»¶</p></li>
<li><p><code>./RVMé…ç½®ROR.sh</code>  æ‰§è¡Œæ–‡ä»¶</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">echo</span> <span class="s">&quot;==========  å®‰è£…å‡½æ•°åº“ =================&quot;</span>
</span><span class='line'><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">curl</span> <span class="n">bison</span> <span class="n">build</span><span class="o">-</span><span class="n">essential</span> <span class="n">git</span><span class="o">-</span><span class="n">core</span>
</span><span class='line'><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">zlib1g</span><span class="o">-</span><span class="n">dev</span> <span class="n">libssl</span><span class="o">-</span><span class="n">dev</span> <span class="n">libreadline5</span><span class="o">-</span><span class="n">dev</span> <span class="n">libxml2</span><span class="o">-</span><span class="n">dev</span>
</span><span class='line'>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;========== å®‰è£…rvm ===================&quot;</span>
</span><span class='line'><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">~/</span><span class="p">.</span><span class="n">rvm</span><span class="o">/</span><span class="n">src</span><span class="o">/</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="o">~/</span><span class="p">.</span><span class="n">rvm</span><span class="o">/</span><span class="n">src</span> <span class="o">&amp;&amp;</span> <span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="p">.</span><span class="o">/</span><span class="n">rvm</span><span class="o">/</span> <span class="o">&amp;&amp;</span> <span class="n">git</span> <span class="n">clone</span> <span class="nl">git</span><span class="p">:</span><span class="c1">//github.com/wayneeseguin/rvm.git &amp;&amp; cd rvm &amp;&amp; ./install</span>
</span><span class='line'>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;========== æ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯ï¼Œæ‰§è¡Œ vim ~/.bashrc =================&quot;</span>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;========== å¹¶ä¸”å°†ä¸‹é¢å†…å®¹å¤åˆ¶åˆ°.bashrcæœ€å ===========&quot;</span>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot; if [[ -s &quot;</span><span class="err">$</span><span class="n">HOME</span><span class="o">/</span><span class="p">.</span><span class="n">rvm</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">rvm</span><span class="s">&quot; ]] ; then</span>
</span><span class='line'><span class="n">source</span> <span class="s">&quot;$HOME/.rvm/scripts/rvm&quot;</span><span class="p">;</span>
</span><span class='line'><span class="n">fi</span>
</span><span class='line'><span class="p">[[</span> <span class="o">-</span><span class="n">s</span> <span class="s">&quot;$HOME/.rvm/scripts/rvm&quot;</span> <span class="p">]]</span> <span class="o">&amp;&amp;</span> <span class="n">source</span> <span class="s">&quot;$HOME/.rvm/scripts/rvm&quot;</span>
</span><span class='line'><span class="s">&quot;</span>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;========== ä¿®æ”¹å®Œåè¯·æŒ‰å›è½¦é”®ç»§ç»­: ==========&quot;</span>
</span><span class='line'><span class="n">read</span> <span class="n">var</span>
</span><span class='line'>
</span><span class='line'><span class="n">type</span> <span class="n">rvm</span> <span class="o">|</span> <span class="n">head</span> <span class="o">-</span><span class="mi">1</span>
</span><span class='line'>
</span><span class='line'><span class="n">rvm</span> <span class="n">requirements</span>
</span><span class='line'>
</span><span class='line'><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">build</span><span class="o">-</span><span class="n">essential</span> <span class="n">openssl</span> <span class="n">libreadline6</span> <span class="n">libreadline6</span><span class="o">-</span><span class="n">dev</span> <span class="n">curl</span> <span class="n">git</span><span class="o">-</span><span class="n">core</span> <span class="n">zlib1g</span> <span class="n">zlib1g</span><span class="o">-</span><span class="n">dev</span> <span class="n">libssl</span><span class="o">-</span><span class="n">dev</span> <span class="n">libyaml</span><span class="o">-</span><span class="n">dev</span> <span class="n">libsqlite3</span><span class="o">-</span><span class="mi">0</span> <span class="n">libsqlite3</span><span class="o">-</span><span class="n">dev</span> <span class="n">sqlite3</span> <span class="n">libxml2</span><span class="o">-</span><span class="n">dev</span> <span class="n">libxslt</span><span class="o">-</span><span class="n">dev</span> <span class="n">autoconf</span> <span class="n">libc6</span><span class="o">-</span><span class="n">dev</span> <span class="n">ncurses</span><span class="o">-</span><span class="n">dev</span> <span class="n">automake</span> <span class="n">libtool</span> <span class="n">bison</span> <span class="n">subversion</span>
</span><span class='line'>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;==================================&quot;</span>
</span><span class='line'><span class="n">source</span> <span class="o">~/</span><span class="p">.</span><span class="n">bashrc</span>
</span><span class='line'>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;===================================&quot;</span>
</span><span class='line'><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">rubygems</span>
</span><span class='line'>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;========= å®‰è£…ruby1.9.2 ===========&quot;</span>
</span><span class='line'><span class="n">rvm</span> <span class="n">install</span> <span class="mf">1.9.2</span><span class="o">-</span><span class="n">p290</span>
</span><span class='line'>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;======== å®‰è£…rails3.0.3 ===========&quot;</span>
</span><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">rails</span> <span class="o">-</span><span class="n">v</span><span class="o">=</span><span class="mf">3.0.3</span>
</span><span class='line'>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;========= å®‰è£…ruby ===========&quot;</span>
</span><span class='line'><span class="n">rvm</span> <span class="n">install</span> <span class="mf">1.8.7</span>
</span><span class='line'>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;======== å®‰è£…rails ===========&quot;</span>
</span><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">rails</span> <span class="o">-</span><span class="n">v</span><span class="o">=</span><span class="mf">2.3.5</span>
</span><span class='line'>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;======= å®‰è£…mysql ============&quot;</span>
</span><span class='line'><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">mysql</span><span class="o">-</span><span class="n">server</span>
</span><span class='line'><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">mysql</span><span class="o">-</span><span class="n">client</span>
</span><span class='line'>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;====== å®‰è£…mysqlé©±åŠ¨ =========&quot;</span>
</span><span class='line'><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">libmysqlclient</span><span class="o">-</span><span class="n">dev</span>
</span><span class='line'><span class="n">sudo</span> <span class="n">gem</span> <span class="n">install</span> <span class="n">mysql2</span>
</span><span class='line'>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;======è®¾ç½®é»˜è®¤ç‰ˆæœ¬==========&quot;</span>
</span><span class='line'><span class="n">rvm</span> <span class="n">use</span> <span class="o">--</span><span class="k">default</span> <span class="mf">1.8.7</span>
</span><span class='line'>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;============æ›´æ–°ä½¿ç”¨äº2.3.5çš„rubygem=========&quot;</span>
</span><span class='line'><span class="n">gem</span> <span class="n">update</span> <span class="o">--</span><span class="n">system</span> <span class="mf">1.5.3</span>
</span><span class='line'>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;========== æ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯ï¼Œæ‰§è¡Œ vim ~/.bash_profile =================&quot;</span>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;========== å¹¶ä¸”å°†ä¸‹é¢å†…å®¹å¤åˆ¶åˆ°.bash_profileæœ€å ===========&quot;</span>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot; </span>
</span><span class='line'><span class="n">source</span> <span class="o">~/</span><span class="p">.</span><span class="n">bashrc</span>
</span><span class='line'><span class="s">&quot;</span>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;========== ä¿®æ”¹å®Œåè¯·æŒ‰å›è½¦é”®ç»§ç»­: ==========&quot;</span>
</span><span class='line'><span class="n">read</span> <span class="n">var</span>
</span><span class='line'>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;===== å¦‚æœåœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰é”™è¯¯ï¼Œé‚£ä¹ˆRuby on rails ç¯å¢ƒæ­é…æˆåŠŸ(Justin-lu)!! ======== &quot;</span>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;=====   QQï¼š448426851 ========================== &quot;</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
</feed>
