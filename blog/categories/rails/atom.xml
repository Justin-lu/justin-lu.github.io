<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: rails | Hi I'm Justin-lu]]></title>
  <link href="http://justin-lu.github.io/blog/categories/rails/atom.xml" rel="self"/>
  <link href="http://justin-lu.github.io/"/>
  <updated>2016-08-19T20:52:23+08:00</updated>
  <id>http://justin-lu.github.io/</id>
  <author>
    <name><![CDATA[Justin-lu]]></name>
    <email><![CDATA[gdjyluxiaoyong@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Reddot RubyConf 2016 æ€»ç»“]]></title>
    <link href="http://justin-lu.github.io/blog/2016/06/30/reddot-rubyconf-2016-zong-jie/"/>
    <updated>2016-06-30T17:24:04+08:00</updated>
    <id>http://justin-lu.github.io/blog/2016/06/30/reddot-rubyconf-2016-zong-jie</id>
    <content type="html"><![CDATA[<p>ä»Šå¹´ä»£è¡¨å…¬å¸ï¼ˆ<a href="http://beansmile.com/">Beansmile</a>ï¼‰å‰å¾€æ–°åŠ å¡å‚åŠ <code>Reddot RubyConf</code>, æ”¶è·æ»¡æ»¡ï¼Œè¶ç°åœ¨æœ‰æ—¶é—´ï¼Œç®€å•æ€»ç»“ä¸€ä¸‹ï¼Œä¾›è‡ªå·±æ¥ä¸‹æ¥çš„å­¦ä¹ æ–¹å‘å’Œç›®æ ‡ï¼ŒæŸ¥æ¼è¡¥ç¼ºï¼Œ  ä¹Ÿç»™æœªåˆ°åœºçš„æœ‹å‹åˆ†äº«ä¸€ä¸‹ã€‚
ä»¥ä¸‹å†…å®¹ï¼Œä»…ä¾›å‚è€ƒï¼Œå¦‚è‹¥æœ‰è¯¯ï¼Œè¯·æŒ‡æ­£ã€‚</p>

<!-- More -->


<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ—¥ç¨‹è¡¨</p>

<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f59mpaj2ghj20kz0oa0xg.jpg" alt="" /></p>

<p>æ»¡æ»¡çš„éƒ½æ˜¯å¹²è´§ï¼Œæ»¡æ»¡çš„éƒ½æ˜¯å¤§ç¥ï¼Œçœ‹å¾—æˆ‘é‚£ä¸ªé¸¡å†»~~</p>

<h2>Day 1</h2>

<h3>Yukihiro (Matz) Matsumoto â€“ <a href="https://engineers.sg/v/800">Keynote: Ruby Typing</a></h3>

<blockquote><p><code>Don't care about small things</code></p></blockquote>

<p>ç¬¬ä¸€ä¸ªè®²çš„æ˜¯Rubyä¹‹çˆ¶<code>Matz</code>ï¼Œä»¥Oå‹è¡€çš„äººä¸åœ¨æ„ç»†èŠ‚ï¼Œåˆ†æåŠ¨æ€è¯­è¨€å’Œé™æ€è¯­è¨€çš„åŒºåˆ«å…¥é¢˜, å€Ÿæ­¤å¼•å…¥Ruby 3æ–°Feature<code>Soft Typing</code></p>

<ul>
<li>Types(part of ruby 3)

<ul>
<li><a href="https://en.wikipedia.org/wiki/Duck_typing">Duck typing</a> in ruby(runtime)</li>
<li>Don&rsquo;t check type on Programming</li>
<li>Just care about behavior</li>
<li>example for String.IO</li>
<li>Don&rsquo;t care small things</li>
<li>Soft Typing</li>
<li>Don&rsquo;t challenge 100% coverage</li>
</ul>
</li>
</ul>


<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f59pdhnuysj21kw16otp6.jpg" alt="" /></p>

<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f59xnm36gaj20p00xcq69.jpg" alt="" /></p>

<h3>Jason Yeo â€“ <a href="https://speakerdeck.com/jsyeo/slaying-the-dragon-1">Slaying the Dragon</a></h3>

<ul>
<li>å…ˆè°ƒä¾ƒäº†Matzï¼Œè®¾è®¡äº†<code>Matzlisp</code>çš„<code>Logo</code>ï¼Œæ³¨å†Œäº†<code>matzLisp.org</code>ç­‰ç­‰ã€‚</li>
</ul>


<p><img src="http://ww4.sinaimg.cn/large/785cd1e3gw1f5a5jaw6gfj21jq11qn6v.jpg" alt="" /></p>

<ul>
<li>ç®€å•ä»‹ç»<a href="https://github.com/kanaka/mal">mal</a>çš„ç”¨æ³•,äº†è§£Lispçš„åŸºæœ¬æ¦‚å¿µ</li>
</ul>


<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f5a6xko44vj212i0lcdh4.jpg" alt="" /></p>

<ul>
<li><a href="http://rubinius.com/">Rubinius</a></li>
<li><a href="https://github.com//queenfrankie/lani">lani</a></li>
<li><a href="https://github.com/jsyeo/malady">malady</a></li>
</ul>


<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f59tvw7lm3j21kw16oqjl.jpg" alt="" /></p>

<h3>Kristine Joy Paas â€“ <a href="https://engineers.sg/v/802">Let&rsquo;s Play Ruby Golf</a></h3>

<ul>
<li>å„ç§Rubyé»‘é­”æ³•ï¼Œè¯·è‡ªæˆ‘å¯¹æ¯”ä¸€ä¸‹</li>
</ul>


<p>æ­£å¸¸æƒ…å†µ</p>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f5a7fkhgunj21600swdij.jpg" alt="" /></p>

<p>é»‘é­”æ³•æƒ…å†µä¸‹</p>

<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f5a7h7v0q5j21eo0j0dhg.jpg" alt="" /></p>

<p>è¿™æ˜¯æ­£å¸¸äººçœ‹ä¸æ‡‚çš„ä»£ç ï¼Œæ‰€ä»¥é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™äº›å†™æ³•åœ¨å›¢é˜Ÿéƒ½æ˜¯ä¸æ¨èçš„ï¼Œæƒå½“å­¦ä¹ å“ˆ~</p>

<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f59x8eak14j20zk0jz0t2.jpg" alt="" /></p>

<h3>Prathamesh Sonpatki â€“ <a href="https://speakerdeck.com/chaitanya/secrets-of-testing-rails-5-apps-red-dot-ruby-conf-edition">Secrets of testing Rails 5 apps</a></h3>

<ul>
<li>æ¥è‡ª<a href="https://www.bigbinary.com/">bigbinary</a>çš„åšä¸»ï¼Œåˆ†äº«å…³äºRails5çš„ä¸€äº›å†…å®¹</li>
<li>Rails 5 integration test are default</li>
<li>Rails 5 controller test are deprecated</li>
<li>Active Job Async adapter</li>
</ul>


<p>éœ€è¦äº†è§£æ›´å¤šç»†èŠ‚ï¼Œè¯·å‰å¾€<a href="http://blog.bigbinary.com/categories/Rails-5/">Rails-5</a>ï¼Œé‡Œé¢æ»¡æ»¡çš„éƒ½æ˜¯å¹²è´§ã€‚</p>

<p><img src="http://ww4.sinaimg.cn/large/785cd1e3gw1f59um0rclrj21kw16owxh.jpg" alt="" /></p>

<h3>Godfrey Chan â€“ Keynote (<em>coming soon</em>)</h3>

<ul>
<li>æˆäººä»¥é±¼ä¸å¦‚æˆäººä»¥æ¸”</li>
<li>Probelm Solving</li>
<li>Disruption</li>
<li>The Traditional Path</li>
<li>All abstractions leak</li>
<li>Debugging</li>
</ul>


<p><img src="http://ww4.sinaimg.cn/large/785cd1e3gw1f59ub69y6sj21kw16otrf.jpg" alt="" />
<img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f59udw4s2jj21kw16oae7.jpg" alt="" /></p>

<h3>Grzegorz Witek â€“ <a href="https://speakerdeck.com/arnvald/your-api-is-too-slow">Your API is too slow!</a></h3>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f59uj3f5p7j21kw16o7nl.jpg" alt="" /></p>

<ul>
<li>Web app optimization</li>
</ul>


<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f5a7md4rokj21kw0vygsu.jpg" alt="" /></p>

<ul>
<li>Web API optimization</li>
</ul>


<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f5a7mwny95j21kw0vqwka.jpg" alt="" /></p>

<ul>
<li>gem &lsquo;ruby-prof&rsquo;</li>
<li>gem &lsquo;rack-mini-profiler&rsquo;</li>
<li>gem &lsquo;newrelic&rsquo;</li>
<li>gem &lsquo;skylight&rsquo;</li>
</ul>


<h3><em>Ligtning talks</em></h3>

<h4>Jo Cranford â€“ <a href="https://engineers.sg/v/806">Where Did Everybody Go?</a></h4>

<p>ä¸»è¦æ˜¯é—®å·è°ƒæŸ¥ï¼Œè¯¦æƒ…è¯·çœ‹è§†é¢‘</p>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f59xb2rnc6j20zk0jzwew.jpg" alt="" /></p>

<h4>SHIBATA Hiroshi â€“ <a href="http://www.slideshare.net/hsbt/how-to-begin-developing-ruby-core">How to Begin Developing Ruby Core</a></h4>

<ul>
<li>ä»‹ç»å¦‚ä½•ä¸ºrubyè´¡çŒ®æºç </li>
</ul>


<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f59xbkuta1j20zk0jzgm6.jpg" alt="" /></p>

<h4>Ankita Gupta â€“ <a href="https://engineers.sg/v/808">Speeding Up Your Test Suite</a></h4>

<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f59uo16zyqj21kw16owlx.jpg" alt="" /></p>

<h4>Giovanni Sakti â€“ <a href="https://speakerdeck.com/giosakti/flexible-authorization">Flexible Authorization</a></h4>

<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f59v5y2evjj20xc0p040t.jpg" alt="" /></p>

<h3>Tim Riley â€“ <a href="http://dry-rb.org/resources/reddotrubyconf-2016">Next-generation Ruby web apps with dry-rb, rom-rb, and Roda</a></h3>

<ul>
<li>ç®€å•ä»‹ç»ä¸‹ä¸€ä»£Webæ¡†æ¶<a href="http://dry-rb.org/">dry-rb</a>ï¼ŒåŠå„ç§ä¸»ä»¶</li>
<li><a href="https://github.com/dry-rb">dry-rb</a> æºç </li>
<li><a href="https://github.com/rom-rb/rom">rom-rb</a></li>
<li><a href="https://github.com/jeremyevans/roda">roda</a></li>
<li><a href="https://github.com/dry-rb/dry-web">dry-web</a> - Lightweight web application stack with pluggable routing front-ends</li>
</ul>


<p><img src="http://ww4.sinaimg.cn/large/785cd1e3gw1f59v6oig8xj21kw16oaf9.jpg" alt="" /></p>

<h3>Sau Sheong Chang â€“ <a href="https://speakerdeck.com/sausheong/programming-complexity">Programming Complexity</a></h3>

<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f59ukhlo69j21kw16owxs.jpg" alt="" /></p>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f59uqlvqp5j20xc0p00v0.jpg" alt="" /></p>

<h2>Day 2</h2>

<h3>Aaron Patterson â€“ <a href="https://engineers.sg/v/812">Keynote: Taking Out The Trash</a></h3>

<ul>
<li><a href="https://github.com/tenderlove/widen">https://github.com/tenderlove/widen</a></li>
<li>We don&rsquo;t care about small things, so we are removing downcase in Ruby 2.5</li>
<li>Glossary</li>
<li>Something About GC</li>
<li>Find Unlink Node</li>
<li>Remembered Set</li>
<li>Incremental GC</li>
<li>Algorithm</li>
<li>Compacting</li>
<li>heap layout</li>
<li><a href="https://engineering.heroku.com/blogs/2015-02-04-incremental-gc/">https://engineering.heroku.com/blogs/2015-02-04-incremental-gc/</a></li>
<li>Ruby menmory Page &amp;&amp; OS menmory page</li>
<li>GC::Profiler.report</li>
<li><a href="http://ruby-doc.org/core-2.2.0/GC/Profiler.html">http://ruby-doc.org/core-2.2.0/GC/Profiler.html</a></li>
</ul>


<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f5aphue0c1j21kw16oh2b.jpg" alt="" />
<img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f5apijx905j21kw16otpo.jpg" alt="" /></p>

<h3>Sameer Deshmukh â€“ <a href="https://speakerdeck.com/v0dro/scientific-computing-in-ruby-rdrc-2016">Scientific Computing in Ruby</a></h3>

<ul>
<li>Sameer Deshmukh</li>
<li><a href="http://sciruby.com/">http://sciruby.com/</a></li>
<li><a href="https://github.com/domitry/nyaplot">https://github.com/domitry/nyaplot</a></li>
<li><a href="https://github.com/v0dro/daru">https://github.com/v0dro/daru</a></li>
<li><a href="https://t.co/22I21IxkMx">https://t.co/22I21IxkMx</a></li>
</ul>


<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f5apiwo48pj21kw16owyg.jpg" alt="" /></p>

<h3>Konstantin Hasse â€“ <a href="https://speakerdeck.com/rkh/how-we-replaced-salary-negotiations-with-a-sinatra-app">How We Replaced Salary Negotiations with a Sinatra App</a></h3>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f5apjnax8aj21kw1kwqso.jpg" alt="" />
<img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f5apk02vyfj21kw1kwaz4.jpg" alt="" /></p>

<h3>Vipul Amler â€“ <a href="https://speakerdeck.com/vipulnsward/rails-frontend-2016-edition">Rails Frontend: 2016 edition</a></h3>

<ul>
<li><a href="https://www.bigbinary.com/building-modern-web-applications-with-reactjs">https://www.bigbinary.com/building-modern-web-applications-with-reactjs</a></li>
<li><a href="https://engineering.heroku.com/blogs/2016-02-18-speeding-up-sprockets/">https://engineering.heroku.com/blogs/2016-02-18-speeding-up-sprockets/</a></li>
<li>Sprockets Feature</li>
<li>Headers(ETag,http_cache_forever)</li>
<li>Caching(Action/View/ActionMailer,SQL)</li>
<li>Layouts and Tags(async-defer)</li>
</ul>


<p><img src="http://ww4.sinaimg.cn/large/785cd1e3gw1f5aplexdqhj21kw1kwqqx.jpg" alt="" />
<img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f5aplqljqsj21kw1kwh91.jpg" alt="" /></p>

<h3>Sayanee Basu â€“ <a href="https://talks.sayan.ee/sense">Sense and Sensibility</a></h3>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f5apmj5abqj21kw1kw7sz.jpg" alt="" /></p>

<h3>Yasuko Ohba â€“ <a href="https://engineers.sg/v/817">Our Fight Against Super Bad Patterns in Legacy Rails Apps</a></h3>

<p><img src="http://ww4.sinaimg.cn/large/785cd1e3gw1f5apmunnbfj21kw16owyt.jpg" alt="" /></p>

<h3><em>Lightning talks</em></h3>

<h4>Kenji Mori â€“ <a href="https://speakerdeck.com/morizyun/learning-through-blogging-ruby-blogging-benefits">Learning Through Blogging: Ruby Blogging Benefits</a></h4>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f5aqni6tihj21380tawhe.jpg" alt="" /></p>

<h4>Jack Chen Songyong â€“ <a href="https://speakerdeck.com/aquajach/grow-from-small-simple-steps">Grow from Small Simple Steps</a></h4>

<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f5apyrxhvdj21kw16oaso.jpg" alt="" /></p>

<h4>Yuki Nishijima â€“ <a href="https://speakerdeck.com/yuki24/20-tools-and-techniques-that-make-you-more-creative">20 Tools and Techniques that Make You More Creative</a></h4>

<ul>
<li>gem &ldquo;did you mean/experimental&rdquo;</li>
<li>budnle config &ndash;global jobs 16</li>
<li>app.get &ldquo;/&rdquo;</li>
<li>minitest-power_assert</li>
<li>mv /path/{old, new}.rb/</li>
<li>ctrl + R</li>
<li>tree</li>
<li>ag/ lick ack</li>
<li>curl xxxxx | jq .dependecies.development</li>
<li>pagmentize   alise &lsquo;more&rsquo;=<code>pagmentize -g</code></li>
</ul>


<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f5aq5c3a7lj20zk0qoq4n.jpg" alt="" /></p>

<h4>Steven Yap â€“ <a href="https://engineers.sg/v/821">Building Real-Time App with React/Redux/Rails/RethinkDB</a></h4>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f5aq5tg4cjj20zk0qoq49.jpg" alt="" /></p>

<h4>Xin Tian â€“ <a href="https://engineers.sg/v/822">Journey to becoming a techlady</a></h4>

<p><img src="http://ww4.sinaimg.cn/large/785cd1e3gw1f5aqpgzch4j21kw0udtf2.jpg" alt="" /></p>

<h3>Kir Shatrov â€“ <a href="https://gist.github.com/kirs/a0b69608a96b7845f669822bd7852d9f">Building a ChatOps framework</a></h3>

<ul>
<li><a href="lita">https://github.com/litaio/lita</a></li>
</ul>


<p><img src="http://ww1.sinaimg.cn/large/785cd1e3gw1f5apodvprfj21kw16oh5d.jpg" alt="" /></p>

<h3>Terence Lee - <a href="https://www.youtube.com/watch?v=5WZmE3uXRWw&amp;list=PLECEw2eFfW7iiJpXtb_cYeKv5_A6Pd1tl&amp;index=24">Closing Keynote: After a Decade, Still a Rubyist - RedDotRubyConf 2016</a></h3>

<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f5apov9qcfj21kw16owxi.jpg" alt="" /></p>

<h3>å›¾ç‰‡</h3>

<p>ä¸­å›½å‚ä¼šRubyiståˆç…§</p>

<p><img src="http://ww1.sinaimg.cn/large/785cd1e3jw1f5aptfdeupj21kw16oh5f.jpg" alt="" /></p>

<h4>æ–°åŠ å¡ç¾æ™¯</h4>

<p>å¤œæ™¯
<img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f5apuw09klj21kw16o7qw.jpg" alt="" /></p>

<p>æ ‡å¿—æ€§å»ºç­‘
<img src="http://ww4.sinaimg.cn/large/785cd1e3gw1f5apvdxmqfj21kw16oh7a.jpg" alt="" /></p>

<p><img src="http://ww3.sinaimg.cn/large/785cd1e3gw1f5apw7akyqj21kw16o1kp.jpg" alt="" /></p>

<p><img src="http://ww2.sinaimg.cn/large/785cd1e3gw1f5apwlsz4mj21kw16o1hv.jpg" alt="" /></p>

<h3>å„ç§èµ„æº</h3>

<h4>å®˜ç½‘</h4>

<ul>
<li><a href="http://www.reddotrubyconf.com/">http://www.reddotrubyconf.com/</a></li>
</ul>


<h4>ç›´æ’­è§†é¢‘</h4>

<ul>
<li><a href="https://www.youtube.com/watch?v=_3sz2Oex2YQ">Day 1</a></li>
<li><a href="https://www.youtube.com/watch?v=nu3oVW1c66A">Day 2</a></li>
<li>å®Œæ•´è§†é¢‘æ’­æ”¾åˆ—è¡¨ ğŸ“º<a href="https://www.youtube.com/playlist?list=PLECEw2eFfW7iiJpXtb_cYeKv5_A6Pd1tl">https://www.youtube.com/playlist?list=PLECEw2eFfW7iiJpXtb_cYeKv5_A6Pd1tl</a></li>
</ul>


<h4><a href="https://gist.github.com/cheeaun/43843c8b1c764825b9f3d63ed8f5bd78">RedDotRubyConf 2016 links &amp; resources</a></h4>

<h4><a href="https://theta360.com/s/mLWd3XTvDsBTQVikyhOtt7wMm">ç°åœº3Då›¾</a></h4>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Google map with ionic]]></title>
    <link href="http://justin-lu.github.io/blog/2015/07/06/google-map-with-ionic/"/>
    <updated>2015-07-06T16:03:52+08:00</updated>
    <id>http://justin-lu.github.io/blog/2015/07/06/google-map-with-ionic</id>
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ionicæ·»åŠ google map.</p>

<!-- More -->


<p>åˆå§‹åŒ–ionicé¡¹ç›®</p>

<pre><code class="sh">  ionic start map blank --sass --id com.beansmile.maps
  cd map
  npm install
  gulp sass
</code></pre>

<p>æ·»åŠ ä»¥ä¸‹ä»£ç åˆ°ionic.project</p>

<pre><code class="javascript">  "gulpStartupTasks": ["sass", "watch"]
</code></pre>

<p>ä¸ªäººå»ºè®®åœ¨åˆå§‹åŒ–ionicé¡¹ç›®çš„æ—¶å€™ï¼Œ<code>id</code>å‚æ•°æ˜¯å¿…é¡»çš„ï¼Œç”Ÿæˆçš„idå°†åšä¸ºios app çš„<code>bundle id</code>å’Œandroid appçš„<code>package name</code>
&ndash;sass å‚æ•°é»˜è®¤å¯åŠ¨sassåŠŸèƒ½,ä¹Ÿå¯ä»¥åœ¨ä»¥åæ·»åŠ ï¼Œè¯¦è§<a href="http://ionicframework.com/docs/cli/sass.html">Using Sass</a></p>

<p>æ·»åŠ å®šä½æ’ä»¶geolocation</p>

<pre><code class="sh">  ionic plugin add cordova-plugin-geolocation
</code></pre>

<p>æŸ¥çœ‹<a href="https://developers.google.com/maps/documentation/javascript/tutorial">Google Maps Javascript SKD</a>å¹¶åˆ°<a href="https://code.google.com/apis/console/b/0/?pli=1">Google API Console</a>åˆ›å»ºä¸€ä¸ªGoogle Maps application.</p>

<p>å½“ä½ æ‹¿åˆ°ä½ çš„<code>google api key</code>åï¼Œæ·»åŠ åˆ°<code>www/index.html</code></p>

<pre><code class="javascript">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width"&gt;
    &lt;title&gt;&lt;/title&gt;

    &lt;!-- IF using Sass (run gulp sass first), then uncomment below and remove the CSS includes above --&gt;
    &lt;link href="css/ionic.app.css" rel="stylesheet"&gt;

    &lt;!-- ionic/angularjs js --&gt;
    &lt;script src="lib/ionic/js/ionic.bundle.js"&gt;&lt;/script&gt;

    &lt;script src="https://maps.googleapis.com/maps/api/js?key=[YOU KEY HERE]&amp;sensor=true"&gt;&lt;/script&gt;

    &lt;!-- cordova script (this will be a 404 during development) --&gt;
    &lt;script src="cordova.js"&gt;&lt;/script&gt;

    &lt;!-- your app's js --&gt;
    &lt;script src="js/app.js"&gt;&lt;/script&gt;
    &lt;script src="js/controllers.js"&gt;&lt;/script&gt;
    &lt;script src="js/directives.js"&gt;&lt;/script&gt;
  &lt;/head&gt;

  &lt;body ng-app="starter" ng-controller="MapCtrl"&gt;
    &lt;ion-header-bar class="bar-stable"&gt;
      &lt;h1 class="title"&gt;Map&lt;/h1&gt;
    &lt;/ion-header-bar&gt;

    &lt;ion-content scroll="false"&gt;
      &lt;a class="button button-icon icon ion-location map-icon-location active" ng-click="centerOnMe()"&gt;&lt;/a&gt;
      &lt;a class="button button-icon icon ion-navicon map-icon-menu" ng-click="direction()"&gt;&lt;/a&gt;
      &lt;map on-create="mapCreated(map)"&gt;&lt;/map&gt;
    &lt;/ion-content&gt;

    &lt;ion-footer-bar class="bar-stable"&gt;
        &lt;a class="button button-icon icon ion-woman item-button-left"&gt;&lt;/a&gt;
        &lt;a class="button button-icon icon ion-chevron-right item-button-right"&gt;&lt;/a&gt;
      &lt;/a&gt;
    &lt;/ion-footer-bar&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>æ·»åŠ æ ·å¼</p>

<pre><code class="css">map {
  display: block;
  width: 100%;
  height: 100%;
}
.scroll {
  height: 100%;
}

.map-icon-location{
  background-color: #fff;
  width: 47px;
  border-radius: 47px;
  margin-top: 50px;
  margin-left: 10px;
  position: fixed;
  z-index: 10000;
  box-shadow: 1px 1px 3px 2px #C2BDBD;
}
.map-icon-location.active, .map-icon-menu.active {
  background-color: #49AEF8 !important;
  opacity: 1 !important;
  color: #fff;
}

.map-icon-menu {
  background-color: #fff;
  width: 47px;
  border-radius: 47px;
  margin-top: 100px;
  margin-left: 10px;
  position: fixed;
  z-index: 10000;
  box-shadow: 1px 1px 3px 2px #C2BDBD;
}
</code></pre>

<p>æ·»åŠ mapçš„directives</p>

<pre><code class="javascript">angular.module('starter.directives', [])

.directive('map', function() {
  return {
    restrict: 'E',
    scope: {
      onCreate: '&amp;'
    },
    link: function ($scope, $element, $attr) {
      function initialize() {
        var mapOptions = {
          center: new google.maps.LatLng(43.07493, -89.381388),
          zoom: 16,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map($element[0], mapOptions);
        $scope.onCreate({map: map});

        // Stop the side bar from dragging when mousedown/tapdown on the map
        google.maps.event.addDomListener($element[0], 'mousedown', function (e) {
          e.preventDefault();
          return false;
        });
      }

      if (document.readyState === "complete") {
        initialize();
      } else {
        google.maps.event.addDomListener(window, 'load', initialize);
      }
    }
  }
});
</code></pre>

<p>æ·»åŠ å¯¹äºçš„controller.js</p>

<pre><code class="javascript">angular.module('starter.controllers', [])

.controller('MapCtrl', function($scope, $ionicLoading) {
  $scope.mapCreated = function(map) {
    $scope.map = map;
  };

  $scope.direction = function(){
    if (!$scope.map) {
      return;
    }

    $scope.loading = $ionicLoading.show({
      template: 'Getting current location...',
      showBackdrop: false
    });

    navigator.geolocation.getCurrentPosition(function (pos) {
      console.log('Got pos', pos);
      center = new google.maps.LatLng(37.772323, -122.214897);
      target = new google.maps.LatLng(37.771923, -122.219339);

      $scope.map.setCenter(center);

      var directionsDisplay = new google.maps.DirectionsRenderer();
      var directionsService = new google.maps.DirectionsService();

      directionsDisplay.setMap($scope.map);


      var request = {
          origin:center,
          destination:target,
          travelMode: google.maps.TravelMode.DRIVING
      };
      directionsService.route(request, function(response, status) {
        if (status == google.maps.DirectionsStatus.OK) {
          directionsDisplay.setDirections(response);
        }
      });

      $ionicLoading.hide();
    }, function (error) {
      alert('Unable to get location: ' + error.message);
    });
  }

  $scope.centerOnMe = function () {
    console.log("Centering");
    if (!$scope.map) {
      return;
    }

    $scope.loading = $ionicLoading.show({
      template: 'Getting current location...',
      showBackdrop: false
    });

    navigator.geolocation.getCurrentPosition(function (pos) {
      console.log('Got pos', pos);
      center = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
      $scope.map.setCenter(center);
      var marker = new google.maps.Marker({
        position: center,
        map: $scope.map,
        title: 'Hello World!'
      });
      $ionicLoading.hide();
    }, function (error) {
      alert('Unable to get location: ' + error.message);
    });
  };
});
</code></pre>

<p>æ‰“å¼€app.jsï¼Œæ³¨å…¥controllers directives</p>

<pre><code class="javascript">  angular.module('starter', ['ionic','starter.controllers', 'starter.directives'])
</code></pre>

<p>ä»¥ä¸Šæ ¹æ®google api, æ·»åŠ äº†å®šä½åŠŸèƒ½;ä¸¤ä¸ªåœ°ç‚¹çš„è·¯çº¿è§„åˆ’åŠŸèƒ½,ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼ŒAåœ°ç‚¹å’ŒBåœ°ç‚¹çš„ç»çº¬åº¦æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥éšæ„æ›´æ”¹ã€‚</p>

<p>æœ€åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå³å¯åœ¨ä½ çš„æ‰‹æœºä½¿ç”¨è¿™ä¸ªappäº†ã€‚</p>

<pre><code class="sh">  ionic build ios
  ionic run ios --devise
</code></pre>

<p>æ›´å¤šgoogle map apiï¼Œè¯·çœ‹ <a href="https://developers.google.com/maps/documentation/javascript/examples/">example</a></p>

<p>é™„ä¸Šæ•ˆæœå›¾ä¸€å¼ </p>

<p><img src="/images/blog/google-map.jpg" alt="google map" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç†è§£ ActiveSupport::Concern ]]></title>
    <link href="http://justin-lu.github.io/blog/2015/07/05/li-jie-activesupport-concern/"/>
    <updated>2015-07-05T21:49:00+08:00</updated>
    <id>http://justin-lu.github.io/blog/2015/07/05/li-jie-activesupport-concern</id>
    <content type="html"><![CDATA[<p>åˆ†äº«ä¸€ä¸‹è‡ªå·±é˜…è¯»ActiveSupport::Concernæºç çš„è¿‡ç¨‹ï¼Œå¸Œæœ›å’Œå¤§å®¶ä¸€èµ·å­¦ä¹ ï¼Œé”™è¯¯ä¹‹å¤„ï¼Œè¿˜è¯·æŒ‡å‡º</p>

<!-- More -->


<p>åœ¨æŸ¥çœ‹ActiveSupport::Concern <a href="https://github.com/rails/rails/blob/master/activesupport/lib/active_support/concern.rb">æºç </a>ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç†è§£å‡ ä¸ªæ¦‚å¿µ</p>

<h2>class_eval and instance_eval</h2>

<h3>instance_eval</h3>

<p>é¦–å…ˆä»åå­—å¯ä»¥å¾—åˆ°çš„ä¿¡æ¯æ˜¯ï¼Œ<code>instance_eval</code>çš„è°ƒç”¨è€…<code>receiver</code>å¿…é¡»æ˜¯ä¸€ä¸ªå®ä¾‹<code>instance</code>ï¼Œè€Œåœ¨<code>instance_eval</code> blockçš„å†…éƒ¨ï¼Œselfå³ä¸ºreceiverå®ä¾‹æœ¬èº«ã€‚</p>

<pre><code class="ruby"># ä¾‹å­ä¸€
obj_instance.instance_eval do
  self  # =&gt; obj_instance
  # current class =&gt; obj_instance's singleton class
end
</code></pre>

<p>æ ¹æ®è¿™ä¸ªå®šä¹‰ï¼Œå¦‚æœåœ¨ä¸€ä¸ªå®ä¾‹ä¸Šè°ƒç”¨äº†<code>instance_eval</code>ï¼Œå°±å¯ä»¥åœ¨å…¶ä¸­å®šä¹‰è¯¥å®ä¾‹çš„å•æ€å‡½æ•°<code>singleton_method</code></p>

<pre><code class="ruby"># ä¾‹å­äºŒ
class A
end

a = A.new
a.instance_eval do
  puts self  # =&gt; a
  # current class =&gt; a's singleton class
  def method1
    puts "this is a singleton method of instance a"
  end
end

a.method1
#=&gt; this is a singleton method of instance a

b = A.new
b.method1
#=&gt; NoMethodError: undefined method `method1' for #&lt;A:0x007fbc2ced9550&gt;
from (pry):13:in `&lt;main&gt;'
</code></pre>

<p>å¦‚æˆ‘ä»¬æ‰€çŸ¥ï¼Œå› ä¸ºç±»æœ¬èº«ä¹Ÿæ˜¯Classç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œinstance_evalä¹Ÿå¯ä»¥ç”¨åœ¨ç±»ä¸Šï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥åœ¨å…¶ä¸­å®šä¹‰è¯¥ç±»çš„singleton_methodï¼Œå³ä¸ºè¯¥ç±»çš„ç±»æ–¹æ³•.</p>

<pre><code class="ruby"># ä¾‹å­ä¸‰
class A
end

A.instance_eval do
  puts self  # =&gt; A
  # current class =&gt; A's singleton class
  def method1
    puts 'this is a singleton method of class A'
  end
end

A.method1
# this is a singleton method of class A
#=&gt;  nil

#=&gt; NoMethodError: undefined method `method1' for #&lt;A:0x007fbc3009e180&gt;
from (pry):11:in `&lt;main&gt;'
</code></pre>

<h3>class_eval</h3>

<p>å†æ¥çœ‹<code>class_eval</code>ï¼Œé¦–å…ˆä»åå­—å¯ä»¥å¾—åˆ°çš„ä¿¡æ¯æ˜¯ï¼Œclass_evalçš„è°ƒç”¨è€…receiverå¿…é¡»æ˜¯ä¸€ä¸ªç±»ï¼Œè€Œåœ¨<code>class_eval</code> <code>block</code>çš„å†…éƒ¨ï¼Œ<code>self</code>å³ä¸ºreceiverç±»æœ¬èº«ã€‚</p>

<pre><code class="ruby"># ä¾‹å­å››
class A
end

A.class_eval do
  puts self  
end
# =&gt; A
</code></pre>

<p>æ ¹æ®è¿™ä¸ªå®šä¹‰ï¼Œå¦‚æœåœ¨ä¸€ä¸ªç±»ä¸Šè°ƒç”¨äº†class_evalï¼Œå°±å¯ä»¥åœ¨å…¶ä¸­å®šä¹‰è¯¥ç±»çš„å®ä¾‹æ–¹æ³•(instance_method)ï¼Œä¾‹å¦‚</p>

<pre><code class="ruby"># ä¾‹å­äº”
class A
end

a = A.new
a.method1
#=&gt; NoMethodError: undefined method `method1' for &lt;A:0x007fbc29a826f8&gt; from (pry):21:in `&lt;main&gt;'

A.class_eval do
  def method1
    puts 'this is a instance method of class A'
  end
end

a.method1
#=&gt; this is a instance method of class A
</code></pre>

<p>ç»¼åˆä¸Šé¢ä¾‹å­ï¼Œæˆ‘ä»¬å¯å¾—å‡º</p>

<pre><code>1. `instance_eval`å¿…é¡»ç”±instanceæ¥è°ƒç”¨ï¼Œå¯ä»¥ç”¨æ¥å®šä¹‰å•ä¾‹å‡½æ•°ï¼ˆ`singleton_methods`)
2. `class_eval`å¿…é¡»æ˜¯ç”±classæ¥è°ƒç”¨ï¼Œå¯ä»¥ç”¨æ¥å®šä¹‰ç±»çš„å®ä¾‹æ–¹æ³•(`instance_methods`)
</code></pre>

<h2>include and extend</h2>

<p>åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆçœ‹ä»£ç ï¼š</p>

<pre><code class="ruby"># ä¾‹å­å…­
module Foo
  def foo
    puts 'foo method with include...'
  end
end

class Bar
  include Foo
end

Bar.new.foo 
# foo method with include...
# =&gt; nil
Bar.foo 
# NoMethodError: undefined method `foo' for Bar:Class
# from (pry):75:in `&lt;main&gt;'

class Baz
  extend Foo
end

Baz.foo
# foo method with include...
# =&gt; nil

Baz.new.foo
# NoMethodError: undefined method `foo' for #&lt;Baz:0x007f8061dec068&gt;
# from (pry):80:in `&lt;main&gt;'
</code></pre>

<p>ç”±ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œ<code>include</code>ä¼šæŠŠ<code>module</code>çš„æ–¹æ³•å˜æˆå®ä¾‹æ–¹æ³•ï¼Œ<code>extend</code> ä¼šæŠŠæ–¹æ³•å˜æˆç±»æ–¹æ³•ã€‚
ä½†æ˜¯ï¼Œå¤§å¤šæ—¶å€™æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨<code>include</code>æ¥å®ç°ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•ï¼Œè¯·çœ‹ä»¥ä¸‹ä¾‹å­ï¼š</p>

<pre><code class="ruby"># ä¾‹å­ä¸ƒ
module Foo
  def self.included(base)
    base.extend(ClassMethods)
  end

  module ClassMethods
    def bar
      puts 'class method'
    end
  end

  def foo
    puts 'instance method'
  end
end

class Baz
  include Foo
end

Baz.bar
# class method
# =&gt; nil
Baz.new.foo
# instance method
# =&gt; nil
Baz.foo
# NoMethodError: undefined method `foo' for Baz:Class
Baz.new.bar
# NoMethodError: undefined method `bar' for #&lt;Baz:0x007fbc30274ab8&gt;
</code></pre>

<p>ä»ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œ<code>include</code>æœ‰ä¸€ä¸ªå«<code>included</code>çš„é’©å­ï¼Œæ­£æ˜¯é€šè¿‡è¿™ä¸ªé’©å­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code>include</code>å®ç°æ·»åŠ ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•
æˆ‘ä»¬æ¥çœ‹çœ‹<code>included</code>è¿™ä¸ªé’©å­åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ</p>

<pre><code class="ruby">  module A
    def self.included(mod)
      puts "#{self} included in #{mod}"
    end
  end
  module Enumerable
    include A
  end
  # A included in Enumerable
  # =&gt; Enumerable
</code></pre>

<p>ä»ä»£ç æˆ‘ä»¬çš„è¾“å‡ºæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œ<code>included</code>ç±»æ–¹æ³•ä½œç”¨åŸŸ<code>self</code>ä¸º<code>Module A</code>ï¼Œå¹¶ä¼ å…¥<code>include A</code>çš„<code>receiver Enumerable</code>ã€‚ç„¶åæˆ‘ä»¬å†çœ‹çœ‹ä¾‹å­ä¸ƒï¼Œç»“åˆ<code>extend</code>ä¸<code>include</code>çš„ç†è§£ï¼Œå°±èƒ½æ˜ç™½å…¶ä¸­çš„åŸç†æ‰€åœ¨ã€‚</p>

<p>å†æ¥çœ‹çœ‹ActiveSupport::Concernçš„å®ç°ï¼š</p>

<ol>
<li>åœ¨æ²¡æœ‰å¼•å…¥<code>ActiveSupport::Concern</code>ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è¿›è¡Œæ¨¡å—åˆ†ç¦»</li>
</ol>


<pre><code class="ruby">  module M
    def self.included(base)
      base.extend ClassMethods
      base.class_eval do
        scope :disabled, -&gt; { where(disabled: true) }
      end

      include InstanceMethods
    end

    module ClassMethods
      def say_hello
        puts "say hello"
      end
    end

    module InstanceMethods
      def say_no
        puts "say no"
      end
    end
  end
</code></pre>

<p>ä»ä»£ç å¯çŸ¥ï¼Œé€šè¿‡<code>extend</code>å’Œ<code>class_eval</code>ä¸º<code>base</code>å®šä¹‰äº†<code>ClassMethods</code>é‡Œé¢çš„ç±»æ–¹æ³•ï¼Œé€šè¿‡<code>include</code> ä¸º<code>base</code>å®šä¹‰äº†<code>InstanceMethods</code>é‡Œé¢çš„å®åŠ›æ–¹æ³•ã€‚</p>

<p>å½“æˆ‘ä»¬å¼•å…¥<code>ActiveSupport::Concern</code>ä¹‹åï¼Œä»¥ä¸Šä¾‹å­æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™:
```ruby
  require &lsquo;active_support/concern&rsquo;</p>

<p>  module M
    extend ActiveSupport::Concern</p>

<pre><code>included do
  scope :disabled, -&gt; { where(disabled: true) }

  include InstanceMethods
end

module ClassMethods
  def say_hello
    puts "say hello"
  end
end

module InstanceMethods
  def say_no
    puts "say no"
  end
end
</code></pre>

<p>  end</p>

<pre><code>æœ€åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹[ActiveSupport::Concern] (https://github.com/rails/rails/blob/master/activesupport/lib/active_support/concern.rb),æ˜¯ä¸æ˜¯å°±å¾ˆå¥½ç†è§£äº†ï¼Ÿ
</code></pre>

<p>module Concern
    class MultipleIncludedBlocks &lt; StandardError #:nodoc:
      def initialize
        super &ldquo;Cannot define multiple &lsquo;included&rsquo; blocks for a Concern&rdquo;
      end
    end</p>

<pre><code>def self.extended(base) #:nodoc:
  base.instance_variable_set(:@_dependencies, [])
end

def append_features(base)
  if base.instance_variable_defined?(:@_dependencies)
    base.instance_variable_get(:@_dependencies) &lt;&lt; self
    return false
  else
    return false if base &lt; self
    @_dependencies.each { |dep| base.include(dep) }
    super
    base.extend const_get(:ClassMethods) if const_defined?(:ClassMethods)
    base.class_eval(&amp;@_included_block) if instance_variable_defined?(:@_included_block)
  end
end

def included(base = nil, &amp;block)
  if base.nil?
    raise MultipleIncludedBlocks if instance_variable_defined?(:@_included_block)

    @_included_block = block
  else
    super
  end
end

def class_methods(&amp;class_methods_module_definition)
  mod = const_defined?(:ClassMethods, false) ?
    const_get(:ClassMethods) :
    const_set(:ClassMethods, Module.new)

  mod.module_eval(&amp;class_methods_module_definition)
end
</code></pre>

<p>  end
```</p>

<p>Rails4.1 ä¹‹åï¼ŒModuleè¿˜åŠ å…¥äº†<a href="http://api.rubyonrails.org/v4.1.0/classes/Module/Concerning.html">Concerning</a>æ–¹æ³•</p>

<h2>Concerning</h2>

<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç»†åŒ–concernçš„å‡ ç§æ–¹æ³•</p>

<ul>
<li>é€šè¿‡æ³¨é‡Š</li>
</ul>


<pre><code class="ruby">class Todo
  # Other todo implementation
  # ...

  ## Event tracking
  has_many :events

  before_create :track_creation
  after_destroy :track_deletion

  private
    def track_creation
      # ...
    end
end
</code></pre>

<ul>
<li>é€šè¿‡<code>ActiveSupport::Concern</code></li>
</ul>


<pre><code class="ruby">class Todo
  # Other todo implementation
  # ...

  module EventTracking
    extend ActiveSupport::Concern

    included do
      has_many :events
      before_create :track_creation
      after_destroy :track_deletion
    end

    private
      def track_creation
        # ...
      end
  end
  include EventTracking
end
</code></pre>

<ul>
<li>é€šè¿‡<code>concerning</code></li>
</ul>


<pre><code class="ruby">class Todo &lt; ActiveRecord::Base
  # Other todo implementation
  # ...

  concerning :EventTracking do
    included do
      has_many :events
      before_create :track_creation
      after_destroy :track_deletion
    end

    private
      def track_creation
        # ...
      end
  end
end

Todo.ancestors
# [Todo,Todo::EventTracking,...]
</code></pre>

<p>æ€»å¾—æ¥è¯´ï¼Œ<code>concerning</code>ä¸»è¦ç”¨äºåˆ‡åˆ†æ¯”è¾ƒå°çš„model
å¦å¤–ï¼Œè¿˜æœ‰è¿˜æä¾›äº†ç±»ä¼¼çš„<code>concern</code>ç­‰æ–¹æ³•</p>

<pre><code class="ruby">concern :EventTracking do
end

is equivalent to

module EventTracking
  extend ActiveSupport::Concern
end
</code></pre>

<p>æœ€åè´´ä¸Šè‡ªç”¨ <a href="https://gist.github.com/Justin-lu/156bd4a1cba1c507e485">sublime snippet</a>,ä½†æ˜¯æˆ‘æ˜¯Vimå…š.</p>

<p>Reference:
<a href="http://www.railstips.org/blog/archives/2009/05/15/include-vs-extend-in-ruby/">http://www.railstips.org/blog/archives/2009/05/15/include-vs-extend-in-ruby/</a>
<a href="https://github.com/rails/rails/blob/master/activesupport/lib/active_support/concern.rb">https://github.com/rails/rails/blob/master/activesupport/lib/active_support/concern.rb</a>
<a href="https://github.com/rails/rails/blob/master/activesupport/lib/active_support/concern.rb">https://github.com/rails/rails/blob/master/activesupport/lib/active_support/concern.rb</a></p>

<hr />

<p>è¡¥å……ï¼š</p>

<h2>ActiveSupport::Concern#append_features</h2>

<pre><code class="ruby">def append_features(base)
  if base.instance_variable_defined?(:@_dependencies)
    base.instance_variable_get(:@_dependencies) &lt;&lt; self
    return false
  else
    return false if base &lt; self
    @_dependencies.each { |dep| base.include(dep) }
    super
    base.extend const_get(:ClassMethods) if const_defined?(:ClassMethods)
    base.class_eval(&amp;@_included_block) if instance_variable_defined?(:@_included_block)
  end
end
</code></pre>

<p><code>append_features</code>ä¹Ÿæ˜¯moduleçš„ä¸€ä¸ªcallbackï¼Œä¼šåœ¨includeä¹‹åï¼Œä¸ºå½“å‰classæ·»åŠ moduleçš„å˜é‡ï¼Œå¸¸é‡ï¼Œæ–¹æ³•ç­‰ã€‚append_features ä¼šå…ˆä¸included è¢«è°ƒç”¨ï¼Œè¯¦è§ï¼š<a href="http://apidock.com/ruby/Module/append_features">append_features</a>
ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå¦‚@neverlandxy_naixæ‰€è¯´çš„ä¸€æ ·ï¼Œæ­£æ˜¯é€šè¿‡é€’å½’çš„æ–¹æ³•å¤„ç†å¤šé‡åµŒå¥—</p>

<p>é¦–å…ˆçœ‹åˆ°ä¸€ä¸ª<code>if</code>åˆ¤æ–­,è¿™é‡Œåˆ¤æ–­å½“å‰ç±»(base)æ˜¯å¦å®šä¹‰äº†<code>@_dependencies</code>ï¼Œå¦‚æœè¢«å®šä¹‰ï¼Œåˆ™æŠŠå½“å‰moduleåŠ å…¥<code>@_dependencies</code>ã€‚æ€ä¹ˆè¯´å‘¢ï¼Ÿæˆ‘ä»¬å†æ¥çœ‹çœ‹</p>

<pre><code class="ruby">def self.extended(base) #:nodoc:
  base.instance_variable_set(:@_dependencies, [])
end
</code></pre>

<p><code>extended</code>ç±»ä¼¼äº<code>included</code>,å…·ä½“ç”¨æ³•è§<a href="http://ruby-doc.org/core-2.2.0/Module.html#method-i-extended">extended</a>
çœ‹å®Œ<code>extended</code>çš„ç”¨æ³•ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœå½“å‰ç±»<code>extend</code>äº†<code>ActiveSupport::Concern</code>,åˆ™<code>@_dependencies</code>ä¼šè¢«å®šä¹‰ã€‚</p>

<p>ç¬¬äºŒä¸ªifåˆ¤æ–­ï¼Œåˆ¤æ–­å½“å‰ç±»æ˜¯å¦ç»§æ‰¿äºå½“å‰æ¨¡å—ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¸éœ€è¦åšå…¶ä»–æ“ä½œï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™è¯´æ˜å½“å‰ç±»æ—¢ä¸æ˜¯å½“å‰æ¨¡å—çš„å­ç±»ï¼Œä¹Ÿæ²¡æœ‰<code>extend</code> <code>ActiveSupport::Concern</code>ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ€ç»ˆè¦<code>include</code>å½“å‰æ¨¡å—çš„ç±»ï¼Œæ­¤æ—¶ï¼Œå½“å‰ç±»<code>include</code>å½“å‰æ¨¡å—æ‰€æœ‰ä¾èµ–<code>@_dependencies</code>,å¹¶å®šä¹‰<code>ClassMethods</code>å’Œ<code>included</code>blocké‡Œé¢çš„æ–¹æ³•ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Scopes é¢„åŠ è½½]]></title>
    <link href="http://justin-lu.github.io/blog/2015/07/05/rails-scopes-yu-jia-zai/"/>
    <updated>2015-07-05T21:48:00+08:00</updated>
    <id>http://justin-lu.github.io/blog/2015/07/05/rails-scopes-yu-jia-zai</id>
    <content type="html"><![CDATA[<p>å‰å‡ å¤©åœ¨<a href="http://rubyweekly.com/">rubyweekly</a>é‡Œé¢çœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œæ„Ÿè§‰å†™å¾—ä¸é”™ã€‚æ‹¿å‡ºæ¥åˆ†äº«ä¸€ä¸‹ã€‚<a href="http://www.justinweiss.com/%0Ablog/2015/06/23/how-to-preload-rails-scopes/?utm_source=rubyweekly&amp;utm_medium=email">åŸæ–‡</a>æ›´ç²¾å½©</p>

<!-- More -->


<h1>scope ä¼šé€ æˆN+1æŸ¥è¯¢</h1>

<p>ä½œä¸ºä¸€ä¸ªRailså¼€å‘è€…ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨<a href="http://guides.rubyonrails.org/active_record_querying.html#scopes">scope</a>æ¥åšæŸ¥è¯¢ï¼Œä»¥ç®€åŒ–ä½ çš„ä»£ç ï¼Œå¦‚ï¼š</p>

<pre><code class="ruby">class Review &lt; ActiveRecord::Base
  belongs_to :restaurant

  scope :positive, -&gt; { where("rating &gt; 3.0") }
end
</code></pre>

<pre><code class="ruby">irb(main):001:0&gt; Restaurant.first.reviews.positive.count
  Restaurant Load (0.4ms)  SELECT  `restaurants`.* FROM `restaurants`  ORDER BY `restaurants`.`id` ASC LIMIT 1
   (0.6ms)  SELECT COUNT(*) FROM `reviews` WHERE `reviews`.`restaurant_id` = 1 AND (rating &gt; 3.0)
=&gt; 5
</code></pre>

<p>ä½†æ˜¯ï¼Œå½“ä½ ä¸€ä¸å°å¿ƒï¼Œè¿™å°†ä¸¥é‡çš„å½±å“ä½ åº”ç”¨çš„æ€§èƒ½ã€‚
ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä½¿ç”¨<code>scope</code>è¿›è¡Œå®šä¹‰çš„æŸ¥è¯¢å¹¶ä¸ä¼šè¢«é¢„åŠ è½½ã€‚
å‡è®¾ä½ è¦æŸ¥è¯¢ä¸€äº›<code>restaurants</code>æ‰€æœ‰<code>positive reviews</code>ï¼š</p>

<pre><code class="ruby">irb(main):001:0&gt; restauraunts = Restaurant.first(5)
irb(main):002:0&gt; restauraunts.map do |restaurant|
irb(main):003:1*   "#{restaurant.name}: #{restaurant.reviews.positive.length} positive reviews."
irb(main):004:1&gt; end
  Review Load (0.6ms)  SELECT `reviews`.* FROM `reviews` WHERE `reviews`.`restaurant_id` = 1 AND (rating &gt; 3.0)
  Review Load (0.5ms)  SELECT `reviews`.* FROM `reviews` WHERE `reviews`.`restaurant_id` = 2 AND (rating &gt; 3.0)
  Review Load (0.7ms)  SELECT `reviews`.* FROM `reviews` WHERE `reviews`.`restaurant_id` = 3 AND (rating &gt; 3.0)
  Review Load (0.7ms)  SELECT `reviews`.* FROM `reviews` WHERE `reviews`.`restaurant_id` = 4 AND (rating &gt; 3.0)
  Review Load (0.7ms)  SELECT `reviews`.* FROM `reviews` WHERE `reviews`.`restaurant_id` = 5 AND (rating &gt; 3.0)
=&gt; ["Judd's Pub: 5 positive reviews.", "Felix's Nightclub: 6 positive reviews.", "Mabel's Burrito Shack: 7 positive reviews.", "Kendall's Burrito Shack: 2 positive reviews.", "Elisabeth's Deli: 15 positive reviews."]
</code></pre>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>scope:positive</code>å¹¶æ²¡æœ‰è¢«ç¼“å­˜èµ·æ¥ï¼Œè¿™æ˜æ˜¾çš„æ˜¯ä¸€ä¸ª<code>N+1</code>æŸ¥è¯¢ã€‚</p>

<h1>ç”¨associationsä»£æ›¿scopes</h1>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ç”¨associationsä»£æ›¿scopesï¼Œæ¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚è¯·çœ‹ä¸‹é¢ä¾‹å­ï¼š</p>

<pre><code class="ruby">class Restaurant &lt; ActiveRecord::Base
  has_many :reviews
end
</code></pre>

<p>å½“æˆ‘ä»¬æŸ¥çœ‹è¿™ä¸ª<a href="http://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html">æ–‡æ¡£</a>æ—¶,æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>has_many</code>å…è®¸æˆ‘ä»¬æ·»åŠ è‡ªå®šä¹‰æŸ¥è¯¢</p>

<pre><code class="ruby">class Restaurant &lt; ActiveRecord::Base
  has_many :reviews
  has_many :positive_reviews, -&gt; { where("rating &gt; 3.0") }, class_name: "Review"
end
</code></pre>

<p>ä½†æˆ‘ä»¬å¯ä»¥è¿™æ ·å­è·å–ä¸€ä¸ª<code>restaurant</code>çš„æ‰€æœ‰<code>positive_reviews</code></p>

<pre><code class="ruby">irb(main):001:0&gt; Restaurant.first.positive_reviews.count
  Restaurant Load (0.2ms)  SELECT  `restaurants`.* FROM `restaurants`  ORDER BY `restaurants`.`id` ASC LIMIT 1
   (0.4ms)  SELECT COUNT(*) FROM `reviews` WHERE `reviews`.`restaurant_id` = 1 AND (rating &gt; 3.0)
=&gt; 5
</code></pre>

<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>include</code>æ¥é¢„åŠ è½½è¿™ä¸ªå…³è”å…³ç³»äº†</p>

<pre><code class="ruby">irb(main):001:0&gt; restauraunts = Restaurant.includes(:positive_reviews).first(5)
  Restaurant Load (0.3ms)  SELECT  `restaurants`.* FROM `restaurants`  ORDER BY `restaurants`.`id` ASC LIMIT 5
  Review Load (1.2ms)  SELECT `reviews`.* FROM `reviews` WHERE (rating &gt; 3.0) AND `reviews`.`restaurant_id` IN (1, 2, 3, 4, 5)
irb(main):002:0&gt; restauraunts.map do |restaurant|
irb(main):003:1*   "#{restaurant.name}: #{restaurant.positive_reviews.length} positive reviews."
irb(main):004:1&gt; end
=&gt; ["Judd's Pub: 5 positive reviews.", "Felix's Nightclub: 6 positive reviews.", "Mabel's Burrito Shack: 7 positive reviews.", "Kendall's Burrito Shack: 2 positive reviews.", "Elisabeth's Deli: 15 positive reviews."]
</code></pre>

<p>è‡³æ­¤ï¼Œ6ä¸ªSqlæŸ¥è¯¢å˜æˆ2ä¸ª</p>

<h1>æ¶ˆé™¤é‡å¤</h1>

<p>ç°åœ¨æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>scope:positive</code>å’Œä¸€ä¸ªå…³ç³»<code>has_many :positive_reviews</code>ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ƒä»¬æ˜¯é‡å¤çš„ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•çš„æ¶ˆé™¤è¿™ä¸ªDRY.</p>

<pre><code class="ruby">class Review &lt; ActiveRecord::Base
  belongs_to :restaurant

  scope :positive, -&gt; { where("rating &gt; 3.0") }
end

class Restaurant &lt; ActiveRecord::Base
  has_many :reviews
  has_many :positive_reviews, -&gt; { positive }, class_name: "Review"
end
</code></pre>

<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“<code>scope</code>è™½ç„¶å¥½ç”¨ï¼Œä½†æ˜¯å½“ä½ å‘ç°çš„ä»£ç å‡ºç°ä»¥ä¸Šé—®é¢˜æ—¶ï¼Œç®€å•çš„ä¿®æ”¹ï¼Œèƒ½å‡å°‘è®¸å¤š<code>sql</code>æŸ¥è¯¢</p>

<p>æ–‡ç« æ²¡æœ‰é€å­—ç¿»è¯‘ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œéº»çƒ¦æŒ‡å‡ºã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Asset pipeline ç†è§£]]></title>
    <link href="http://justin-lu.github.io/blog/2013/08/10/asset-pipeline-li-jie/"/>
    <updated>2013-08-10T16:46:00+08:00</updated>
    <id>http://justin-lu.github.io/blog/2013/08/10/asset-pipeline-li-jie</id>
    <content type="html"><![CDATA[<p>ç®€å•ä»‹ç»ä¸ªäººå¯¹Asset pipelineçš„ç†è§£</p>

<!-- More -->


<h3>Asset Pipeline æ˜¯ä»€ä¹ˆ</h3>

<blockquote><p>asset pipline æ˜¯ä¸€ä¸ªæä¾›è¿ç»“ç¼©å°æˆ–è€…å‹ç¼© JavaScript å’Œ CSS èµ„æºçš„æ¡†æ¶ã€‚å®ƒä¹Ÿæ·»åŠ äº†ç”¨å…¶å®ƒè¯­è¨€ç¼–å†™è¿™äº›èµ„æºçš„åŠŸèƒ½, å¦‚ CoffeeScript, Sass å’Œ ERBã€‚</p>

<p>å¯¹äºæ–°æ‰‹æ¥è¯´ï¼ŒAsset Pipelineæ— ç–‘æ˜¯ä¸€ä¸ªæ¯”è¾ƒéš¾æŒæ¡çš„å†…å®¹ï¼Œç‰¹åˆ«æ˜¯å½“Productionæ¨¡å¼ä¹‹åï¼Œå¯èƒ½é‡åˆ°çš„é—®é¢˜ä¼šæ›´å¤šï¼Œæˆ‘ä»¬åªæœ‰ç†è§£å®ƒï¼Œæ‰èƒ½æ›´å¥½çš„ä½¿ç”¨å®ƒã€‚</p></blockquote>

<ol>
<li>Rails 3.1 ä¹‹åï¼Œ<code>asset pipeline</code>æ˜¯è‡ªåŠ¨æ‰“å¼€çš„ï¼Œä½ æœ‰ä¸¤ç§æ–¹å¼ä¸ä½¿ç”¨å®ƒ:</li>
<li>åœ¨<code>config/application.rb</code>é‡Œé¢æ·»åŠ ï¼š<code>config.assets.enabled = false</code></li>
<li>ä¹Ÿå¯ä»¥åœ¨æ–°å»ºAppçš„æ—¶å€™é€šè¿‡å‚æ•°æ¥å…³é—­:<code>rails new appname --skip-sprockets</code></li>
<li>ç›®å½•ç»“æ„</li>
<li><code>app/assets</code>å­˜æ”¾åº”ç”¨ç¨‹åºæœ¬èº«æ‰€ä½¿ç”¨çš„JSã€CSSå’ŒImage</li>
<li><code>lib/assets</code>å­˜æ”¾è‡ªå·±æ‹“å±•çš„JSã€CSSå’ŒImage</li>
<li><code>vendor/assets</code>å­˜æ”¾ç¬¬ä¸‰æ–¹æ‹“å±•JSã€CSSå’ŒImageï¼Œä¾‹å¦‚Jqueryã€Extjsç­‰ä¸€äº›ç±»åº“</li>
<li>æœç´¢è·¯å¾„</li>
<li>åœ¨<code>config/application.rb</code>é‡Œé¢<code>config.assets.paths &lt;&lt; Rails.root.join("app", "assets")</code>é‡Œé¢å¯ä»¥æ·»åŠ åˆ°é¢„ç¼–è¯‘åˆ—è¡¨</li>
<li>ä¾‹å¦‚ï¼Œéœ€è¦åŠ è½½è¿™ä¸ªæ–‡ä»¶<code>app/assets/javascripts/home.js</code>,è¿™åªéœ€è¦åœ¨<code>application.js</code>é‡Œé¢æ·»åŠ <code>=// require home</code>å³å¯</li>
<li>æ³¨æ„ï¼šå¦‚æœå¼•ç”¨èµ„æºæ¸…å•å¤–çš„æ–‡ä»¶ï¼Œå¿…é¡»åŠ è½½åˆ°é¢„ç¼–è¯‘åˆ—è¡¨ï¼Œå¦çŸ¥producionç¯å¢ƒä¸å¯ç”¨</li>
</ol>


<hr />

<p>æ›´å¤šè¯¦ç»†èµ„æ–™ï¼Œè¯·å‚é˜…</p>

<ul>
<li><a href="http://guides.ruby-china.org/asset_pipeline.html">Asset Pipline ä¸­æ–‡ç‰ˆ</a></li>
<li><a href="http://guides.rubyonrails.org/asset_pipeline.html">Asset Pipline è‹±æ–‡ç‰ˆ</a></li>
<li>å¦‚æœéœ€è¦ï¼Œå¯åœ¨<code>config/application.rb</code>æ·»åŠ <code>config.assets.enabled = false</code>å…³é—­<code>asset pipeline</code>åŠŸèƒ½</li>
</ul>


<h3>å¦‚ä½•ç®¡ç†æ•°æ®</h3>

<ol>
<li><p>ä¸€ä¸ªæ–°çš„<code>Rails</code>åº”ç”¨ç¨‹åºåŒ…å«äº†ä¸€ä¸ªé»˜è®¤çš„<code>app/assets/javascripts/application.js</code>æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«äº†ä¸€äº›è¡Œ:
<code>javascript
// ...
//= require jquery
//= require jquery_ujs
//= require_tree .
</code></p></li>
<li><p><code>require_tree</code>æŒ‡ä»¤å‘Šè¯‰<code>Sprockets</code>é€’å½’åœ°å»åŒ…å«åœ¨æŒ‡å®šç›®å½•ä¸‹<code>æ‰€æœ‰</code>çš„ JavaScript æ–‡ä»¶åˆ°è¾“å‡ºé‡Œ</p></li>
<li><code>require_directory</code>å®ƒä¼šå°†åœ¨æŸä¸ªç‰¹å®šç›®å½•ä¸‹æ‰€æœ‰çš„ JavaScript æ–‡ä»¶åŒ…å«è¿›å»ï¼Œä½†ä¸é€’å½’.</li>
<li><code>include</code>ä¸require ä¸€æ ·ï¼Œå·®åˆ«åœ¨äºå³ä½¿æ˜¯è¢«åŠ è½½è¿‡çš„æ–‡ä»¶ï¼Œä¹Ÿä¼šè¢«å†æ¬¡åŠ è½½</li>
<li><code>require_self</code> å‘Šè¨´<code>Sprockets</code>åœ¨è½½å…¥å…¶ä»–çš„æ–‡ä»¶æ—¶ï¼Œå…ˆå°†è‡ªå·±çš„å†…å®¹</li>
<li><code>stub</code>å°†è·¯å¾„ä¸­å¾—assetsåŠ å…¥é»‘åå•ï¼Œæ‰€æœ‰å…¶ä»–çš„requireéƒ½ä¸ä¼šå°†å®ƒè½½å…¥</li>
<li>æ³¨æ„ï¼šå¼•ç”¨æ—¶ä¸éœ€è¦æ˜¾ç¤ºæä¾›æ‹“å±•å,<code>require_tree</code>åŒ…å«çš„æ–‡ä»¶æ˜¯æ²¡æœ‰é¡ºåºçš„ã€‚</li>
<li>å…³æ‰<code>require_tree .</code>,å®ƒä¼šé€’å½’åŠ è½½å½“å‰æ–‡ä»¶ä¸‹å¾—æ‰€æœ‰æ–‡ä»¶ï¼Œå¯¹äºå°ç³»ç»Ÿæ¥è¯´ï¼Œå¯èƒ½æ²¡å¤šå¤§å½±å“ï¼Œç³»ç»Ÿå¤æ‚äº†ï¼Œæ¯æ¬¡éƒ½åŠ è½½é‚£ä¹ˆå¤šæ–‡ä»¶ï¼Œè®¿é—®å°±ä¼šå˜æ…¢äº†ã€‚</li>
<li>æ ¹æ®éœ€æ±‚ï¼Œç»„ç»‡ä½ è‡ªå·±çš„åŠ è½½æ–¹å¼ï¼Œä¸€ä¸‹æ ¹æ®åšERPç³»ç»Ÿï¼Œå†™å‡ºæˆ‘çš„åŠ è½½æ–¹å¼</li>
<li>å»æ‰<code>require_tree .</code></li>
<li>åœ¨ä¸‰ä¸ª<code>appliction.js</code>æ–‡ä»¶ä¸­ï¼Œæ·»åŠ é¡¹ç›®å·¥ç”¨çš„JSå’ŒCSSä»£ç ï¼Œé»˜è®¤éƒ½ä¼šç¼–è¯‘</li>
<li>é€šè¿‡ä¿®æ”¹<code>config.assets.precompile += %w( other.js , another.js)</code>ï¼Œå¢åŠ é™¤äº†<code>application.js</code>å¤–çš„æ–‡ä»¶ï¼‰</li>
<li>åœ¨<code>/app/application_controller.rb</code>é‡Œé¢æ·»åŠ <code>&lt;%= javascript_include_tag params[:controller]/params[:action] %&gt;</code>æˆ–è€…<code>&lt;%= stylesheet_link_tag params[:controller]/params[:action] %&gt;</code>åŠ è½½æ¯ä¸ªé¡µé¢æ‰€ä½¿ç”¨åˆ°çš„Jså’ŒCSSæ–‡ä»¶</li>
</ol>

]]></content>
  </entry>
  
</feed>
